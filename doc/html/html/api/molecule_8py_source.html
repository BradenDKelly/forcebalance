<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>ForceBalance API: molecule.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ForceBalanceLogo_sm.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">ForceBalance API
   &#160;<span id="projectnumber">1.3</span>
   </div>
   <div id="projectbrief">Automated optimization of force fields and empirical potentials</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../index.html"><span>Main Page</span></a></li>
      <li ><a href="roadmap.html"><span>Project Roadmap</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_5b49eee2116abac69c11b41349acee08.html">local</a></li><li class="navelem"><a class="el" href="dir_0b09cb26e9310e6b1b01f03ccbd49614.html">lib</a></li><li class="navelem"><a class="el" href="dir_a944ffc100badf28a0bd62994e98c4fe.html">python2.7</a></li><li class="navelem"><a class="el" href="dir_9f18089c69b59347942af98be1b4448b.html">site-packages</a></li><li class="navelem"><a class="el" href="dir_59057f81082a38402e447ad7c8ef5cf6.html">forcebalance</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">molecule.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="molecule_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html">    1</a></span>&#160;<span class="comment">#======================================================================#</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">#|                                                                    |#</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">#|              Chemical file format conversion module                |#</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">#|                                                                    |#</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">#|                Lee-Ping Wang (leeping@stanford.edu)                |#</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">#|                     Last updated March 30, 2014                    |#</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">#|                                                                    |#</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">#|   This is free software released under version 2 of the GNU GPL,   |#</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">#|   please use or redistribute as you see fit under the terms of     |#</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">#|   this license. (http://www.gnu.org/licenses/gpl-2.0.html)         |#</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">#|                                                                    |#</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">#|   This program is distributed in the hope that it will be useful,  |#</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">#|   but without any warranty; without even the implied warranty of   |#</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">#|   merchantability or fitness for a particular purpose.  See the    |#</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">#|   GNU General Public License for more details.                     |#</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">#|                                                                    |#</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">#|   Feedback and suggestions are encouraged.                         |#</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">#|                                                                    |#</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">#|   What this is for:                                                |#</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">#|   Converting a molecule between file formats                       |#</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">#|   Loading and processing of trajectories                           |#</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">#|   (list of geometries for the same set of atoms)                   |#</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">#|   Concatenating or slicing trajectories                            |#</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">#|   Combining molecule metadata (charge, Q-Chem rem variables)       |#</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">#|                                                                    |#</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">#|   Supported file formats:                                          |#</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">#|   See the __init__ method in the Molecule class.                   |#</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">#|                                                                    |#</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">#|   Note to self / developers:                                       |#</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">#|   Please make this file as standalone as possible                  |#</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">#|   (i.e. don&#39;t introduce dependencies).  If we load an external     |#</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">#|   library to parse a file, do so with &#39;try / except&#39; so that       |#</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">#|   the module is still usable even if certain parts are missing.    |#</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">#|   It&#39;s better to be like a Millennium Falcon. :P                   |#</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">#|                                                                    |#</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">#|   Please make sure this file is up-to-date in                      |#</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">#|   both the &#39;leeping&#39; and &#39;forcebalance&#39; modules                    |#</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">#|                                                                    |#</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">#|   At present, when I perform operations like adding two objects,   |#</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">#|   the sum is created from deep copies of data members in the       |#</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">#|   originals. This is because copying by reference is confusing;    |#</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">#|   suppose if I do B += A and modify something in B; it should not  |#</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">#|   change in A.                                                     |#</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">#|                                                                    |#</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">#|   A consequence of this is that data members should not be too     |#</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">#|   complicated; they should be things like lists or dicts, and NOT  |#</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">#|   contain references to themselves.                                |#</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">#|                                                                    |#</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">#|   To-do list: Handling of comments is still not very good.         |#</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">#|   Comments from previous files should be &#39;passed on&#39; better.       |#</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">#|                                                                    |#</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">#|              Contents of this file:                                |#</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">#|              0) Names of data variables                            |#</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">#|              1) Imports                                            |#</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">#|              2) Subroutines                                        |#</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">#|              3) Molecule class                                     |#</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">#|                a) Class customizations (add, getitem)              |#</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">#|                b) Instantiation                                    |#</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">#|                c) Core functionality (read, write)                 |#</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">#|                d) Reading functions                                |#</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">#|                e) Writing functions                                |#</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">#|                f) Extra stuff                                      |#</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">#|              4) &quot;main&quot; function (if executed)                      |#</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">#|                                                                    |#</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">#|                   Required: Python 2.7, Numpy 1.6                  |#</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">#|                   Optional: Mol2, PDB, DCD readers                 |#</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">#|                    (can be found in ForceBalance)                  |#</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">#|                    NetworkX package (for topologies)               |#</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">#|                                                                    |#</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">#|             Thanks: Todd Dolinsky, Yong Huang,                     |#</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">#|                     Kyle Beauchamp (PDB)                           |#</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">#|                     John Stone (DCD Plugin)                        |#</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">#|                     Pierre Tuffery (Mol2 Plugin)                   |#</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">#|                     #python IRC chat on FreeNode                   |#</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">#|                                                                    |#</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">#|             Instructions:                                          |#</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">#|                                                                    |#</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">#|               To import:                                           |#</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">#|                 from molecule import Molecule                      |#</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">#|               To create a Molecule object:                         |#</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">#|                 MyMol = Molecule(fnm)                              |#</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">#|               To convert to a new file format:                     |#</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">#|                 MyMol.write(&#39;newfnm.format&#39;)                       |#</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">#|               To concatenate geometries:                           |#</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">#|                 MyMol += MyMolB                                    |#</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">#|                                                                    |#</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">#======================================================================#</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">#=========================================#</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">#|     DECLARE VARIABLE NAMES HERE       |#</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">#|                                       |#</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">#|  Any member variable in the Molecule  |#</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">#| class must be declared here otherwise |#</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">#| the Molecule class won&#39;t recognize it |#</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">#=========================================#</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">#| Data attributes in FrameVariableNames |#</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">#| must be a list along the frame axis,  |#</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">#| and they must have the same length.   |#</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">#=========================================#</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment"># xyzs       = List of arrays of atomic xyz coordinates</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment"># comms      = List of comment strings</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment"># boxes      = List of 3-element or 9-element arrays for periodic boxes</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment"># qm_forces  = List of arrays of atomistic forces from QM calculations</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment"># qm_espxyzs = List of arrays of xyz coordinates for ESP evaluation</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment"># qm_espvals = List of arrays of ESP values</span></div>
<div class="line"><a name="l00106"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a0044fa397e0923635a8b3e9625aa70f7">  106</a></span>&#160;FrameVariableNames = set([<span class="stringliteral">&#39;xyzs&#39;</span>, <span class="stringliteral">&#39;comms&#39;</span>, <span class="stringliteral">&#39;boxes&#39;</span>, <span class="stringliteral">&#39;qm_hessians&#39;</span>, <span class="stringliteral">&#39;qm_forces&#39;</span>, <span class="stringliteral">&#39;qm_energies&#39;</span>, <span class="stringliteral">&#39;qm_interaction&#39;</span>, </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                          <span class="stringliteral">&#39;qm_espxyzs&#39;</span>, <span class="stringliteral">&#39;qm_espvals&#39;</span>, <span class="stringliteral">&#39;qm_extchgs&#39;</span>, <span class="stringliteral">&#39;qm_mulliken_charges&#39;</span>, <span class="stringliteral">&#39;qm_mulliken_spins&#39;</span>])</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">#=========================================#</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">#| Data attributes in AtomVariableNames  |#</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">#| must be a list along the atom axis,   |#</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">#| and they must have the same length.   |#</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">#=========================================#</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment"># elem       = List of elements</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment"># partial_charge = List of atomic partial charges </span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment"># atomname   = List of atom names (can come from MM coordinate file)</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment"># atomtype   = List of atom types (can come from MM force field)</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment"># tinkersuf  = String that comes after the XYZ coordinates in TINKER .xyz or .arc files</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment"># resid      = Residue IDs (can come from MM coordinate file)</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment"># resname    = Residue names</span></div>
<div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a5daa68e835dcb9877d6c3f2fb559b54b">  120</a></span>&#160;AtomVariableNames = set([<span class="stringliteral">&#39;elem&#39;</span>, <span class="stringliteral">&#39;partial_charge&#39;</span>, <span class="stringliteral">&#39;atomname&#39;</span>, <span class="stringliteral">&#39;atomtype&#39;</span>, <span class="stringliteral">&#39;tinkersuf&#39;</span>, <span class="stringliteral">&#39;resid&#39;</span>, <span class="stringliteral">&#39;resname&#39;</span>, <span class="stringliteral">&#39;qcsuf&#39;</span>, <span class="stringliteral">&#39;qm_ghost&#39;</span>, <span class="stringliteral">&#39;chain&#39;</span>, <span class="stringliteral">&#39;altloc&#39;</span>, <span class="stringliteral">&#39;icode&#39;</span>])</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">#=========================================#</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">#| This can be any data attribute we     |#</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">#| want but it&#39;s usually some property   |#</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">#| of the molecule not along the frame   |#</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">#| atom axis.                            |#</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">#=========================================#</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment"># bonds      = A list of 2-tuples representing bonds.  Carefully pruned when atom subselection is done.</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment"># fnm        = The file name that the class was built from</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment"># qcrems     = The Q-Chem &#39;rem&#39; variables stored as a list of OrderedDicts</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment"># qctemplate = The Q-Chem template file, not including the coordinates or rem variables</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment"># charge     = The net charge of the molecule</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment"># mult       = The spin multiplicity of the molecule</span></div>
<div class="line"><a name="l00133"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a38e1c99e9567fe42b792af43db9b7488">  133</a></span>&#160;MetaVariableNames = set([<span class="stringliteral">&#39;fnm&#39;</span>, <span class="stringliteral">&#39;ftype&#39;</span>, <span class="stringliteral">&#39;qcrems&#39;</span>, <span class="stringliteral">&#39;qctemplate&#39;</span>, <span class="stringliteral">&#39;qcerr&#39;</span>, <span class="stringliteral">&#39;charge&#39;</span>, <span class="stringliteral">&#39;mult&#39;</span>, <span class="stringliteral">&#39;bonds&#39;</span>])</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment"># Variable names relevant to quantum calculations explicitly</span></div>
<div class="line"><a name="l00135"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#ab67efeab6049ec1f416b9ad1eed6ffcc">  135</a></span>&#160;QuantumVariableNames = set([<span class="stringliteral">&#39;qcrems&#39;</span>, <span class="stringliteral">&#39;qctemplate&#39;</span>, <span class="stringliteral">&#39;charge&#39;</span>, <span class="stringliteral">&#39;mult&#39;</span>, <span class="stringliteral">&#39;qcsuf&#39;</span>, <span class="stringliteral">&#39;qm_ghost&#39;</span>])</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment"># Superset of all variable names.</span></div>
<div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a8fcfb88fe12a9256b61980f3d4fe3b63">  137</a></span>&#160;AllVariableNames = QuantumVariableNames | AtomVariableNames | MetaVariableNames | FrameVariableNames</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment"># OrderedDict requires Python 2.7 or higher</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="keyword">import</span> os, sys, re, copy</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="keyword">import</span> numpy <span class="keyword">as</span> np</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="keyword">from</span> numpy <span class="keyword">import</span> sin, cos, arcsin, arccos</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="keyword">import</span> imp</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="keyword">import</span> itertools</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict, namedtuple, Counter</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="keyword">from</span> ctypes <span class="keyword">import</span> *</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="keyword">from</span> warnings <span class="keyword">import</span> warn</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment"># Covalent radii from Cordero et al. &#39;Covalent radii revisited&#39; Dalton Transactions 2008, 2832-2838.</span></div>
<div class="line"><a name="l00150"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a74f55a89a14ca676b5a06441d1fdab19">  150</a></span>&#160;Radii = [0.31, 0.28, <span class="comment"># H and He</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;         1.28, 0.96, 0.84, 0.76, 0.71, 0.66, 0.57, 0.58, <span class="comment"># First row elements</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;         1.66, 1.41, 1.21, 1.11, 1.07, 1.05, 1.02, 1.06, <span class="comment"># Second row elements</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;         2.03, 1.76, 1.70, 1.60, 1.53, 1.39, 1.61, 1.52, 1.50, </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;         1.24, 1.32, 1.22, 1.22, 1.20, 1.19, 1.20, 1.20, 1.16, <span class="comment"># Third row elements, K through Kr</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;         2.20, 1.95, 1.90, 1.75, 1.64, 1.54, 1.47, 1.46, 1.42, </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;         1.39, 1.45, 1.44, 1.42, 1.39, 1.39, 1.38, 1.39, 1.40, <span class="comment"># Fourth row elements, Rb through Xe</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;         2.44, 2.15, 2.07, 2.04, 2.03, 2.01, 1.99, 1.98, </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;         1.98, 1.96, 1.94, 1.92, 1.92, 1.89, 1.90, 1.87, <span class="comment"># Fifth row elements, s and f blocks</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;         1.87, 1.75, 1.70, 1.62, 1.51, 1.44, 1.41, 1.36, </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;         1.36, 1.32, 1.45, 1.46, 1.48, 1.40, 1.50, 1.50, <span class="comment"># Fifth row elements, d and p blocks</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;         2.60, 2.21, 2.15, 2.06, 2.00, 1.96, 1.90, 1.87, 1.80, 1.69] <span class="comment"># Sixth row elements</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment"># A list that gives you the element if you give it the atomic number, hence the &#39;none&#39; at the front.</span></div>
<div class="line"><a name="l00164"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a1c99a11e8a749468698c9af6361a8a4c">  164</a></span>&#160;Elements = [<span class="stringliteral">&quot;None&quot;</span>,<span class="stringliteral">&#39;H&#39;</span>,<span class="stringliteral">&#39;He&#39;</span>,</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            <span class="stringliteral">&#39;Li&#39;</span>,<span class="stringliteral">&#39;Be&#39;</span>,<span class="stringliteral">&#39;B&#39;</span>,<span class="stringliteral">&#39;C&#39;</span>,<span class="stringliteral">&#39;N&#39;</span>,<span class="stringliteral">&#39;O&#39;</span>,<span class="stringliteral">&#39;F&#39;</span>,<span class="stringliteral">&#39;Ne&#39;</span>,</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            <span class="stringliteral">&#39;Na&#39;</span>,<span class="stringliteral">&#39;Mg&#39;</span>,<span class="stringliteral">&#39;Al&#39;</span>,<span class="stringliteral">&#39;Si&#39;</span>,<span class="stringliteral">&#39;P&#39;</span>,<span class="stringliteral">&#39;S&#39;</span>,<span class="stringliteral">&#39;Cl&#39;</span>,<span class="stringliteral">&#39;Ar&#39;</span>,</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            <span class="stringliteral">&#39;K&#39;</span>,<span class="stringliteral">&#39;Ca&#39;</span>,<span class="stringliteral">&#39;Sc&#39;</span>,<span class="stringliteral">&#39;Ti&#39;</span>,<span class="stringliteral">&#39;V&#39;</span>,<span class="stringliteral">&#39;Cr&#39;</span>,<span class="stringliteral">&#39;Mn&#39;</span>,<span class="stringliteral">&#39;Fe&#39;</span>,<span class="stringliteral">&#39;Co&#39;</span>,<span class="stringliteral">&#39;Ni&#39;</span>,<span class="stringliteral">&#39;Cu&#39;</span>,<span class="stringliteral">&#39;Zn&#39;</span>,<span class="stringliteral">&#39;Ga&#39;</span>,<span class="stringliteral">&#39;Ge&#39;</span>,<span class="stringliteral">&#39;As&#39;</span>,<span class="stringliteral">&#39;Se&#39;</span>,<span class="stringliteral">&#39;Br&#39;</span>,<span class="stringliteral">&#39;Kr&#39;</span>,</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            <span class="stringliteral">&#39;Rb&#39;</span>,<span class="stringliteral">&#39;Sr&#39;</span>,<span class="stringliteral">&#39;Y&#39;</span>,<span class="stringliteral">&#39;Zr&#39;</span>,<span class="stringliteral">&#39;Nb&#39;</span>,<span class="stringliteral">&#39;Mo&#39;</span>,<span class="stringliteral">&#39;Tc&#39;</span>,<span class="stringliteral">&#39;Ru&#39;</span>,<span class="stringliteral">&#39;Rh&#39;</span>,<span class="stringliteral">&#39;Pd&#39;</span>,<span class="stringliteral">&#39;Ag&#39;</span>,<span class="stringliteral">&#39;Cd&#39;</span>,<span class="stringliteral">&#39;In&#39;</span>,<span class="stringliteral">&#39;Sn&#39;</span>,<span class="stringliteral">&#39;Sb&#39;</span>,<span class="stringliteral">&#39;Te&#39;</span>,<span class="stringliteral">&#39;I&#39;</span>,<span class="stringliteral">&#39;Xe&#39;</span>,</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            <span class="stringliteral">&#39;Cs&#39;</span>,<span class="stringliteral">&#39;Ba&#39;</span>,<span class="stringliteral">&#39;La&#39;</span>,<span class="stringliteral">&#39;Ce&#39;</span>,<span class="stringliteral">&#39;Pr&#39;</span>,<span class="stringliteral">&#39;Nd&#39;</span>,<span class="stringliteral">&#39;Pm&#39;</span>,<span class="stringliteral">&#39;Sm&#39;</span>,<span class="stringliteral">&#39;Eu&#39;</span>,<span class="stringliteral">&#39;Gd&#39;</span>,<span class="stringliteral">&#39;Tb&#39;</span>,<span class="stringliteral">&#39;Dy&#39;</span>,<span class="stringliteral">&#39;Ho&#39;</span>,<span class="stringliteral">&#39;Er&#39;</span>,<span class="stringliteral">&#39;Tm&#39;</span>,<span class="stringliteral">&#39;Yb&#39;</span>,</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            <span class="stringliteral">&#39;Lu&#39;</span>,<span class="stringliteral">&#39;Hf&#39;</span>,<span class="stringliteral">&#39;Ta&#39;</span>,<span class="stringliteral">&#39;W&#39;</span>,<span class="stringliteral">&#39;Re&#39;</span>,<span class="stringliteral">&#39;Os&#39;</span>,<span class="stringliteral">&#39;Ir&#39;</span>,<span class="stringliteral">&#39;Pt&#39;</span>,<span class="stringliteral">&#39;Au&#39;</span>,<span class="stringliteral">&#39;Hg&#39;</span>,<span class="stringliteral">&#39;Tl&#39;</span>,<span class="stringliteral">&#39;Pb&#39;</span>,<span class="stringliteral">&#39;Bi&#39;</span>,<span class="stringliteral">&#39;Po&#39;</span>,<span class="stringliteral">&#39;At&#39;</span>,<span class="stringliteral">&#39;Rn&#39;</span>,</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            <span class="stringliteral">&#39;Fr&#39;</span>,<span class="stringliteral">&#39;Ra&#39;</span>,<span class="stringliteral">&#39;Ac&#39;</span>,<span class="stringliteral">&#39;Th&#39;</span>,<span class="stringliteral">&#39;Pa&#39;</span>,<span class="stringliteral">&#39;</span><span class="stringliteral">U&#39;,&#39;</span>Np&#39;,&#39;Pu&#39;,&#39;Am&#39;,&#39;Cm&#39;,&#39;Bk&#39;,&#39;Cf&#39;,&#39;Es&#39;,&#39;Fm&#39;,&#39;Md&#39;,&#39;No&#39;,&#39;Lr&#39;,&#39;Rf&#39;,&#39;Db&#39;,&#39;Sg&#39;,&#39;Bh&#39;,&#39;Hs&#39;,&#39;Mt&#39;]</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment"># Dictionary of atomic masses ; also serves as the list of elements (periodic table)</span></div>
<div class="line"><a name="l00174"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#adc5040ec456762f2ac240fb08febbfdd">  174</a></span>&#160;PeriodicTable = OrderedDict([(<span class="stringliteral">&#39;H&#39;</span> , 1.0079), (<span class="stringliteral">&#39;He&#39;</span> , 4.0026), </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                             (<span class="stringliteral">&#39;Li&#39;</span> , 6.941), (<span class="stringliteral">&#39;Be&#39;</span> , 9.0122), (<span class="stringliteral">&#39;B&#39;</span> , 10.811), (<span class="stringliteral">&#39;C&#39;</span> , 12.0107), (<span class="stringliteral">&#39;N&#39;</span> , 14.0067), (<span class="stringliteral">&#39;O&#39;</span> , 15.9994), (<span class="stringliteral">&#39;F&#39;</span> , 18.9984), (<span class="stringliteral">&#39;Ne&#39;</span> , 20.1797),</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                             (<span class="stringliteral">&#39;Na&#39;</span> , 22.9897), (<span class="stringliteral">&#39;Mg&#39;</span> , 24.305), (<span class="stringliteral">&#39;Al&#39;</span> , 26.9815), (<span class="stringliteral">&#39;Si&#39;</span> , 28.0855), (<span class="stringliteral">&#39;P&#39;</span> , 30.9738), (<span class="stringliteral">&#39;S&#39;</span> , 32.065), (<span class="stringliteral">&#39;Cl&#39;</span> , 35.453), (<span class="stringliteral">&#39;Ar&#39;</span> , 39.948), </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                             (<span class="stringliteral">&#39;K&#39;</span> , 39.0983), (<span class="stringliteral">&#39;Ca&#39;</span> , 40.078), (<span class="stringliteral">&#39;Sc&#39;</span> , 44.9559), (<span class="stringliteral">&#39;Ti&#39;</span> , 47.867), (<span class="stringliteral">&#39;V&#39;</span> , 50.9415), (<span class="stringliteral">&#39;Cr&#39;</span> , 51.9961), (<span class="stringliteral">&#39;Mn&#39;</span> , 54.938), (<span class="stringliteral">&#39;Fe&#39;</span> , 55.845), (<span class="stringliteral">&#39;Co&#39;</span> , 58.9332), </div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                             (<span class="stringliteral">&#39;Ni&#39;</span> , 58.6934), (<span class="stringliteral">&#39;Cu&#39;</span> , 63.546), (<span class="stringliteral">&#39;Zn&#39;</span> , 65.39), (<span class="stringliteral">&#39;Ga&#39;</span> , 69.723), (<span class="stringliteral">&#39;Ge&#39;</span> , 72.64), (<span class="stringliteral">&#39;As&#39;</span> , 74.9216), (<span class="stringliteral">&#39;Se&#39;</span> , 78.96), (<span class="stringliteral">&#39;Br&#39;</span> , 79.904), (<span class="stringliteral">&#39;Kr&#39;</span> , 83.8), </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                             (<span class="stringliteral">&#39;Rb&#39;</span> , 85.4678), (<span class="stringliteral">&#39;Sr&#39;</span> , 87.62), (<span class="stringliteral">&#39;Y&#39;</span> , 88.9059), (<span class="stringliteral">&#39;Zr&#39;</span> , 91.224), (<span class="stringliteral">&#39;Nb&#39;</span> , 92.9064), (<span class="stringliteral">&#39;Mo&#39;</span> , 95.94), (<span class="stringliteral">&#39;Tc&#39;</span> , 98), (<span class="stringliteral">&#39;Ru&#39;</span> , 101.07), (<span class="stringliteral">&#39;Rh&#39;</span> , 102.9055), </div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                             (<span class="stringliteral">&#39;Pd&#39;</span> , 106.42), (<span class="stringliteral">&#39;Ag&#39;</span> , 107.8682), (<span class="stringliteral">&#39;Cd&#39;</span> , 112.411), (<span class="stringliteral">&#39;In&#39;</span> , 114.818), (<span class="stringliteral">&#39;Sn&#39;</span> , 118.71), (<span class="stringliteral">&#39;Sb&#39;</span> , 121.76), (<span class="stringliteral">&#39;Te&#39;</span> , 127.6), (<span class="stringliteral">&#39;I&#39;</span> , 126.9045), (<span class="stringliteral">&#39;Xe&#39;</span> , 131.293), </div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                             (<span class="stringliteral">&#39;Cs&#39;</span> , 132.9055), (<span class="stringliteral">&#39;Ba&#39;</span> , 137.327), (<span class="stringliteral">&#39;La&#39;</span> , 138.9055), (<span class="stringliteral">&#39;Ce&#39;</span> , 140.116), (<span class="stringliteral">&#39;Pr&#39;</span> , 140.9077), (<span class="stringliteral">&#39;Nd&#39;</span> , 144.24), (<span class="stringliteral">&#39;Pm&#39;</span> , 145), (<span class="stringliteral">&#39;Sm&#39;</span> , 150.36), </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                             (<span class="stringliteral">&#39;Eu&#39;</span> , 151.964), (<span class="stringliteral">&#39;Gd&#39;</span> , 157.25), (<span class="stringliteral">&#39;Tb&#39;</span> , 158.9253), (<span class="stringliteral">&#39;Dy&#39;</span> , 162.5), (<span class="stringliteral">&#39;Ho&#39;</span> , 164.9303), (<span class="stringliteral">&#39;Er&#39;</span> , 167.259), (<span class="stringliteral">&#39;Tm&#39;</span> , 168.9342), (<span class="stringliteral">&#39;Yb&#39;</span> , 173.04), </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                             (<span class="stringliteral">&#39;Lu&#39;</span> , 174.967), (<span class="stringliteral">&#39;Hf&#39;</span> , 178.49), (<span class="stringliteral">&#39;Ta&#39;</span> , 180.9479), (<span class="stringliteral">&#39;W&#39;</span> , 183.84), (<span class="stringliteral">&#39;Re&#39;</span> , 186.207), (<span class="stringliteral">&#39;Os&#39;</span> , 190.23), (<span class="stringliteral">&#39;Ir&#39;</span> , 192.217), (<span class="stringliteral">&#39;Pt&#39;</span> , 195.078), </div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                             (<span class="stringliteral">&#39;Au&#39;</span> , 196.9665), (<span class="stringliteral">&#39;Hg&#39;</span> , 200.59), (<span class="stringliteral">&#39;Tl&#39;</span> , 204.3833), (<span class="stringliteral">&#39;Pb&#39;</span> , 207.2), (<span class="stringliteral">&#39;Bi&#39;</span> , 208.9804), (<span class="stringliteral">&#39;Po&#39;</span> , 209), (<span class="stringliteral">&#39;At&#39;</span> , 210), (<span class="stringliteral">&#39;Rn&#39;</span> , 222), </div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                             (<span class="stringliteral">&#39;Fr&#39;</span> , 223), (<span class="stringliteral">&#39;Ra&#39;</span> , 226), (<span class="stringliteral">&#39;Ac&#39;</span> , 227), (<span class="stringliteral">&#39;Th&#39;</span> , 232.0381), (<span class="stringliteral">&#39;Pa&#39;</span> , 231.0359), (<span class="stringliteral">&#39;</span><span class="stringliteral">U&#39; , 238.0289), (&#39;</span>Np&#39; , 237), (&#39;Pu&#39; , 244), </div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                             (<span class="stringliteral">&#39;Am&#39;</span> , 243), (<span class="stringliteral">&#39;Cm&#39;</span> , 247), (<span class="stringliteral">&#39;Bk&#39;</span> , 247), (<span class="stringliteral">&#39;Cf&#39;</span> , 251), (<span class="stringliteral">&#39;Es&#39;</span> , 252), (<span class="stringliteral">&#39;Fm&#39;</span> , 257), (<span class="stringliteral">&#39;Md&#39;</span> , 258), (<span class="stringliteral">&#39;No&#39;</span> , 259), </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                             (<span class="stringliteral">&#39;Lr&#39;</span> , 262), (<span class="stringliteral">&#39;Rf&#39;</span> , 261), (<span class="stringliteral">&#39;Db&#39;</span> , 262), (<span class="stringliteral">&#39;Sg&#39;</span> , 266), (<span class="stringliteral">&#39;Bh&#39;</span> , 264), (<span class="stringliteral">&#39;Hs&#39;</span> , 277), (<span class="stringliteral">&#39;Mt&#39;</span> , 268)])</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div>
<div class="line"><a name="l00189"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#af28de4693e5b8e82df900d0ac3c6c370">  189</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#af28de4693e5b8e82df900d0ac3c6c370">getElement</a>(mass):</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordflow">return</span> PeriodicTable.keys()[np.argmin([np.abs(m-mass) <span class="keywordflow">for</span> m <span class="keywordflow">in</span> PeriodicTable.values()])]</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#a7429f0c377d6396711c128f6590ef810">elem_from_atomname</a>(atomname):</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="stringliteral">&quot;&quot;&quot; Given an atom name, attempt to get the element in most cases. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00194"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a7429f0c377d6396711c128f6590ef810">  194</a></span>&#160;    <span class="keywordflow">return</span> re.search(<span class="stringliteral">&#39;[A-Z][a-z]*&#39;</span>,atomname).group(0)</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="keywordflow">if</span> <span class="stringliteral">&quot;forcebalance&quot;</span> <span class="keywordflow">in</span> __name__:</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="comment">#============================#</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="comment">#| DCD read/write functions |#</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="comment">#============================#</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="comment"># Try to load _dcdlib.so either from a directory in the LD_LIBRARY_PATH</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="comment"># or from the same directory as this module.</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordflow">try</span>: _dcdlib = CDLL(<span class="stringliteral">&quot;_dcdlib.so&quot;</span>)</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordflow">except</span>:</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="keywordflow">try</span>: _dcdlib = CDLL(os.path.join(imp.find_module(__name__.split(<span class="stringliteral">&#39;.&#39;</span>)[0])[1],<span class="stringliteral">&quot;_dcdlib.so&quot;</span>))</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <span class="keywordflow">except</span>: </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            warn(<span class="stringliteral">&#39;The dcdlib module cannot be imported (Cannot read/write DCD files)&#39;</span>)</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="comment">#============================#</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="comment">#| PDB read/write functions |#</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="comment">#============================#</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">try</span>: <span class="keyword">from</span> PDB <span class="keyword">import</span> *</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordflow">except</span>: </div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        warn(<span class="stringliteral">&#39;The pdb module cannot be miported (Cannot read/write PDB files)&#39;</span>)</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    </div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="comment">#=============================#</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="comment">#| Mol2 read/write functions |#</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">#=============================#</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keywordflow">try</span>: <span class="keyword">import</span> Mol2</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keywordflow">except</span>: </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        warn(<span class="stringliteral">&#39;The Mol2 module cannot be imported (Cannot read/write Mol2 files)&#39;</span>)</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="comment">#==============================#</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="comment">#| OpenMM interface functions |#</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="comment">#==============================#</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordflow">try</span>: </div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacesimtk_1_1unit.html">simtk.unit</a> <span class="keyword">import</span> *</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacesimtk_1_1openmm.html">simtk.openmm</a> <span class="keyword">import</span> *</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="keyword">from</span> <a class="code" href="namespacesimtk_1_1openmm_1_1app.html">simtk.openmm.app</a> <span class="keyword">import</span> *</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keywordflow">except</span>: </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        warn(<span class="stringliteral">&#39;The OpenMM modules cannot be imported (Cannot interface with OpenMM)&#39;</span>)</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">#===========================#</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">#| Convenience subroutines |#</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">#===========================#</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">## One bohr equals this many angstroms</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;bohrang = 0.529177249</div>
<div class="line"><a name="l00238"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a76af9edfbaaa8999680e32aafe1b1b61">  238</a></span>&#160;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#ab8464fea13fad2a506792c2f1d7c93f3">nodematch</a>(node1,node2):</div>
<div class="line"><a name="l00240"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#ab8464fea13fad2a506792c2f1d7c93f3">  240</a></span>&#160;    <span class="comment"># Matching two nodes of a graph.  Nodes are equivalent if the elements are the same</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">return</span> node1[<span class="stringliteral">&#39;e&#39;</span>] == node2[<span class="stringliteral">&#39;e&#39;</span>]</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#a0dd31eff88d2bed0884ab21a13261d42">isint</a>(word):</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;ONLY matches integers! If you have a decimal point? None shall pass!&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">return</span> re.match(<span class="stringliteral">&#39;^[-+]?[0-9]+$&#39;</span>,word)</div>
<div class="line"><a name="l00246"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a0dd31eff88d2bed0884ab21a13261d42">  246</a></span>&#160;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#afe989ffd119568047fc8265b1d329a70">isfloat</a>(word):</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;Matches ANY number; it can be a decimal, scientific notation, integer, or what have you&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="keywordflow">return</span> re.match(<span class="stringliteral">&#39;^[-+]?[0-9]*\.?[0-9]*([eEdD][-+]?[0-9]+)?$&#39;</span>,word)</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div>
<div class="line"><a name="l00251"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#afe989ffd119568047fc8265b1d329a70">  251</a></span>&#160;<span class="comment"># Used to get the white spaces in a split line.</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;splitter = re.compile(<span class="stringliteral">r&#39;(\s+|\S+)&#39;</span>)</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment"># Container for Bravais lattice vector.  Three cell lengths, three angles, three vectors, volume, and TINKER trig functions.</span></div>
<div class="line"><a name="l00255"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a09d04113accea9c88b084051c5de29d1">  255</a></span>&#160;Box = namedtuple(<span class="stringliteral">&#39;Box&#39;</span>,[<span class="stringliteral">&#39;a&#39;</span>,<span class="stringliteral">&#39;b&#39;</span>,<span class="stringliteral">&#39;c&#39;</span>,<span class="stringliteral">&#39;alpha&#39;</span>,<span class="stringliteral">&#39;beta&#39;</span>,<span class="stringliteral">&#39;gamma&#39;</span>,<span class="stringliteral">&#39;A&#39;</span>,<span class="stringliteral">&#39;B&#39;</span>,<span class="stringliteral">&#39;C&#39;</span>,<span class="stringliteral">&#39;V&#39;</span>])</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;radian = 180. / np.pi</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#aa2020b34bd18c73558cf39334b204981">CubicLattice</a>(a):</div>
<div class="line"><a name="l00258"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#aa761cf1cf260e15d0b03a6f61569c840">  258</a></span>&#160;    <span class="stringliteral">&quot;&quot;&quot; This function takes in three lattice lengths and three lattice angles, and tries to return a complete box specification. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00259"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a1ee5389ce8a9042e053c7972dbbfb005">  259</a></span>&#160;    b = a</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    c = a</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    alpha = 90</div>
<div class="line"><a name="l00262"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#aa2020b34bd18c73558cf39334b204981">  262</a></span>&#160;    beta = 90</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    gamma = 90</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    alph = alpha*np.pi/180</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    bet  = beta*np.pi/180</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    gamm = gamma*np.pi/180</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    v = np.sqrt(1 - cos(alph)**2 - cos(bet)**2 - cos(gamm)**2 + 2*cos(alph)*cos(bet)*cos(gamm))</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    Mat = np.matrix([[a, b*cos(gamm), c*cos(bet)],</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                  [0, b*sin(gamm), c*((cos(alph)-cos(bet)*cos(gamm))/sin(gamm))],</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                  [0, 0, c*v/sin(gamm)]])</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    L1 = Mat*np.matrix([[1],[0],[0]])</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    L2 = Mat*np.matrix([[0],[1],[0]])</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    L3 = Mat*np.matrix([[0],[0],[1]])</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespaceforcebalance_1_1molecule.html#aa761cf1cf260e15d0b03a6f61569c840">Box</a>(a,b,c,alpha,beta,gamma,np.array(L1).flatten(),np.array(L2).flatten(),np.array(L3).flatten(),v*a*b*c)</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#a0a6e3e79b04534bf2e83d09def189444">BuildLatticeFromLengthsAngles</a>(a, b, c, alpha, beta, gamma):</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="stringliteral">&quot;&quot;&quot; This function takes in three lattice lengths and three lattice angles, and tries to return a complete box specification. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    alph = alpha*np.pi/180</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    bet  = beta*np.pi/180</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    gamm = gamma*np.pi/180</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    v = np.sqrt(1 - cos(alph)**2 - cos(bet)**2 - cos(gamm)**2 + 2*cos(alph)*cos(bet)*cos(gamm))</div>
<div class="line"><a name="l00282"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a0a6e3e79b04534bf2e83d09def189444">  282</a></span>&#160;    Mat = np.matrix([[a, b*cos(gamm), c*cos(bet)],</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                  [0, b*sin(gamm), c*((cos(alph)-cos(bet)*cos(gamm))/sin(gamm))],</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                  [0, 0, c*v/sin(gamm)]])</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    L1 = Mat*np.matrix([[1],[0],[0]])</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    L2 = Mat*np.matrix([[0],[1],[0]])</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    L3 = Mat*np.matrix([[0],[0],[1]])</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespaceforcebalance_1_1molecule.html#aa761cf1cf260e15d0b03a6f61569c840">Box</a>(a,b,c,alpha,beta,gamma,np.array(L1).flatten(),np.array(L2).flatten(),np.array(L3).flatten(),v*a*b*c)</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#a29fb1ac9324f4280f07c65baea339989">BuildLatticeFromVectors</a>(v1, v2, v3):</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="stringliteral">&quot;&quot;&quot; This function takes in three lattice vectors and tries to return a complete box specification. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    a = np.linalg.norm(v1)</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    b = np.linalg.norm(v2)</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    c = np.linalg.norm(v3)</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    alpha = arccos(np.dot(v2, v3) / np.linalg.norm(v2) / np.linalg.norm(v3)) * radian</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    beta  = arccos(np.dot(v1, v3) / np.linalg.norm(v1) / np.linalg.norm(v3)) * radian</div>
<div class="line"><a name="l00297"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a29fb1ac9324f4280f07c65baea339989">  297</a></span>&#160;    gamma = arccos(np.dot(v1, v2) / np.linalg.norm(v1) / np.linalg.norm(v2)) * radian</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    alph = alpha*np.pi/180</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    bet  = beta*np.pi/180</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    gamm = gamma*np.pi/180</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    v = np.sqrt(1 - cos(alph)**2 - cos(bet)**2 - cos(gamm)**2 + 2*cos(alph)*cos(bet)*cos(gamm))</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    Mat = np.matrix([[a, b*cos(gamm), c*cos(bet)],</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                  [0, b*sin(gamm), c*((cos(alph)-cos(bet)*cos(gamm))/sin(gamm))],</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                  [0, 0, c*v/sin(gamm)]])</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    L1 = Mat*np.matrix([[1],[0],[0]])</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    L2 = Mat*np.matrix([[0],[1],[0]])</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    L3 = Mat*np.matrix([[0],[0],[1]])</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespaceforcebalance_1_1molecule.html#aa761cf1cf260e15d0b03a6f61569c840">Box</a>(a,b,c,alpha,beta,gamma,np.array(L1).flatten(),np.array(L2).flatten(),np.array(L3).flatten(),v*a*b*c)</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">#===========================#</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">#|   Connectivity graph    |#</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">#|  Good for doing simple  |#</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">#|     topology tricks     |#</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">#===========================#</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;have_contact = 0</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keyword">import</span> networkx <span class="keyword">as</span> nx</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keyword">class </span><a class="code" href="classforcebalance_1_1molecule_1_1MyG.html">MyG</a>(nx.Graph):</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <span class="keyword">def </span>__init__(self):</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            super(MyG,self).__init__()</div>
<div class="line"><a name="l00321"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a56640bd990a2e85f43fdba20b61cb8b8">  321</a></span>&#160;            self.Alive = <span class="keyword">True</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        <span class="keyword">def </span>__eq__(self, other):</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            <span class="comment"># This defines whether two MyG objects are &quot;equal&quot; to one another.</span></div>
<div class="line"><a name="l00324"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1MyG.html">  324</a></span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1MyG.html#ad6a5334dbe95ecab760c2d76ec8610ea">Alive</a>:</div>
<div class="line"><a name="l00325"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1MyG.html#a15e0af39012f78688d87e538999275aa">  325</a></span>&#160;                <span class="keywordflow">return</span> <span class="keyword">False</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> other.Alive:</div>
<div class="line"><a name="l00327"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1MyG.html#ad6a5334dbe95ecab760c2d76ec8610ea">  327</a></span>&#160;                <span class="keywordflow">return</span> <span class="keyword">False</span></div>
<div class="line"><a name="l00328"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1MyG.html#a0d5915cec6b8fe13a23b50f5c1edc10a">  328</a></span>&#160;            <span class="keywordflow">return</span> nx.is_isomorphic(self,other,node_match=nodematch)</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1MyG.html#a5ae5e64f229f7833216a82969fa39b15">__hash__</a>(self):</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            <span class="stringliteral">&#39;&#39;&#39; The hash function is something we can use to discard two things that are obviously not equal.  Here we neglect the hash. &#39;&#39;&#39;</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            <span class="keywordflow">return</span> 1</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1MyG.html#a2a5ae00cf603aa8d887d4dcca8412834">L</a>(self):</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            <span class="stringliteral">&#39;&#39;&#39; Return a list of the sorted atom numbers in this graph. &#39;&#39;&#39;</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            <span class="keywordflow">return</span> sorted(self.nodes())</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1MyG.html#a56413ce7a4c8db075299f724bd9ad71f">AStr</a>(self):</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            <span class="stringliteral">&#39;&#39;&#39; Return a string of atoms, which serves as a rudimentary &#39;fingerprint&#39; : &#39;99,100,103,151&#39; . &#39;&#39;&#39;</span></div>
<div class="line"><a name="l00337"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1MyG.html#a5ae5e64f229f7833216a82969fa39b15">  337</a></span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&#39;,&#39;</span>.join([<span class="stringliteral">&#39;%i&#39;</span> % i <span class="keywordflow">for</span> i <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1MyG.html#a2a5ae00cf603aa8d887d4dcca8412834">L</a>()])</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1MyG.html#a2913983e3a4725dff2df4a39f30bfaad">e</a>(self):</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            <span class="stringliteral">&#39;&#39;&#39; Return an array of the elements.  For instance [&#39;H&#39; &#39;C&#39; &#39;C&#39; &#39;H&#39;]. &#39;&#39;&#39;</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            elems = nx.get_node_attributes(self,<span class="stringliteral">&#39;e&#39;</span>)</div>
<div class="line"><a name="l00341"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1MyG.html#a2a5ae00cf603aa8d887d4dcca8412834">  341</a></span>&#160;            <span class="keywordflow">return</span> [elems[i] <span class="keywordflow">for</span> i <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1MyG.html#a2a5ae00cf603aa8d887d4dcca8412834">L</a>()]</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1MyG.html#ab6c0598bb829c52b68aaa9c189211419">ef</a>(self):</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;            <span class="stringliteral">&#39;&#39;&#39; Create an Empirical Formula &#39;&#39;&#39;</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;            Formula = list(self.<a class="code" href="classforcebalance_1_1molecule_1_1MyG.html#a2913983e3a4725dff2df4a39f30bfaad">e</a>())</div>
<div class="line"><a name="l00345"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1MyG.html#a56413ce7a4c8db075299f724bd9ad71f">  345</a></span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>.join([(<span class="stringliteral">&#39;%s%i&#39;</span> % (k, Formula.count(k)) <span class="keywordflow">if</span> Formula.count(k) &gt; 1 <span class="keywordflow">else</span> <span class="stringliteral">&#39;%s&#39;</span> % k) <span class="keywordflow">for</span> k <span class="keywordflow">in</span> sorted(set(Formula))])</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1MyG.html#a2fff1521f1d651835fe56f64340a7ddf">x</a>(self):</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            <span class="stringliteral">&#39;&#39;&#39; Get a list of the coordinates. &#39;&#39;&#39;</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            coors = nx.get_node_attributes(self,<span class="stringliteral">&#39;x&#39;</span>)</div>
<div class="line"><a name="l00349"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1MyG.html#a2913983e3a4725dff2df4a39f30bfaad">  349</a></span>&#160;            <span class="keywordflow">return</span> np.array([coors[i] <span class="keywordflow">for</span> i <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1MyG.html#a2a5ae00cf603aa8d887d4dcca8412834">L</a>()])</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        <span class="keyword">import</span> contact</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        have_contact = 1</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordflow">except</span>:</div>
<div class="line"><a name="l00354"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1MyG.html#ab6c0598bb829c52b68aaa9c189211419">  354</a></span>&#160;        warn(<span class="stringliteral">&quot;&#39;contact&#39; cannot be imported (topology tools will be slow.)&quot;</span>)</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="keywordflow">except</span>:</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    warn(<span class="stringliteral">&quot;NetworkX cannot be imported (topology tools won&#39;t work).  Most functionality should still work though.&quot;</span>)</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div>
<div class="line"><a name="l00359"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1MyG.html#a2fff1521f1d651835fe56f64340a7ddf">  359</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#a2eba3cad44138b3b10ea883240888412">format_xyz_coord</a>(element,xyz,tinker=False):</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="stringliteral">&quot;&quot;&quot; Print a line consisting of (element, x, y, z) in accordance with .xyz file format</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="stringliteral">    @param[in] element A chemical element of a single atom</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="stringliteral">    @param[in] xyz A 3-element array containing x, y, z coordinates of that atom</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordflow">if</span> tinker:</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;%-3s % 13.8f % 13.8f % 13.8f&quot;</span> % (element,xyz[0],xyz[1],xyz[2])</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;%-5s % 15.10f % 15.10f % 15.10f&quot;</span> % (element,xyz[0],xyz[1],xyz[2])</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#a41c13064e4285973aa6c49369d3d3390">format_gro_coord</a>(resid, resname, aname, seqno, xyz):</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="stringliteral">&quot;&quot;&quot; Print a line in accordance with .gro file format, with six decimal points of precision</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="stringliteral">    Nine decimal points of precision are necessary to get forces below 1e-3 kJ/mol/nm.</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="stringliteral">    @param[in] resid The number of the residue that the atom belongs to</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="stringliteral">    @param[in] resname The name of the residue that the atom belongs to</span></div>
<div class="line"><a name="l00378"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a2eba3cad44138b3b10ea883240888412">  378</a></span>&#160;<span class="stringliteral">    @param[in] aname The name of the atom</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="stringliteral">    @param[in] seqno The sequential number of the atom</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="stringliteral">    @param[in] xyz A 3-element array containing x, y, z coordinates of that atom</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;%5i%-5s%5s%5i % 13.9f % 13.9f % 13.9f&quot;</span> % (resid,resname,aname,seqno,xyz[0],xyz[1],xyz[2])</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#a4948e4662b8d2c8d515427d1bbb3d01e">format_xyzgen_coord</a>(element,xyzgen):</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="stringliteral">&quot;&quot;&quot; Print a line consisting of (element, p, q, r, s, t, ...) where</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="stringliteral">    (p, q, r) are arbitrary atom-wise data (this might happen, for</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="stringliteral">    instance, with atomic charges)</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="stringliteral">    @param[in] element A chemical element of a single atom</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="stringliteral">    @param[in] xyzgen A N-element array containing data for that atom</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;%-5s&quot;</span> + <span class="stringliteral">&#39; &#39;</span>.join([<span class="stringliteral">&quot;% 15.10f&quot;</span> % i] <span class="keywordflow">for</span> i <span class="keywordflow">in</span> xyzgen)</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div>
<div class="line"><a name="l00396"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a41c13064e4285973aa6c49369d3d3390">  396</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#ae25aa5331b3a2dd0e9d1e184380357db">format_gro_box</a>(box):</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="stringliteral">&quot;&quot;&quot; Print a line corresponding to the box vector in accordance with .gro file format</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="stringliteral">    @param[in] box Box NamedTuple</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keywordflow">if</span> box.alpha == 90.0 <span class="keywordflow">and</span> box.beta == 90.0 <span class="keywordflow">and</span> box.gamma == 90.0:</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&#39; &#39;</span>.join([<span class="stringliteral">&quot;% 13.9f&quot;</span> % (i/10) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> [box.a, box.b, box.c]])</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&#39; &#39;</span>.join([<span class="stringliteral">&quot;% 13.9f&quot;</span> % (i/10) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> [box.A[0], box.B[1], box.C[2], box.A[1], box.A[2], box.B[0], box.B[2], box.C[0], box.C[1]]])</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#a12b7bb398c2fa49a223f258ec7737483">is_gro_coord</a>(line):</div>
<div class="line"><a name="l00408"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a4948e4662b8d2c8d515427d1bbb3d01e">  408</a></span>&#160;    <span class="stringliteral">&quot;&quot;&quot; Determines whether a line contains GROMACS data or not</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="stringliteral">    @param[in] line The line to be tested</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    sline = line.split()</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="keywordflow">if</span> len(sline) == 6:</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <span class="keywordflow">return</span> all([<a class="code" href="namespaceforcebalance_1_1molecule.html#a0dd31eff88d2bed0884ab21a13261d42">isint</a>(sline[2]),<a class="code" href="namespaceforcebalance_1_1molecule.html#afe989ffd119568047fc8265b1d329a70">isfloat</a>(sline[3]),<a class="code" href="namespaceforcebalance_1_1molecule.html#afe989ffd119568047fc8265b1d329a70">isfloat</a>(sline[4]),<a class="code" href="namespaceforcebalance_1_1molecule.html#afe989ffd119568047fc8265b1d329a70">isfloat</a>(sline[5])])</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keywordflow">elif</span> len(sline) == 5:</div>
<div class="line"><a name="l00417"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#ae25aa5331b3a2dd0e9d1e184380357db">  417</a></span>&#160;        <span class="keywordflow">return</span> all([<a class="code" href="namespaceforcebalance_1_1molecule.html#a0dd31eff88d2bed0884ab21a13261d42">isint</a>(line[15:20]),<a class="code" href="namespaceforcebalance_1_1molecule.html#afe989ffd119568047fc8265b1d329a70">isfloat</a>(sline[2]),<a class="code" href="namespaceforcebalance_1_1molecule.html#afe989ffd119568047fc8265b1d329a70">isfloat</a>(sline[3]),<a class="code" href="namespaceforcebalance_1_1molecule.html#afe989ffd119568047fc8265b1d329a70">isfloat</a>(sline[4])])</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        <span class="keywordflow">return</span> 0</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#a838d85848bd817e801d0f5f6502217ef">is_charmm_coord</a>(line):</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="stringliteral">&quot;&quot;&quot; Determines whether a line contains CHARMM data or not</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="stringliteral">    @param[in] line The line to be tested</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    sline = line.split()</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">if</span> len(sline) &gt;= 7:</div>
<div class="line"><a name="l00429"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a12b7bb398c2fa49a223f258ec7737483">  429</a></span>&#160;        <span class="keywordflow">return</span> all([<a class="code" href="namespaceforcebalance_1_1molecule.html#a0dd31eff88d2bed0884ab21a13261d42">isint</a>(sline[0]), <a class="code" href="namespaceforcebalance_1_1molecule.html#a0dd31eff88d2bed0884ab21a13261d42">isint</a>(sline[1]), <a class="code" href="namespaceforcebalance_1_1molecule.html#afe989ffd119568047fc8265b1d329a70">isfloat</a>(sline[4]), <a class="code" href="namespaceforcebalance_1_1molecule.html#afe989ffd119568047fc8265b1d329a70">isfloat</a>(sline[5]), <a class="code" href="namespaceforcebalance_1_1molecule.html#afe989ffd119568047fc8265b1d329a70">isfloat</a>(sline[6])])</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        <span class="keywordflow">return</span> 0</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#aafc8c924eed4480fed8ddc9c474d3bc1">is_gro_box</a>(line):</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="stringliteral">&quot;&quot;&quot; Determines whether a line contains a GROMACS box vector or not</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="stringliteral">    @param[in] line The line to be tested</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    sline = line.split()</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordflow">if</span> len(sline) == 9 <span class="keywordflow">and</span> all([<a class="code" href="namespaceforcebalance_1_1molecule.html#afe989ffd119568047fc8265b1d329a70">isfloat</a>(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> sline]):</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <span class="keywordflow">return</span> 1</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keywordflow">elif</span> len(sline) == 3 <span class="keywordflow">and</span> all([<a class="code" href="namespaceforcebalance_1_1molecule.html#afe989ffd119568047fc8265b1d329a70">isfloat</a>(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> sline]):</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <span class="keywordflow">return</span> 1</div>
<div class="line"><a name="l00444"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a838d85848bd817e801d0f5f6502217ef">  444</a></span>&#160;    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <span class="keywordflow">return</span> 0</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#a4cdb2086978b281ed84cd66179c3f5b2">add_strip_to_mat</a>(mat,strip):</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    out = list(mat)</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keywordflow">if</span> out == [] <span class="keywordflow">and</span> strip != []: </div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        out = list(strip)</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="keywordflow">elif</span> out != [] <span class="keywordflow">and</span> strip != []:</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="keywordflow">for</span> (i,j) <span class="keywordflow">in</span> zip(out,strip):</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;            i += list(j)</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="keywordflow">return</span> out</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#a58c3f09152db4d1c6e1db9df29c60c43">pvec</a>(vec):</div>
<div class="line"><a name="l00457"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#aafc8c924eed4480fed8ddc9c474d3bc1">  457</a></span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>.join([<span class="stringliteral">&#39; % .10e&#39;</span> % i <span class="keywordflow">for</span> i <span class="keywordflow">in</span> list(vec.flatten())])</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#a7fe52c2928c7b0329882541bef2e34cd">grouper</a>(n, iterable):</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="stringliteral">&quot;&quot;&quot; Groups a big long iterable into groups of ten or what have you. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    args = [iter(iterable)] * n</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keywordflow">return</span> list([e <span class="keywordflow">for</span> e <span class="keywordflow">in</span> t <span class="keywordflow">if</span> e != <span class="keywordtype">None</span>] <span class="keywordflow">for</span> t <span class="keywordflow">in</span> itertools.izip_longest(*args))</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#a5f529179461765fadbd0a742cdc2c677">even_list</a>(totlen, splitsize):</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="stringliteral">&quot;&quot;&quot; Creates a list of number sequences divided as evenly as possible.  &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00466"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a4cdb2086978b281ed84cd66179c3f5b2">  466</a></span>&#160;    joblens = np.zeros(splitsize,dtype=int)</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    subsets = []</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(totlen):</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        joblens[i%splitsize] += 1</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    jobnow = 0</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(splitsize):</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        subsets.append(range(jobnow, jobnow + joblens[i]))</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        jobnow += joblens[i]</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordflow">return</span> subsets</div>
<div class="line"><a name="l00475"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a58c3f09152db4d1c6e1db9df29c60c43">  475</a></span>&#160;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="keyword">class </span><a class="code" href="classforcebalance_1_1molecule_1_1MolfileTimestep.html">MolfileTimestep</a>(Structure):</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="stringliteral">&quot;&quot;&quot; Wrapper for the timestep C structure used in molfile plugins. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    _fields_ = [(<span class="stringliteral">&quot;coords&quot;</span>,POINTER(c_float)), (<span class="stringliteral">&quot;velocities&quot;</span>,POINTER(c_float)),</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                (<span class="stringliteral">&quot;A&quot;</span>,c_float), (<span class="stringliteral">&quot;B&quot;</span>,c_float), (<span class="stringliteral">&quot;C&quot;</span>,c_float), (<span class="stringliteral">&quot;alpha&quot;</span>,c_float), </div>
<div class="line"><a name="l00480"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a7fe52c2928c7b0329882541bef2e34cd">  480</a></span>&#160;                (<span class="stringliteral">&quot;beta&quot;</span>,c_float), (<span class="stringliteral">&quot;gamma&quot;</span>,c_float), (<span class="stringliteral">&quot;physical_time&quot;</span>,c_double)]</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    </div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#a5b50df23cc4d0e617fdc56538f0bea63">both</a>(A, B, key):</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keywordflow">return</span> key <span class="keywordflow">in</span> A.Data <span class="keywordflow">and</span> key <span class="keywordflow">in</span> B.Data</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#a6f7c6217b1c64da309a8abd21dfdcf08">diff</a>(A, B, key):</div>
<div class="line"><a name="l00486"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a5f529179461765fadbd0a742cdc2c677">  486</a></span>&#160;    <span class="keywordflow">if</span> <span class="keywordflow">not</span> (key <span class="keywordflow">in</span> A.Data <span class="keywordflow">and</span> key <span class="keywordflow">in</span> B.Data) : <span class="keywordflow">return</span> <span class="keyword">False</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        <span class="keywordflow">if</span> type(A.Data[key]) <span class="keywordflow">is</span> np.ndarray:</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;            <span class="keywordflow">return</span> (A.Data[key] != B.Data[key]).any()</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <span class="keywordflow">elif</span> key == <span class="stringliteral">&#39;tinkersuf&#39;</span>:</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            <span class="keywordflow">return</span> [sorted([int(j) <span class="keywordflow">for</span> j <span class="keywordflow">in</span> i.split()]) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> A.Data[key]] != \</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                [sorted([int(j) <span class="keywordflow">for</span> j <span class="keywordflow">in</span> i.split()]) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> B.Data[key]]</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;            <span class="keywordflow">return</span> A.Data[key] != B.Data[key]</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#a75775be6563ad7f10695a9a45ff49ba9">either</a>(A, B, key):</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="keywordflow">return</span> key <span class="keywordflow">in</span> A.Data <span class="keywordflow">or</span> key <span class="keywordflow">in</span> B.Data</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div>
<div class="line"><a name="l00499"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1MolfileTimestep.html">  499</a></span>&#160;<span class="comment">#===========================#</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment">#|  Alignment subroutines  |#</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment">#| Moments added 08/03/12  |#</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">#===========================#</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#af02bf73765f34bbef81c4a5b000b86ce">EulerMatrix</a>(T1,T2,T3):</div>
<div class="line"><a name="l00504"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a5b50df23cc4d0e617fdc56538f0bea63">  504</a></span>&#160;    <span class="stringliteral">&quot;&quot;&quot; Constructs an Euler matrix from three Euler angles. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    DMat = np.matrix(np.zeros((3,3)))</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    DMat[0,0] = np.cos(T1)</div>
<div class="line"><a name="l00507"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a6f7c6217b1c64da309a8abd21dfdcf08">  507</a></span>&#160;    DMat[0,1] = np.sin(T1)</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    DMat[1,0] = -np.sin(T1)</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    DMat[1,1] = np.cos(T1)</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    DMat[2,2] = 1</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    CMat = np.matrix(np.zeros((3,3)))</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    CMat[0,0] = 1</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    CMat[1,1] = np.cos(T2)</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    CMat[1,2] = np.sin(T2)</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    CMat[2,1] = -np.sin(T2)</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    CMat[2,2] = np.cos(T2)</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    BMat = np.matrix(np.zeros((3,3)))</div>
<div class="line"><a name="l00518"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a75775be6563ad7f10695a9a45ff49ba9">  518</a></span>&#160;    BMat[0,0] = np.cos(T3)</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    BMat[0,1] = np.sin(T3)</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    BMat[1,0] = -np.sin(T3)</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    BMat[1,1] = np.cos(T3)</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    BMat[2,2] = 1</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    EMat = BMat*CMat*DMat</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keywordflow">return</span> np.matrix(EMat)</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#a8fcbb4a2b3470a85d25699b6f28a54fc">ComputeOverlap</a>(theta,elem,xyz1,xyz2):</div>
<div class="line"><a name="l00527"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#af02bf73765f34bbef81c4a5b000b86ce">  527</a></span>&#160;    <span class="stringliteral">&quot;&quot;&quot; </span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="stringliteral">    Computes an &#39;overlap&#39; between two molecules based on some</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="stringliteral">    fictitious density.  Good for fine-tuning alignment but gets stuck</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="stringliteral">    in local minima.</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    xyz2R = np.array(<a class="code" href="namespaceforcebalance_1_1molecule.html#af02bf73765f34bbef81c4a5b000b86ce">EulerMatrix</a>(theta[0],theta[1],theta[2])*np.matrix(xyz2.T)).T</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    Obj = 0.0</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    elem = np.array(elem)</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keywordflow">for</span> i <span class="keywordflow">in</span> set(elem):</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        <span class="keywordflow">for</span> j <span class="keywordflow">in</span> np.where(elem==i)[0]:</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            <span class="keywordflow">for</span> k <span class="keywordflow">in</span> np.where(elem==i)[0]:</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                dx = xyz1[j] - xyz2R[k]</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                dx2 = np.dot(dx,dx)</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                Obj -= np.exp(-0.5*dx2)</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="keywordflow">return</span> Obj</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#a9a58eb1746e51420f50da3f3a6d51485">AlignToDensity</a>(elem,xyz1,xyz2,binary=False):</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="stringliteral">&quot;&quot;&quot; </span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="stringliteral">    Computes a &quot;overlap density&quot; from two frames.</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="stringliteral">    This function can be called by AlignToMoments to get rid of inversion problems</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    grid = np.pi*np.array(list(itertools.product([0,1],[0,1],[0,1])))</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    ovlp = np.array([<a class="code" href="namespaceforcebalance_1_1molecule.html#a8fcbb4a2b3470a85d25699b6f28a54fc">ComputeOverlap</a>(e, elem, xyz1, xyz2) <span class="keywordflow">for</span> e <span class="keywordflow">in</span> grid]) <span class="comment"># Mao</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    t1 = grid[np.argmin(ovlp)]</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    xyz2R = (np.array(<a class="code" href="namespaceforcebalance_1_1molecule.html#af02bf73765f34bbef81c4a5b000b86ce">EulerMatrix</a>(t1[0],t1[1],t1[2])*np.matrix(xyz2.T)).T).copy()</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordflow">return</span> xyz2R</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#aa9ad9b92efa7bd3c1d589d62bbb8108e">AlignToMoments</a>(elem,xyz1,xyz2=None):</div>
<div class="line"><a name="l00555"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a8fcbb4a2b3470a85d25699b6f28a54fc">  555</a></span>&#160;    <span class="stringliteral">&quot;&quot;&quot;Pre-aligns molecules to &#39;moment of inertia&#39;.</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="stringliteral">    If xyz2 is passed in, it will assume that xyz1 is already</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="stringliteral">    aligned to the moment of inertia, and it simply does 180-degree</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="stringliteral">    rotations to make sure nothing is inverted.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    xyz = xyz1 <span class="keywordflow">if</span> xyz2 == <span class="keywordtype">None</span> <span class="keywordflow">else</span> xyz2</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    I = np.zeros((3,3))</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="keywordflow">for</span> i, xi <span class="keywordflow">in</span> enumerate(xyz):</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        I += (np.dot(xi,xi)*np.eye(3) - np.outer(xi,xi))</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        <span class="comment"># This is the original line from MSMBuilder, but we&#39;re choosing not to use masses</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        <span class="comment"># I += PeriodicTable[elem[i]]*(np.dot(xi,xi)*np.eye(3) - np.outer(xi,xi))</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    A, B = np.linalg.eig(I)</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="comment"># Sort eigenvectors by eigenvalue</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    BB   = B[:, np.argsort(A)]</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    determ = np.linalg.det(BB)</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    Thresh = 1e-3</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="keywordflow">if</span> np.abs(determ - 1.0) &gt; Thresh:</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        <span class="keywordflow">if</span> np.abs(determ + 1.0) &gt; Thresh:</div>
<div class="line"><a name="l00572"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a9a58eb1746e51420f50da3f3a6d51485">  572</a></span>&#160;            <span class="keywordflow">print</span> <span class="stringliteral">&quot;in AlignToMoments, determinant is % .3f&quot;</span> % determ</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        BB[:,2] *= -1</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    xyzr = np.array(np.matrix(BB).T * np.matrix(xyz).T).T.copy()</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="keywordflow">if</span> xyz2 != <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        xyzrr = <a class="code" href="namespaceforcebalance_1_1molecule.html#a9a58eb1746e51420f50da3f3a6d51485">AlignToDensity</a>(elem,xyz1,xyzr,binary=<span class="keyword">True</span>)</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <span class="keywordflow">return</span> xyzrr</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        <span class="keywordflow">return</span> xyzr</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#a08840b73e95bf34bf9ca7ea36ad0492d">get_rotate_translate</a>(matrix1,matrix2):</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="keyword">assert</span> np.shape(matrix1) == np.shape(matrix2), <span class="stringliteral">&#39;Matrices not of same dimensions&#39;</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    </div>
<div class="line"><a name="l00584"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#aa9ad9b92efa7bd3c1d589d62bbb8108e">  584</a></span>&#160;    <span class="comment"># Store number of rows</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    nrows = np.shape(matrix1)[0]</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    </div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="comment"># Getting centroid position for each selection</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    avg_pos1 = matrix1.sum(axis=0)/nrows</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    avg_pos2 = matrix2.sum(axis=0)/nrows</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="comment"># Translation of matrices</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    avg_matrix1 = matrix1-avg_pos1</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    avg_matrix2 = matrix2-avg_pos2</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="comment"># Covariance matrix</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    covar = np.dot(avg_matrix1.T,avg_matrix2)</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    </div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="comment"># Do the SVD in order to get rotation matrix</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    v,s,wt = np.linalg.svd(covar)</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    v = np.matrix(v)</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    wt = np.matrix(wt)</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    </div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="comment"># Rotation matrix</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="comment"># Transposition of v,wt</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    wvt = wt.T*v.T</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;</div>
<div class="line"><a name="l00607"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#a08840b73e95bf34bf9ca7ea36ad0492d">  607</a></span>&#160;    <span class="comment"># Ensure a right-handed coordinate system</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    d = np.matrix(np.eye(3))</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <span class="keywordflow">if</span> np.linalg.det(wvt) &lt; 0:</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        d[2,2] = -1.0</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    </div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    rot_matrix = np.array((wt.T*d*v.T).T)</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="comment"># rot_matrix = np.transpose(np.dot(np.transpose(wt),np.transpose(v)))</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    trans_matrix = avg_pos2-np.dot(avg_pos1,rot_matrix)</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keywordflow">return</span> trans_matrix, rot_matrix</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#ae76fc5d05f43acc6006a4d1733818d71">cartesian_product2</a>(arrays):</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="stringliteral">&quot;&quot;&quot; Form a Cartesian product of two NumPy arrays. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    la = len(arrays)</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    arr = np.empty([len(a) <span class="keywordflow">for</span> a <span class="keywordflow">in</span> arrays] + [la], dtype=np.int32)</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="keywordflow">for</span> i, a <span class="keywordflow">in</span> enumerate(np.ix_(*arrays)):</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        arr[...,i] = a</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keywordflow">return</span> arr.reshape(-1, la)</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="keyword">class </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html">Molecule</a>(object):</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="stringliteral">&quot;&quot;&quot; Lee-Ping&#39;s general file format conversion class.</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="stringliteral">    The purpose of this class is to read and write chemical file formats in a</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="stringliteral">    way that is convenient for research.  There are highly general file format</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="stringliteral">    converters out there (e.g. catdcd, openbabel) but I find that writing </span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="stringliteral">    my own class can be very helpful for specific purposes.  Here are some things</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="stringliteral">    this class can do:</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="stringliteral">    - Convert a .gro file to a .xyz file, or a .pdb file to a .dcd file.</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="stringliteral">    Data is stored internally, so any readable file can be converted into</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="stringliteral">    any writable file as long as there is sufficient information to write </span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="stringliteral">    that file.</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="stringliteral">    - Accumulate information from different files.  For example, we may read</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="stringliteral">    A.gro to get a list of coordinates, add quantum settings from a B.in file,</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="stringliteral">    and write A.in (this gives us a file that we can use to run QM calculations)</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="stringliteral">    - Concatenate two trajectories together as long as they&#39;re compatible.  This</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="stringliteral">    is done by creating two Molecule objects and then simply adding them.  Addition</span></div>
<div class="line"><a name="l00645"></a><span class="lineno"><a class="line" href="namespaceforcebalance_1_1molecule.html#ae76fc5d05f43acc6006a4d1733818d71">  645</a></span>&#160;<span class="stringliteral">    means two things:  (1) Information fields missing from each class, but present </span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="stringliteral">    in the other, are added to the sum, and (2) Appendable or per-frame fields</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="stringliteral">    (i.e. coordinates) are concatenated together.</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="stringliteral">    - Slice trajectories using reasonable Python language.  That is to</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="stringliteral">    say, MyMolecule[1:10] returns a new Molecule object that contains</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="stringliteral">    frames 1 through 9 (inclusive and numbered starting from zero.)</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="stringliteral">    Next step: Read in Q-Chem output data using this too!</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="stringliteral">    Special variables:  These variables cannot be set manually because</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="stringliteral">    there is a special method associated with getting them.</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="stringliteral">    na = The number of atoms.  You&#39;ll get this if you use MyMol.na or MyMol[&#39;na&#39;].</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="stringliteral">    na = The number of snapshots.  You&#39;ll get this if you use MyMol.ns or MyMol[&#39;ns&#39;].</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="stringliteral">    Unit system:  Angstroms.</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="keyword">def </span>__len__(self):</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Return the number of frames in the trajectory. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        L = -1</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        klast = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        Defined = <span class="keyword">False</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        <span class="keywordflow">for</span> key <span class="keywordflow">in</span> self.FrameKeys:</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;            Defined = <span class="keyword">True</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;            <span class="keywordflow">if</span> L != -1 <span class="keywordflow">and</span> len(self.Data[key]) != L:</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                self.repair(key, klast)</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;            L = len(self.Data[key])</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;            klast = key</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> Defined:</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;            <span class="keywordflow">return</span> 0</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        <span class="keywordflow">return</span> L</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="keyword">def </span>__getattr__(self, key):</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Whenever we try to get a class attribute, it first tries to get the attribute from the Data dictionary. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        <span class="keywordflow">if</span> key == <span class="stringliteral">&#39;ns&#39;</span>:</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;            <span class="keywordflow">return</span> len(self)</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        <span class="keywordflow">elif</span> key == <span class="stringliteral">&#39;na&#39;</span>: <span class="comment"># The &#39;na&#39; attribute is the number of atoms.</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;            L = -1</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;            klast = <span class="keywordtype">None</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;            Defined = <span class="keyword">False</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;            <span class="keywordflow">for</span> key <span class="keywordflow">in</span> self.AtomKeys:</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                Defined = <span class="keyword">True</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                <span class="keywordflow">if</span> L != -1 <span class="keywordflow">and</span> len(self.Data[key]) != L:</div>
<div class="line"><a name="l00691"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html">  691</a></span>&#160;                    self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#ac1cdd5bcc81b6a9f56d89fd8a4225211">repair</a>(key, klast)</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                L = len(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key])</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                klast = key</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            <span class="keywordflow">if</span> Defined:</div>
<div class="line"><a name="l00695"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a619d265b8c438f9ad87ac536e66ea9a0">  695</a></span>&#160;                <span class="keywordflow">return</span> L</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;            <span class="keywordflow">elif</span> <span class="stringliteral">&#39;xyzs&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                <span class="keywordflow">return</span> len(self.xyzs[0])</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                <span class="keywordflow">return</span> 0</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;            <span class="comment">#raise Exception(&#39;na is ill-defined if the molecule has no AtomKeys member variables.&#39;)</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        <span class="comment">## These attributes return a list of attribute names defined in this class that belong in the chosen category.</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        <span class="comment">## For example: self.FrameKeys should return set([&#39;xyzs&#39;,&#39;boxes&#39;]) if xyzs and boxes exist in self.Data</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        <span class="keywordflow">elif</span> key == <span class="stringliteral">&#39;FrameKeys&#39;</span>:</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;            <span class="keywordflow">return</span> set(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>) &amp; FrameVariableNames</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        <span class="keywordflow">elif</span> key == <span class="stringliteral">&#39;AtomKeys&#39;</span>:</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;            <span class="keywordflow">return</span> set(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>) &amp; AtomVariableNames</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        <span class="keywordflow">elif</span> key == <span class="stringliteral">&#39;MetaKeys&#39;</span>:</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            <span class="keywordflow">return</span> set(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>) &amp; MetaVariableNames</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        <span class="keywordflow">elif</span> key == <span class="stringliteral">&#39;QuantumKeys&#39;</span>:</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;            <span class="keywordflow">return</span> set(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>) &amp; QuantumVariableNames</div>
<div class="line"><a name="l00711"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a0c40cab05311928494dae9278e806240">  711</a></span>&#160;        <span class="keywordflow">elif</span> key <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;            <span class="keywordflow">return</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key]</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        <span class="keywordflow">return</span> getattr(super(Molecule, self), key)</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a3e716bb5d0b0450d5774cfc42a44c789">__setattr__</a>(self, key, value):</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Whenever we try to get a class attribute, it first tries to get the attribute from the Data dictionary. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        <span class="comment">## These attributes return a list of attribute names defined in this class, that belong in the chosen category.</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        <span class="comment">## For example: self.FrameKeys should return set([&#39;xyzs&#39;,&#39;boxes&#39;]) if xyzs and boxes exist in self.Data</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <span class="keywordflow">if</span> key <span class="keywordflow">in</span> AllVariableNames:</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;            self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key] = value</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        <span class="keywordflow">return</span> super(Molecule,self).<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a3e716bb5d0b0450d5774cfc42a44c789">__setattr__</a>(key, value)</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a0da69575f235955e5562e46d311a5536">__getitem__</a>(self, key):</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; </span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="stringliteral">        The Molecule class has list-like behavior, so we can get slices of it.</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="stringliteral">        If we say MyMolecule[0:10], then we&#39;ll return a copy of MyMolecule with frames 0 through 9.</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        <span class="keywordflow">if</span> isinstance(key, int) <span class="keywordflow">or</span> isinstance(key, slice) <span class="keywordflow">or</span> isinstance(key,np.ndarray):</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;            <span class="keywordflow">if</span> isinstance(key, int):</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                key = [key]</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;            New = <a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html">Molecule</a>()</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;            <span class="keywordflow">for</span> k <span class="keywordflow">in</span> self.FrameKeys:</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                <span class="keywordflow">if</span> k == <span class="stringliteral">&#39;boxes&#39;</span>:</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                    New.Data[k] = [j <span class="keywordflow">for</span> i, j <span class="keywordflow">in</span> enumerate(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[k]) <span class="keywordflow">if</span> i <span class="keywordflow">in</span> np.arange(len(self))[key]]</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                    New.Data[k] = list(np.array(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[k])[key])</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;            <span class="keywordflow">for</span> k <span class="keywordflow">in</span> self.AtomKeys | self.MetaKeys:</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                New.Data[k] = copy.deepcopy(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[k])</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;            <span class="keywordflow">return</span> New</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;            <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;getitem is not implemented for keys of type %s&#39;</span> % str(key))</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#ab4a7a79d738889528f3823b46244ea7d">__delitem__</a>(self, key):</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; </span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="stringliteral">        Similarly, in order to delete a frame, we simply perform item deletion on</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="stringliteral">        framewise variables.</span></div>
<div class="line"><a name="l00747"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a3e716bb5d0b0450d5774cfc42a44c789">  747</a></span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        <span class="keywordflow">for</span> k <span class="keywordflow">in</span> self.FrameKeys:</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;            del self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[k][key]</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a40360a68b3f2f14406d3524e62f0c0a1">__iter__</a>(self):</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; List-like behavior for looping over trajectories. Note that these values are returned by reference. </span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;<span class="stringliteral">        Note that this is intended to be more efficient than __getitem__, so when we loop over a trajectory,</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="stringliteral">        it&#39;s best to go &quot;for m in M&quot; instead of &quot;for i in range(len(M)): m = M[i]&quot;</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        <span class="keywordflow">for</span> frame <span class="keywordflow">in</span> range(self.ns):</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;            New = <a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html">Molecule</a>()</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;            <span class="keywordflow">for</span> k <span class="keywordflow">in</span> self.FrameKeys:</div>
<div class="line"><a name="l00759"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a0da69575f235955e5562e46d311a5536">  759</a></span>&#160;                New.Data[k] = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[k][frame]</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            <span class="keywordflow">for</span> k <span class="keywordflow">in</span> self.AtomKeys | self.MetaKeys:</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;                New.Data[k] = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[k]</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            <span class="keywordflow">yield</span> New</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a3e82ae8215555b543f1e5800b718c409">__add__</a>(self,other):</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Add method for Molecule objects. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        <span class="comment"># Check type of other</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(other,Molecule):</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;            <span class="keywordflow">raise</span> TypeError(<span class="stringliteral">&#39;A Molecule instance can only be added to another Molecule instance&#39;</span>)</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        <span class="comment"># Create the sum of the two classes by copying the first class.</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        Sum = <a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html">Molecule</a>()</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        <span class="keywordflow">for</span> key <span class="keywordflow">in</span> AtomVariableNames | MetaVariableNames:</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            <span class="comment"># Because a molecule object can only have one &#39;file name&#39; or &#39;file type&#39; attribute,</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;            <span class="comment"># we only keep the original one.  This isn&#39;t perfect, but that&#39;s okay.</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            <span class="keywordflow">if</span> key <span class="keywordflow">in</span> [<span class="stringliteral">&#39;fnm&#39;</span>, <span class="stringliteral">&#39;ftype&#39;</span>, <span class="stringliteral">&#39;bonds&#39;</span>] <span class="keywordflow">and</span> key <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;                Sum.Data[key] = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key]</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;            <span class="keywordflow">elif</span> <a class="code" href="namespaceforcebalance_1_1molecule.html#a6f7c6217b1c64da309a8abd21dfdcf08">diff</a>(self, other, key):</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;                <span class="keywordflow">for</span> i, j <span class="keywordflow">in</span> zip(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key], other.Data[key]):</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                    <span class="keywordflow">print</span> i, j, i==j</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;                <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;The data member called %s is not the same for these two objects&#39;</span> % key)</div>
<div class="line"><a name="l00780"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#ab4a7a79d738889528f3823b46244ea7d">  780</a></span>&#160;            <span class="keywordflow">elif</span> key <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;                Sum.Data[key] = copy.deepcopy(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key])</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            <span class="keywordflow">elif</span> key <span class="keywordflow">in</span> other.Data:</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;                Sum.Data[key] = copy.deepcopy(other.Data[key])</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        <span class="keywordflow">for</span> key <span class="keywordflow">in</span> FrameVariableNames:</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;            <span class="keywordflow">if</span> <a class="code" href="namespaceforcebalance_1_1molecule.html#a5b50df23cc4d0e617fdc56538f0bea63">both</a>(self, other, key):</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;                <span class="keywordflow">if</span> type(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key]) <span class="keywordflow">is</span> <span class="keywordflow">not</span> list:</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;                    <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;Key %s in self is a FrameKey, it must be a list&#39;</span> % key)</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                <span class="keywordflow">if</span> type(other.Data[key]) <span class="keywordflow">is</span> <span class="keywordflow">not</span> list:</div>
<div class="line"><a name="l00789"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a40360a68b3f2f14406d3524e62f0c0a1">  789</a></span>&#160;                    <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;Key %s in other is a FrameKey, it must be a list&#39;</span> % key)</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                Sum.Data[key] = list(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key] + other.Data[key])</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;            <span class="keywordflow">elif</span> <a class="code" href="namespaceforcebalance_1_1molecule.html#a75775be6563ad7f10695a9a45ff49ba9">either</a>(self, other, key):</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;                <span class="comment"># TINKER 6.3 compatibility - catch the specific case that one has a periodic box and the other doesn&#39;t.</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                <span class="keywordflow">if</span> key == <span class="stringliteral">&#39;boxes&#39;</span>:</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;                    <span class="keywordflow">if</span> key <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                        other.Data[<span class="stringliteral">&#39;boxes&#39;</span>] = [self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[<span class="stringliteral">&#39;boxes&#39;</span>][0] <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(other))]</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                    <span class="keywordflow">elif</span> key <span class="keywordflow">in</span> other.Data:</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;                        self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[<span class="stringliteral">&#39;boxes&#39;</span>] = [other.Data[<span class="stringliteral">&#39;boxes&#39;</span>][0] <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(self))]</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;                <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                    <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;Key %s is a FrameKey, must exist in both self and other for them to be added (for now).&#39;</span> % key)</div>
<div class="line"><a name="l00800"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a3e82ae8215555b543f1e5800b718c409">  800</a></span>&#160;        <span class="keywordflow">return</span> Sum</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160; </div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#ae1bcdf1cc78a6cc165de80bacc7b69c5">__iadd__</a>(self,other):</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Add method for Molecule objects. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        <span class="comment"># Check type of other</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(other,Molecule):</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;            <span class="keywordflow">raise</span> TypeError(<span class="stringliteral">&#39;A Molecule instance can only be added to another Molecule instance&#39;</span>)</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        <span class="comment"># Create the sum of the two classes by copying the first class.</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <span class="keywordflow">for</span> key <span class="keywordflow">in</span> AtomVariableNames | MetaVariableNames:</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;            <span class="keywordflow">if</span> key <span class="keywordflow">in</span> [<span class="stringliteral">&#39;fnm&#39;</span>, <span class="stringliteral">&#39;ftype&#39;</span>, <span class="stringliteral">&#39;bonds&#39;</span>]: <span class="keywordflow">pass</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;            <span class="keywordflow">elif</span> <a class="code" href="namespaceforcebalance_1_1molecule.html#a6f7c6217b1c64da309a8abd21dfdcf08">diff</a>(self, other, key):</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                <span class="keywordflow">for</span> i, j <span class="keywordflow">in</span> zip(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key], other.Data[key]):</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;                    <span class="keywordflow">print</span> i, j, i==j</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;The data member called %s is not the same for these two objects&#39;</span> % key)</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            <span class="comment"># Information from the other class is added to this class (if said info doesn&#39;t exist.)</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;            <span class="keywordflow">elif</span> key <span class="keywordflow">in</span> other.Data:</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;                self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key] = copy.deepcopy(other.Data[key])</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        <span class="comment"># FrameKeys must be a list.</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        <span class="keywordflow">for</span> key <span class="keywordflow">in</span> FrameVariableNames:</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;            <span class="keywordflow">if</span> <a class="code" href="namespaceforcebalance_1_1molecule.html#a5b50df23cc4d0e617fdc56538f0bea63">both</a>(self, other, key):</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                <span class="keywordflow">if</span> type(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key]) <span class="keywordflow">is</span> <span class="keywordflow">not</span> list:</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                    <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;Key %s in self is a FrameKey, it must be a list&#39;</span> % key)</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                <span class="keywordflow">if</span> type(other.Data[key]) <span class="keywordflow">is</span> <span class="keywordflow">not</span> list:</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                    <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;Key %s in other is a FrameKey, it must be a list&#39;</span> % key)</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key] += other.Data[key]</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;            <span class="keywordflow">elif</span> <a class="code" href="namespaceforcebalance_1_1molecule.html#a75775be6563ad7f10695a9a45ff49ba9">either</a>(self, other, key):</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;                <span class="comment"># TINKER 6.3 compatibility - catch the specific case that one has a periodic box and the other doesn&#39;t.</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;                <span class="keywordflow">if</span> key == <span class="stringliteral">&#39;boxes&#39;</span>:</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                    <span class="keywordflow">if</span> key <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;                        other.Data[<span class="stringliteral">&#39;boxes&#39;</span>] = [self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[<span class="stringliteral">&#39;boxes&#39;</span>][0] <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(other))]</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;                    <span class="keywordflow">elif</span> key <span class="keywordflow">in</span> other.Data:</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                        self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[<span class="stringliteral">&#39;boxes&#39;</span>] = [other.Data[<span class="stringliteral">&#39;boxes&#39;</span>][0] <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(self))]</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;                    <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;Key %s is a FrameKey, must exist in both self and other for them to be added (for now).&#39;</span> % key)</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        <span class="keywordflow">return</span> self</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#ac1cdd5bcc81b6a9f56d89fd8a4225211">repair</a>(self, key, klast):</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Attempt to repair trivial issues that would otherwise break the object. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        kthis = key <span class="keywordflow">if</span> len(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key]) &lt; len(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[klast]) <span class="keywordflow">else</span> klast</div>
<div class="line"><a name="l00839"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#ae1bcdf1cc78a6cc165de80bacc7b69c5">  839</a></span>&#160;        kother = klast <span class="keywordflow">if</span> len(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key]) &lt; len(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[klast]) <span class="keywordflow">else</span> key</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        diff = abs(len(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key]) - len(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[klast]))</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        <span class="keywordflow">if</span> kthis == <span class="stringliteral">&#39;comms&#39;</span>:</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;            <span class="comment"># Append empty comments if necessary because this causes way too many crashes.</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(diff): self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[<span class="stringliteral">&#39;comms&#39;</span>].<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a77417ff99b19f6d0b7c6f527e83fa7f1">append</a>(<span class="stringliteral">&#39;&#39;</span>)</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        <span class="keywordflow">elif</span> kthis == <span class="stringliteral">&#39;boxes&#39;</span> <span class="keywordflow">and</span> len(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[<span class="stringliteral">&#39;boxes&#39;</span>]) == 1:</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;            <span class="comment"># If we only have one box then we can fill in the rest of the trajectory.</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(diff): self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[<span class="stringliteral">&#39;boxes&#39;</span>].<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a77417ff99b19f6d0b7c6f527e83fa7f1">append</a>(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[<span class="stringliteral">&#39;boxes&#39;</span>][-1])</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;            <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;The keys %s and %s have different lengths (%i %i)&#39;</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;                            <span class="stringliteral">&#39;- this isn\&#39;t supposed to happen for two AtomKeys member variables.&#39;</span> \</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                                % (key, klast, len(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key]), len(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[klast])))</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a77417ff99b19f6d0b7c6f527e83fa7f1">append</a>(self,other):</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        self += other</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a3f8233f4e9911d7af0f17ca66c16ff92">__init__</a>(self, fnm = None, ftype = None, positive_resid=True, build_topology = True, **kwargs):</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; To create the Molecule object, we simply define the table of</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="stringliteral">        file reading/writing functions and read in a file if it is</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;<span class="stringliteral">        provided.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        <span class="comment">#=========================================#</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        <span class="comment">#|           File type tables            |#</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        <span class="comment">#|    Feel free to edit these as more    |#</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        <span class="comment">#|      readers / writers are added      |#</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        <span class="comment">#=========================================#</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        <span class="comment">## The table of file readers</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a35600d98f150597c9d9ac5129e01bd8d">Read_Tab</a> = {<span class="stringliteral">&#39;gaussian&#39;</span> : self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a861feda06e1f60ab25c45eaaaf228cfc">read_com</a>,</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;                         <span class="stringliteral">&#39;gromacs&#39;</span>  : self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a963a4382dc59ebd8dd9ee2064843e355">read_gro</a>,</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                         <span class="stringliteral">&#39;charmm&#39;</span>   : self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a8b8d3444945cab760288f28996787855">read_charmm</a>,</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;                         <span class="stringliteral">&#39;dcd&#39;</span>      : self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#ad8fa6cc7424aae00ee3f5bb87d28e037">read_dcd</a>,</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;                         <span class="stringliteral">&#39;mdcrd&#39;</span>    : self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#ab1b56d66b7673b2631e2cee013a80b93">read_mdcrd</a>,</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                         <span class="stringliteral">&#39;pdb&#39;</span>      : self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#afadc87c0cc32dc73558cd901a4c64dd4">read_pdb</a>,</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                         <span class="stringliteral">&#39;xyz&#39;</span>      : self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a15a7a0e0377e6dfd52e60c77fbc583c1">read_xyz</a>,</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;                         <span class="stringliteral">&#39;mol2&#39;</span>     : self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a14b1fbc70a083d21fd016b5dd854fd56">read_mol2</a>,</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;                         <span class="stringliteral">&#39;qcin&#39;</span>     : self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a003b182b54de4473c4691ae1474b1ada">read_qcin</a>,</div>
<div class="line"><a name="l00874"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#ac1cdd5bcc81b6a9f56d89fd8a4225211">  874</a></span>&#160;                         <span class="stringliteral">&#39;qcout&#39;</span>    : self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a8c9e71843e7123c57c43c24af2d84f25">read_qcout</a>,</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;                         <span class="stringliteral">&#39;qcesp&#39;</span>    : self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a27fb6201b435a3b205ae62f605256f3d">read_qcesp</a>,</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                         <span class="stringliteral">&#39;qdata&#39;</span>    : self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a1d34af6a7d22dd34850d58efe8595b20">read_qdata</a>,</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                         <span class="stringliteral">&#39;tinker&#39;</span>   : self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#aeb5983ae61079198f077f55e448e2c32">read_arc</a>}</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;        <span class="comment">## The table of file writers</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;        self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a85310a28c678cb386f9d2b584b24320d">Write_Tab</a> = {<span class="stringliteral">&#39;gromacs&#39;</span> : self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a503eae2cee228e4cc5fc736504714925">write_gro</a>,</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                          <span class="stringliteral">&#39;xyz&#39;</span>     : self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#adc6620e8287edabe161442de12295f75">write_xyz</a>,</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                          <span class="stringliteral">&#39;molproq&#39;</span> : self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#aba14226f272f91c91ecf7060ff136a2b">write_molproq</a>,</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                          <span class="stringliteral">&#39;dcd&#39;</span>     : self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a0dee435704418bf51199d6bab6d92249">write_dcd</a>,</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                          <span class="stringliteral">&#39;mdcrd&#39;</span>   : self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#aab5ea35ab9d68559fd6ea7b747c2bddb">write_mdcrd</a>,</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                          <span class="stringliteral">&#39;pdb&#39;</span>     : self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a47082443566cd50add3f2ec20af9cc10">write_pdb</a>,</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;                          <span class="stringliteral">&#39;qcin&#39;</span>    : self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#af46b2ba6ef777cf8301bc16e157c724d">write_qcin</a>,</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;                          <span class="stringliteral">&#39;qdata&#39;</span>   : self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a1ef6aefd3218f8ab3f9dc2b37e602fbf">write_qdata</a>,</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;                          <span class="stringliteral">&#39;tinker&#39;</span>  : self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a95782abfb36e7080a1b98bfad2ced4f3">write_arc</a>}</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        <span class="comment">## A funnel dictionary that takes redundant file types</span></div>
<div class="line"><a name="l00889"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a77417ff99b19f6d0b7c6f527e83fa7f1">  889</a></span>&#160;        <span class="comment">## and maps them down to a few.</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a491b10f21e93f841a770088402a13924">Funnel</a>    = {<span class="stringliteral">&#39;gromos&#39;</span>  : <span class="stringliteral">&#39;gromacs&#39;</span>,</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;                          <span class="stringliteral">&#39;gro&#39;</span>     : <span class="stringliteral">&#39;gromacs&#39;</span>,</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;                          <span class="stringliteral">&#39;g96&#39;</span>     : <span class="stringliteral">&#39;gromacs&#39;</span>,</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;                          <span class="stringliteral">&#39;gmx&#39;</span>     : <span class="stringliteral">&#39;gromacs&#39;</span>,</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                          <span class="stringliteral">&#39;in&#39;</span>      : <span class="stringliteral">&#39;qcin&#39;</span>,</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;                          <span class="stringliteral">&#39;qcin&#39;</span>    : <span class="stringliteral">&#39;qcin&#39;</span>,</div>
<div class="line"><a name="l00896"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a3f8233f4e9911d7af0f17ca66c16ff92">  896</a></span>&#160;                          <span class="stringliteral">&#39;com&#39;</span>     : <span class="stringliteral">&#39;gaussian&#39;</span>,</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;                          <span class="stringliteral">&#39;out&#39;</span>     : <span class="stringliteral">&#39;qcout&#39;</span>,</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;                          <span class="stringliteral">&#39;esp&#39;</span>     : <span class="stringliteral">&#39;qcesp&#39;</span>,</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;                          <span class="stringliteral">&#39;txt&#39;</span>     : <span class="stringliteral">&#39;qdata&#39;</span>,</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;                          <span class="stringliteral">&#39;crd&#39;</span>     : <span class="stringliteral">&#39;charmm&#39;</span>,</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;                          <span class="stringliteral">&#39;cor&#39;</span>     : <span class="stringliteral">&#39;charmm&#39;</span>,</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;                          <span class="stringliteral">&#39;arc&#39;</span>     : <span class="stringliteral">&#39;tinker&#39;</span>}</div>
<div class="line"><a name="l00903"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a35600d98f150597c9d9ac5129e01bd8d">  903</a></span>&#160;        <span class="comment">## Creates entries like &#39;gromacs&#39; : &#39;gromacs&#39; and &#39;xyz&#39; : &#39;xyz&#39;</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        <span class="comment">## in the Funnel</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#af9d8dc89fee54b2b89558633f2c9b70a">positive_resid</a> = positive_resid</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#aeb5135f20e02b98900b6fa3fbab9822d">built_bonds</a> = <span class="keyword">False</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> set(self.Read_Tab.keys() + self.Write_Tab.keys()):</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;            self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a491b10f21e93f841a770088402a13924">Funnel</a>[i] = i</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        <span class="comment"># Data container.  All of the data is stored in here.</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a> = {}</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        <span class="comment">## Read in stuff if we passed in a file name, otherwise return an empty instance.</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        <span class="keywordflow">if</span> fnm != <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;            self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[<span class="stringliteral">&#39;fnm&#39;</span>] = fnm</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;            <span class="keywordflow">if</span> ftype == <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;                <span class="comment">## Try to determine from the file name using the extension.</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;                ftype = os.path.splitext(fnm)[1][1:]</div>
<div class="line"><a name="l00917"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a85310a28c678cb386f9d2b584b24320d">  917</a></span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.path.exists(fnm):</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                <span class="keywordflow">raise</span> IOError(<span class="stringliteral">&#39;Tried to create Molecule object from a file that does not exist: %s&#39;</span> % fnm)</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;            self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[<span class="stringliteral">&#39;ftype&#39;</span>] = ftype</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;            <span class="comment">## Actually read the file.</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;            Parsed = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a35600d98f150597c9d9ac5129e01bd8d">Read_Tab</a>[self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a491b10f21e93f841a770088402a13924">Funnel</a>[ftype.lower()]](fnm, **kwargs)</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;            <span class="comment">## Set member variables.</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;            <span class="keywordflow">for</span> key, val <span class="keywordflow">in</span> Parsed.items():</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key] = val</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;            <span class="comment">## Create a list of comment lines if we don&#39;t already have them from reading the file.</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&#39;comms&#39;</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#adf9f25ebcf955be562ef186b822e237a">comms</a> = [<span class="stringliteral">&#39;Generated by ForceBalance from %s: Frame %i of %i&#39;</span> % (fnm, i+1, self.ns) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(self.ns)]</div>
<div class="line"><a name="l00928"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a491b10f21e93f841a770088402a13924">  928</a></span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#adf9f25ebcf955be562ef186b822e237a">comms</a> = [i.expandtabs() <span class="keywordflow">for</span> i <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#adf9f25ebcf955be562ef186b822e237a">comms</a>]</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;            <span class="comment">## Make sure the comment line isn&#39;t too long</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;            <span class="comment"># for i in range(len(self.comms)):</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;            <span class="comment">#     self.comms[i] = self.comms[i][:100] if len(self.comms[i]) &gt; 100 else self.comms[i]</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;            <span class="comment"># Attempt to build the topology for small systems. :)</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&#39;networkx&#39;</span> <span class="keywordflow">in</span> sys.modules <span class="keywordflow">and</span> hasattr(self, <span class="stringliteral">&#39;elem&#39;</span>) <span class="keywordflow">and</span> build_topology <span class="keywordflow">and</span> self.na &gt; 0:</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                <span class="keywordflow">if</span> self.na &gt; 100000:</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                    <span class="keywordflow">print</span> <span class="stringliteral">&quot;Warning: Large number of atoms (%i), topology building may take a long time&quot;</span> % self.na</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a57facdb1b7e71fabfad0df72a7ff94f5">topology</a> = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a071f18dacd881f761462f772bb0cf632">build_topology</a>()</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;                self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a2537929702245aab6ab293c145730d7c">molecules</a> = nx.connected_component_subgraphs(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a57facdb1b7e71fabfad0df72a7ff94f5">topology</a>)</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;                <span class="keywordflow">if</span> <span class="stringliteral">&#39;bonds&#39;</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;                    self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[<span class="stringliteral">&#39;bonds&#39;</span>] = self.topology.edges()</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;                    self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#aeb5135f20e02b98900b6fa3fbab9822d">built_bonds</a> = <span class="keyword">True</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;</div>
<div class="line"><a name="l00943"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#af9d8dc89fee54b2b89558633f2c9b70a">  943</a></span>&#160;    <span class="comment">#=====================================#</span></div>
<div class="line"><a name="l00944"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#aeb5135f20e02b98900b6fa3fbab9822d">  944</a></span>&#160;    <span class="comment">#|     Core read/write functions     |#</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    <span class="comment">#| Hopefully we won&#39;t have to change |#</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <span class="comment">#|         these very often!         |#</span></div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    <span class="comment">#=====================================#</span></div>
<div class="line"><a name="l00948"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">  948</a></span>&#160;</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a80851250d8e749bea882d5aa4bcfcdd1">require</a>(self, *args):</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> args:</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;            <span class="keywordflow">if</span> arg <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&quot;%s is a required attribute for writing this type of file but it&#39;s not present&quot;</span> % arg)</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <span class="comment"># def read(self, fnm, ftype = None):</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="comment">#     &quot;&quot;&quot; Read in a file. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    <span class="comment">#     if ftype == None:</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    <span class="comment">#         ## Try to determine from the file name using the extension.</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <span class="comment">#         ftype = os.path.splitext(fnm)[1][1:]</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <span class="comment">#     ## This calls the table of reader functions and prints out an error message if it fails.</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    <span class="comment">#     ## &#39;Answer&#39; is a dictionary of data that is returned from the reader function.</span></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <span class="comment">#     Answer = self.Read_Tab[self.Funnel[ftype.lower()]](fnm)</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <span class="comment">#     return Answer</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a4ecfdf28aacff9c081dd50cd4ac84f89">write</a>(self,fnm=None,ftype=None,append=False,select=None,**kwargs):</div>
<div class="line"><a name="l00965"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#adf9f25ebcf955be562ef186b822e237a">  965</a></span>&#160;        <span class="keywordflow">if</span> fnm == <span class="keywordtype">None</span> <span class="keywordflow">and</span> ftype == <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;            <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&quot;Output file name and file type are not specified.&quot;</span>)</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;        <span class="keywordflow">elif</span> ftype == <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;            ftype = os.path.splitext(fnm)[1][1:]</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;        <span class="comment">## Fill in comments.</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;        <span class="keywordflow">if</span> <span class="stringliteral">&#39;xyzs&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a> <span class="keywordflow">and</span> len(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#adf9f25ebcf955be562ef186b822e237a">comms</a>) &lt; len(self.xyzs):</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#adf9f25ebcf955be562ef186b822e237a">comms</a>), len(self.xyzs)):</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;                self.comms.append(<span class="stringliteral">&quot;Frame %i: generated by ForceBalance&quot;</span> % i)</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        <span class="comment">## I needed to add in this line because the DCD writer requires the file name,</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;        <span class="comment">## but the other methods don&#39;t.</span></div>
<div class="line"><a name="l00975"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a57facdb1b7e71fabfad0df72a7ff94f5">  975</a></span>&#160;        self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a2124792d405b58526af41475e4af3c80">fout</a> = fnm</div>
<div class="line"><a name="l00976"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a2537929702245aab6ab293c145730d7c">  976</a></span>&#160;        <span class="keywordflow">if</span> type(select) <span class="keywordflow">in</span> [int, np.int64, np.int32]:</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;            select = [select]</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;        <span class="keywordflow">if</span> select == <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;            select = range(len(self))</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        Answer = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a85310a28c678cb386f9d2b584b24320d">Write_Tab</a>[self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a491b10f21e93f841a770088402a13924">Funnel</a>[ftype.lower()]](select,**kwargs)</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        <span class="comment">## Any method that returns text will give us a list of lines, which we then write to the file.</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;        <span class="keywordflow">if</span> Answer != <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;            <span class="keywordflow">if</span> fnm == <span class="keywordtype">None</span> <span class="keywordflow">or</span> fnm == sys.stdout:</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;                outfile = sys.stdout</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;            <span class="keywordflow">elif</span> append:</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;                <span class="comment"># Writing to symbolic links risks unintentionally overwriting the source file - </span></div>
<div class="line"><a name="l00987"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a80851250d8e749bea882d5aa4bcfcdd1">  987</a></span>&#160;                <span class="comment"># thus we delete the link first.</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;                <span class="keywordflow">if</span> os.path.islink(fnm): </div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;                    os.unlink(fnm)</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;                outfile = open(fnm,<span class="stringliteral">&#39;a&#39;</span>)</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;                <span class="keywordflow">if</span> os.path.islink(fnm): </div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;                    os.unlink(fnm)</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;                outfile = open(fnm,<span class="stringliteral">&#39;w&#39;</span>)</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;            <span class="keywordflow">for</span> line <span class="keywordflow">in</span> Answer:</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;                <span class="keywordflow">print</span> &gt;&gt; outfile,line</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;            outfile.close()</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    <span class="comment">#=====================================#</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    <span class="comment">#|         Useful functions          |#</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    <span class="comment">#|     For doing useful things       |#</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a4ecfdf28aacff9c081dd50cd4ac84f89"> 1002</a></span>&#160;    <span class="comment">#=====================================#</span></div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a6aa22586a5590f63ea20e269e3f195a5">center_of_mass</a>(self):</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        M = sum([PeriodicTable[self.elem[i]] <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(self.na)])</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        <span class="keywordflow">return</span> np.array([np.sum([xyz[i,:] * PeriodicTable[self.elem[i]] / M <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(xyz.shape[0])],axis=0) <span class="keywordflow">for</span> xyz <span class="keywordflow">in</span> self.xyzs])</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a02ff6f6642ed47c3b1fa3bb00191c32a">radius_of_gyration</a>(self):</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        M = sum([PeriodicTable[self.elem[i]] <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(self.na)])</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;        coms = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a6aa22586a5590f63ea20e269e3f195a5">center_of_mass</a>()</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        rgs = []</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        <span class="keywordflow">for</span> i, xyz <span class="keywordflow">in</span> enumerate(self.xyzs):</div>
<div class="line"><a name="l01013"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a2124792d405b58526af41475e4af3c80"> 1013</a></span>&#160;            xyz1 = xyz.copy()</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;            xyz1 -= coms[i]</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;            rgs.append(np.sum([PeriodicTable[self.elem[i]]*np.dot(x,x) <span class="keywordflow">for</span> i, x <span class="keywordflow">in</span> enumerate(xyz1)])/M)</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        <span class="keywordflow">return</span> np.array(rgs)</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;            </div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#af12c7d375efeffb8a35b8406afc209dc">rigid_water</a>(self):</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; If one atom is oxygen and the next two are hydrogen, make the water molecule rigid. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;        self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a80851250d8e749bea882d5aa4bcfcdd1">require</a>(<span class="stringliteral">&#39;elem&#39;</span>, <span class="stringliteral">&#39;xyzs&#39;</span>)</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(self)):</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;            <span class="keywordflow">for</span> a <span class="keywordflow">in</span> range(self.na-2):</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                <span class="keywordflow">if</span> self.elem[a] == <span class="stringliteral">&#39;O&#39;</span> <span class="keywordflow">and</span> self.elem[a+1] == <span class="stringliteral">&#39;H&#39;</span> <span class="keywordflow">and</span> self.elem[a+2] == <span class="stringliteral">&#39;H&#39;</span>:</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                    flex = self.xyzs[i]</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;                    wat = flex[a:a+3]</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;                    com = wat.mean(0)</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;                    wat -= com</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;                    o  = wat[0]</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;                    h1 = wat[1]</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;                    h2 = wat[2]</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;                    r1 = h1 - o</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;                    r2 = h2 - o</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;                    r1 /= np.linalg.norm(r1)</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;                    r2 /= np.linalg.norm(r2)</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;                    <span class="comment"># Obtain unit vectors.</span></div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;                    ex = r1 + r2</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;                    ey = r1 - r2</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;                    ex /= np.linalg.norm(ex)</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;                    ey /= np.linalg.norm(ey)</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;                    Bond = 0.9572</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;                    Ang = np.pi * 104.52 / 2 / 180</div>
<div class="line"><a name="l01042"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a6aa22586a5590f63ea20e269e3f195a5"> 1042</a></span>&#160;                    cosx = np.cos(Ang)</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;                    cosy = np.sin(Ang)</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;                    h1 = o + Bond*ex*cosx + Bond*ey*cosy</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;                    h2 = o + Bond*ex*cosx - Bond*ey*cosy</div>
<div class="line"><a name="l01046"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a02ff6f6642ed47c3b1fa3bb00191c32a"> 1046</a></span>&#160;                    rig = np.array([o, h1, h2]) + com</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;                    self.xyzs[i][a:a+3] = rig</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="comment">#        if center:</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="comment">#            xyz1 -= xyz1.mean(0)</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="comment">#        for index2, xyz2 in enumerate(self.xyzs):</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="comment">#            if index2 == 0: continue</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment">#            xyz2 -= xyz2.mean(0)</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="comment">#            if smooth:</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="comment">#                ref = index2-1</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="comment">#            else:</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="comment">#                ref = 0</span></div>
<div class="line"><a name="l01058"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#af12c7d375efeffb8a35b8406afc209dc"> 1058</a></span>&#160;<span class="comment">#            tr, rt = get_rotate_translate(xyz2,self.xyzs[ref])</span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="comment">#            xyz2 = np.dot(xyz2, rt) + tr</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="comment">#            self.xyzs[index2] = xyz2</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a68e276a95910d534fa2e937abbc60e1c">load_frames</a>(self, fnm):</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;        NewMol = <a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html">Molecule</a>(fnm)</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;        <span class="keywordflow">if</span> NewMol.na != self.na:</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;            <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;When loading frames, don\&#39;t change the number of atoms.&#39;</span>)</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;        <span class="keywordflow">for</span> key <span class="keywordflow">in</span> NewMol.FrameKeys:</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;            self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key] = NewMol.Data[key]</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a441d8367806c9a802bd0693fea16c62a">edit_qcrems</a>(self, in_dict, subcalc = None):</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Edit Q-Chem rem variables with a dictionary.  Pass a value of None to delete a rem variable. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        <span class="keywordflow">if</span> subcalc == <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;            <span class="keywordflow">for</span> qcrem <span class="keywordflow">in</span> self.qcrems:</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;                <span class="keywordflow">for</span> key, val <span class="keywordflow">in</span> in_dict.items():</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;                    <span class="keywordflow">if</span> val == <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;                        qcrem.pop(key, <span class="keywordtype">None</span>)</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;                    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;                        qcrem[key] = val</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;            <span class="keywordflow">for</span> key, val <span class="keywordflow">in</span> in_dict.items():</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;                <span class="keywordflow">if</span> val == <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;                    self.qcrems[subcalc].pop(key, <span class="keywordtype">None</span>)</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;                <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;                    self.qcrems[subcalc][key] = val</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a33020ff5e5cec23a3d9d1fe7adfa8583">add_quantum</a>(self, other):</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;        <span class="keywordflow">if</span> type(other) <span class="keywordflow">is</span> Molecule:</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;            OtherMol = other</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;        <span class="keywordflow">elif</span> type(other) <span class="keywordflow">is</span> str:</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;            OtherMol = <a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html">Molecule</a>(other)</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        <span class="keywordflow">for</span> key <span class="keywordflow">in</span> OtherMol.QuantumKeys:</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;            <span class="keywordflow">if</span> key <span class="keywordflow">in</span> AtomVariableNames <span class="keywordflow">and</span> len(OtherMol.Data[key]) != self.na:</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;                <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;The quantum-key %s is AtomData, but it doesn\&#39;t have the same number of atoms as the Molecule object we\&#39;re adding it to.&#39;</span>)</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;            self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key] = copy.deepcopy(OtherMol.Data[key])</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a13d86eb62139bdc2a835756cacb3be66">add_virtual_site</a>(self, idx, **kwargs):</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Add a virtual site to the system.  This does NOT set the position of the virtual site; it sits at the origin. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;        <span class="keywordflow">for</span> key <span class="keywordflow">in</span> self.AtomKeys:</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;            <span class="keywordflow">if</span> key <span class="keywordflow">in</span> kwargs:</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;                self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key].insert(idx,kwargs[key])</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01101"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a68e276a95910d534fa2e937abbc60e1c"> 1101</a></span>&#160;                <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;You need to specify %s when adding a virtual site to this molecule.&#39;</span> % key)</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;        <span class="keywordflow">if</span> <span class="stringliteral">&#39;xyzs&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;            <span class="keywordflow">for</span> i, xyz <span class="keywordflow">in</span> enumerate(self.xyzs):</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;                <span class="keywordflow">if</span> <span class="stringliteral">&#39;pos&#39;</span> <span class="keywordflow">in</span> kwargs:</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;                    self.xyzs[i] = np.insert(xyz, idx, xyz[kwargs[<span class="stringliteral">&#39;pos&#39;</span>]], axis=0)</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;                <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;                    self.xyzs[i] = np.insert(xyz, idx, 0.0, axis=0)</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;            <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;You need to have xyzs in this molecule to add a virtual site.&#39;</span>)</div>
<div class="line"><a name="l01110"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a441d8367806c9a802bd0693fea16c62a"> 1110</a></span>&#160;</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#ad825186bec1659fdad2521a1b377323b">replace_peratom</a>(self, key, orig, want):</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Replace all of the data for a certain attribute in the system from orig to want. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;        <span class="keywordflow">if</span> key <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(self.na):</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;                <span class="keywordflow">if</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key][i] == orig:</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;                    self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key][i] = want</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;            <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;The key that we want to replace (%s) doesn\&#39;t exist.&#39;</span> % key)</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#ae565eb57c2ee21f2be19b9761754aba5">replace_peratom_conditional</a>(self, key1, cond, key2, orig, want):</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Replace all of the data for a attribute key2 from orig to want, contingent on key1 being equal to cond. </span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="stringliteral">        For instance: replace H1 with H2 if resname is SOL.&quot;&quot;&quot;</span></div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;        <span class="keywordflow">if</span> key2 <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a> <span class="keywordflow">and</span> key1 <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(self.na):</div>
<div class="line"><a name="l01125"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a33020ff5e5cec23a3d9d1fe7adfa8583"> 1125</a></span>&#160;                <span class="keywordflow">if</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key2][i] == orig <span class="keywordflow">and</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key1][i] == cond:</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;                    self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key2][i] = want</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;            <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;Either the comparison or replacement key (%s, %s) doesn\&#39;t exist.&#39;</span> % (key1, key2))</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a432affdec68562b5b19fd249124480c3">atom_select</a>(self,atomslice):</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Return a copy of the object with certain atoms selected.  Takes an integer, list or array as argument. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;        <span class="keywordflow">if</span> isinstance(atomslice, int):</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;            atomslice = [atomslice]</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;        <span class="keywordflow">if</span> isinstance(atomslice, list):</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;            atomslice = np.array(atomslice)</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;        New = <a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html">Molecule</a>()</div>
<div class="line"><a name="l01137"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a13d86eb62139bdc2a835756cacb3be66"> 1137</a></span>&#160;        <span class="keywordflow">for</span> key <span class="keywordflow">in</span> self.FrameKeys | self.MetaKeys:</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;            New.Data[key] = copy.deepcopy(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key])</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;        <span class="keywordflow">for</span> key <span class="keywordflow">in</span> self.AtomKeys:</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;            <span class="keywordflow">if</span> key == <span class="stringliteral">&#39;tinkersuf&#39;</span>: <span class="comment"># Tinker suffix is a bit tricky</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;                Map = dict([(a+1, i+1) <span class="keywordflow">for</span> i, a <span class="keywordflow">in</span> enumerate(atomslice)])</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;                CopySuf = list(np.array(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key])[atomslice])</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;                NewSuf = []</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;                <span class="keywordflow">for</span> line <span class="keywordflow">in</span> CopySuf:</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;                    whites      = re.split(<span class="stringliteral">&#39;[^ ]+&#39;</span>,line)</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;                    s           = line.split()</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;                    <span class="keywordflow">if</span> len(s) &gt; 1:</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;                        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1,len(s)):</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;                            s[i] = str(Map[int(s[i])])</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;                    sn = [int(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> s[1:]]</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;                    s = [s[0]] + list(np.array(s[1:])[np.argsort(sn)])</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;                    NewSuf.append(<span class="stringliteral">&#39;&#39;</span>.join([whites[j]+s[j] <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(len(s))]))</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;                New.Data[<span class="stringliteral">&#39;tinkersuf&#39;</span>] = NewSuf[:]</div>
<div class="line"><a name="l01154"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#ad825186bec1659fdad2521a1b377323b"> 1154</a></span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;                New.Data[key] = list(np.array(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key])[atomslice])</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;        <span class="keywordflow">if</span> <span class="stringliteral">&#39;xyzs&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(self.ns):</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;                New.xyzs[i] = self.xyzs[i][atomslice]</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;        <span class="keywordflow">if</span> <span class="stringliteral">&#39;networkx&#39;</span> <span class="keywordflow">in</span> sys.modules <span class="keywordflow">and</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#aeb5135f20e02b98900b6fa3fbab9822d">built_bonds</a> <span class="keywordflow">and</span> self.na &gt; 0:</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;            New.topology = New.build_topology()</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;            New.molecules = nx.connected_component_subgraphs(New.topology)</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;            New.Data[<span class="stringliteral">&#39;bonds&#39;</span>] = New.topology.edges()</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;            New.built_bonds = <span class="keyword">True</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;        <span class="keywordflow">elif</span> <span class="stringliteral">&#39;bonds&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l01165"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#ae565eb57c2ee21f2be19b9761754aba5"> 1165</a></span>&#160;            New.Data[<span class="stringliteral">&#39;bonds&#39;</span>] = [(list(atomslice).index(b[0]), list(atomslice).index(b[1])) <span class="keywordflow">for</span> b <span class="keywordflow">in</span> self.bonds <span class="keywordflow">if</span> (b[0] <span class="keywordflow">in</span> atomslice <span class="keywordflow">and</span> b[1] <span class="keywordflow">in</span> atomslice)]</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;        <span class="keywordflow">return</span> New</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a63dd7bc0347cc3dec5e8fa0ebfd567ec">atom_stack</a>(self, other):</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Return a copy of the object with another molecule object appended.  WARNING: This function may invalidate stuff like QM energies. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;        <span class="keywordflow">if</span> len(other) != len(self):</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;            <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;The number of frames of the Molecule objects being stacked are not equal.&#39;</span>)</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;        New = <a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html">Molecule</a>()</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;        <span class="keywordflow">for</span> key <span class="keywordflow">in</span> self.FrameKeys | self.MetaKeys:</div>
<div class="line"><a name="l01175"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a432affdec68562b5b19fd249124480c3"> 1175</a></span>&#160;            New.Data[key] = copy.deepcopy(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key])</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;            </div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;        <span class="comment"># This is how we&#39;re going to stack things like Cartesian coordinates and QM forces.</span></div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;        <span class="keyword">def </span>FrameStack(k):</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;            <span class="keywordflow">if</span> k <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a> <span class="keywordflow">and</span> k <span class="keywordflow">in</span> other.Data:</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;                New.Data[k] = [np.vstack((s, o)) <span class="keywordflow">for</span> s, o <span class="keywordflow">in</span> zip(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[k], other.Data[k])]</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> [<span class="stringliteral">&#39;xyzs&#39;</span>, <span class="stringliteral">&#39;qm_forces&#39;</span>, <span class="stringliteral">&#39;qm_espxyzs&#39;</span>, <span class="stringliteral">&#39;qm_espvals&#39;</span>, <span class="stringliteral">&#39;qm_extchgs&#39;</span>, <span class="stringliteral">&#39;qm_mulliken_charges&#39;</span>, <span class="stringliteral">&#39;qm_mulliken_spins&#39;</span>]:</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;            FrameStack(i)</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;        <span class="comment"># Now build the new atom keys.</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;        <span class="keywordflow">for</span> key <span class="keywordflow">in</span> self.AtomKeys:</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;            <span class="keywordflow">if</span> key <span class="keywordflow">not</span> <span class="keywordflow">in</span> other.Data:</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;                <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;Trying to stack two Molecule objects - the first object contains %s and the other does not&#39;</span> % (key))</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;            <span class="keywordflow">if</span> key == <span class="stringliteral">&#39;tinkersuf&#39;</span>: <span class="comment"># Tinker suffix is a bit tricky</span></div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;                NewSuf = []</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;                <span class="keywordflow">for</span> line <span class="keywordflow">in</span> other.Data[key]:</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;                    whites      = re.split(<span class="stringliteral">&#39;[^ ]+&#39;</span>,line)</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;                    s           = line.split()</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;                    <span class="keywordflow">if</span> len(s) &gt; 1:</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;                        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1,len(s)):</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;                            s[i] = str(int(s[i]) + self.na)</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;                    NewSuf.append(<span class="stringliteral">&#39;&#39;</span>.join([whites[j]+s[j] <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(len(s))]))</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;                New.Data[key] = copy.deepcopy(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key]) + NewSuf</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;                <span class="keywordflow">if</span> type(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key]) <span class="keywordflow">is</span> np.ndarray:</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;                    New.Data[key] = np.concatenate((self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key], other.Data[key]))</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;                <span class="keywordflow">elif</span> type(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key]) <span class="keywordflow">is</span> list:</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;                    New.Data[key] = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[key] + other.Data[key]</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;                <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;                    <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;Cannot stack %s because it is of type %s&#39;</span> % (key, str(type(New.Data[key]))))</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;        <span class="keywordflow">if</span> <span class="stringliteral">&#39;bonds&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a> <span class="keywordflow">and</span> <span class="stringliteral">&#39;bonds&#39;</span> <span class="keywordflow">in</span> other.Data:</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;            New.Data[<span class="stringliteral">&#39;bonds&#39;</span>] = self.bonds + [(b[0]+self.na, b[1]+self.na) <span class="keywordflow">for</span> b <span class="keywordflow">in</span> other.bonds]</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;        <span class="keywordflow">return</span> New</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a685c8092020a46cd7cf5b52ab45ca6e4">align_by_moments</a>(self):</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Align molecules using the moment of inertia.  </span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;<span class="stringliteral">        Departs from MSMBuilder convention of </span></div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;<span class="stringliteral">        using arithmetic mean for mass. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;        coms  = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a6aa22586a5590f63ea20e269e3f195a5">center_of_mass</a>()</div>
<div class="line"><a name="l01214"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a63dd7bc0347cc3dec5e8fa0ebfd567ec"> 1214</a></span>&#160;        xyz1  = self.xyzs[0]</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;        xyz1 -= coms[0]</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;        xyz1  = <a class="code" href="namespaceforcebalance_1_1molecule.html#aa9ad9b92efa7bd3c1d589d62bbb8108e">AlignToMoments</a>(self.elem,xyz1)</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;        <span class="keywordflow">for</span> index2, xyz2 <span class="keywordflow">in</span> enumerate(self.xyzs):</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;            xyz2 -= coms[index2]</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;            xyz2 = <a class="code" href="namespaceforcebalance_1_1molecule.html#aa9ad9b92efa7bd3c1d589d62bbb8108e">AlignToMoments</a>(self.elem,xyz1,xyz2)</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;            self.xyzs[index2] = xyz2</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a87e66db685214a9cdd4feff49d4ea5dc">align</a>(self, smooth = False, center = True, center_mass = False, select=None):</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Align molecules. </span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="stringliteral">        Has the option to create smooth trajectories </span></div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;<span class="stringliteral">        (align each frame to the previous one)</span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;<span class="stringliteral">        or to align each frame to the first one.</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;<span class="stringliteral">        Also has the option to remove the center of mass.</span></div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;<span class="stringliteral">        Provide a list of atom indices to align along selected atoms.</span></div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;        <span class="keywordflow">if</span> isinstance(select, list):</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;            select = np.array(select)</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;        <span class="keywordflow">if</span> center <span class="keywordflow">and</span> center_mass:</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;            <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;Specify center=True or center_mass=True but set the other one to False&#39;</span>)</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;        coms = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a6aa22586a5590f63ea20e269e3f195a5">center_of_mass</a>()</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;        xyz1 = self.xyzs[0]</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;        <span class="keywordflow">if</span> center:</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;            xyz1 -= xyz1.mean(0)</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        <span class="keywordflow">elif</span> center_mass:</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;            xyz1 = coms[0]</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;        <span class="keywordflow">for</span> index2, xyz2 <span class="keywordflow">in</span> enumerate(self.xyzs):</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;            <span class="keywordflow">if</span> index2 == 0: <span class="keywordflow">continue</span></div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;            xyz2 -= xyz2.mean(0)</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;            <span class="keywordflow">if</span> smooth:</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;                ref = index2-1</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;                ref = 0</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;            <span class="keywordflow">if</span> select != <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;                tr, rt = <a class="code" href="namespaceforcebalance_1_1molecule.html#a08840b73e95bf34bf9ca7ea36ad0492d">get_rotate_translate</a>(xyz2[select],self.xyzs[ref][select])</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;                tr, rt = <a class="code" href="namespaceforcebalance_1_1molecule.html#a08840b73e95bf34bf9ca7ea36ad0492d">get_rotate_translate</a>(xyz2,self.xyzs[ref])</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;            xyz2 = np.dot(xyz2, rt) + tr</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;            self.xyzs[index2] = xyz2</div>
<div class="line"><a name="l01258"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a685c8092020a46cd7cf5b52ab45ca6e4"> 1258</a></span>&#160;</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a071f18dacd881f761462f772bb0cf632">build_topology</a>(self, sn=None, Fac=1.2):</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;        <span class="stringliteral">&#39;&#39;&#39; A bare-bones implementation of the bond graph capability in the nanoreactor code.  </span></div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;<span class="stringliteral">        Returns a NetworkX graph that depicts the molecular topology, which might be useful for stuff. </span></div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;<span class="stringliteral">        Provide, optionally, the frame number used to compute the topology. &#39;&#39;&#39;</span></div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;        <span class="keywordflow">if</span> sn == <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;            sn = 0</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;        mindist = 1.0 <span class="comment"># Any two atoms that are closer than this distance are bonded.</span></div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;        <span class="comment"># Create an atom-wise list of covalent radii.</span></div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;        R = np.array([(Radii[Elements.index(i)-1] <span class="keywordflow">if</span> i <span class="keywordflow">in</span> Elements <span class="keywordflow">else</span> 0.0) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> self.elem])</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;        <span class="comment"># Create a list of 2-tuples corresponding to combinations of atomic indices using a grid algorithm.</span></div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;        mins = np.min(self.xyzs[sn],axis=0)</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;        maxs = np.max(self.xyzs[sn],axis=0)</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;        <span class="comment"># Grid size in Angstrom.  This number is optimized for speed in a 15,000 atom system (united atom pentadecane).</span></div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;        gsz = 6.0</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;        toppbc = <span class="keyword">False</span></div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;        <span class="keywordflow">if</span> hasattr(self, <span class="stringliteral">&#39;boxes&#39;</span>): </div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;            xmin = 0.0</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;            ymin = 0.0</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;            zmin = 0.0</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;            xmax = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">boxes</a>[sn].a</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;            ymax = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">boxes</a>[sn].b</div>
<div class="line"><a name="l01280"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a87e66db685214a9cdd4feff49d4ea5dc"> 1280</a></span>&#160;            zmax = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">boxes</a>[sn].c</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;            <span class="keywordflow">if</span> xmax &gt; gsz <span class="keywordflow">and</span> ymax &gt; gsz <span class="keywordflow">and</span> zmax &gt; gsz:</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;                toppbc = <span class="keyword">True</span></div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;            <span class="keywordflow">if</span> any([i != 90.0 <span class="keywordflow">for</span> i <span class="keywordflow">in</span> [self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">boxes</a>[sn].alpha, self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">boxes</a>[sn].beta, self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">boxes</a>[sn].gamma]]):</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;                <span class="keywordflow">print</span> <span class="stringliteral">&quot;Warning: Topology building will not work with broken molecules in nonorthogonal cells.&quot;</span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;                toppbc = <span class="keyword">False</span></div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;            xmin = mins[0]</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;            ymin = mins[1]</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;            zmin = mins[2]</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;            xmax = maxs[0]</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;            ymax = maxs[1]</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;            zmax = maxs[2]</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;        <span class="keywordflow">if</span> toppbc:</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;            gszx = (xmax-xmin)/int((xmax-xmin)/gsz)</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;            gszy = (ymax-ymin)/int((ymax-ymin)/gsz)</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;            gszz = (zmax-zmin)/int((zmax-zmin)/gsz)</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;            gszx = gsz</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;            gszy = gsz</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;            gszz = gsz</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;        <span class="comment"># Run algorithm to determine bonds.</span></div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;        <span class="comment"># Decide if we want to use the grid algorithm.</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;        use_grid = toppbc <span class="keywordflow">or</span> (np.max([xmax-xmin, ymax-ymin, zmax-zmin]) &gt; 2.0*gsz)</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;        <span class="keywordflow">if</span> use_grid:</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;            <span class="comment"># Inside the grid algorithm.</span></div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;            <span class="comment"># 1) Determine the left edges of the grid cells.</span></div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;            xgrd = np.arange(xmin, xmax, gszx)</div>
<div class="line"><a name="l01310"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a071f18dacd881f761462f772bb0cf632"> 1310</a></span>&#160;            ygrd = np.arange(ymin, ymax, gszy)</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;            zgrd = np.arange(zmin, zmax, gszz)</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;            <span class="comment"># 2) Grid cells are denoted by a three-index tuple.</span></div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;            gidx = list(itertools.product(range(len(xgrd)), range(len(ygrd)), range(len(zgrd))))</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;            <span class="comment"># 3) Build a dictionary which maps a grid cell to itself plus its neighboring grid cells.</span></div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;            <span class="comment"># Two grid cells are defined to be neighbors if the differences between their x, y, z indices are at most 1.</span></div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;            gngh = OrderedDict()</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;            amax = np.array(gidx[-1])</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;            amin = np.array(gidx[0])</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;            n27 = np.array(list(itertools.product([-1,0,1],repeat=3)))</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> gidx:</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;                gngh[i] = []</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;                ai = np.array(i)</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;                <span class="keywordflow">for</span> j <span class="keywordflow">in</span> n27:</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;                    nj = ai+j</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;                    <span class="keywordflow">for</span> k <span class="keywordflow">in</span> range(3):</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;                        mod = amax[k]-amin[k]+1</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;                        <span class="keywordflow">if</span> nj[k] &lt; amin[k]:</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;                            nj[k] += mod</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;                        <span class="keywordflow">elif</span> nj[k] &gt; amax[k]:</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;                            nj[k] -= mod</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;                    gngh[i].<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a77417ff99b19f6d0b7c6f527e83fa7f1">append</a>(tuple(nj))</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;            <span class="comment"># 4) Loop over the atoms and assign each to a grid cell.</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;            <span class="comment"># Note: I think this step becomes the bottleneck if we choose very small grid sizes.</span></div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;            gasn = OrderedDict([(i, []) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> gidx])</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(self.na):</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;                xidx = -1</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;                yidx = -1</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;                zidx = -1</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;                <span class="keywordflow">for</span> j <span class="keywordflow">in</span> xgrd:</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;                    xi = self.xyzs[sn][i][0]</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;                    <span class="keywordflow">if</span> toppbc <span class="keywordflow">and</span> xi &lt; 0: xi += xmax</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;                    <span class="keywordflow">if</span> toppbc <span class="keywordflow">and</span> xi &gt; xmax: xi -= xmax</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;                    <span class="keywordflow">if</span> xi &lt; j: <span class="keywordflow">break</span></div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;                    xidx += 1</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;                <span class="keywordflow">for</span> j <span class="keywordflow">in</span> ygrd:</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;                    yi = self.xyzs[sn][i][1]</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;                    <span class="keywordflow">if</span> toppbc <span class="keywordflow">and</span> yi &lt; 0: yi += ymax</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;                    <span class="keywordflow">if</span> toppbc <span class="keywordflow">and</span> yi &gt; ymax: yi -= ymax</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;                    <span class="keywordflow">if</span> yi &lt; j: <span class="keywordflow">break</span></div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;                    yidx += 1</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;                <span class="keywordflow">for</span> j <span class="keywordflow">in</span> zgrd:</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;                    zi = self.xyzs[sn][i][2]</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;                    <span class="keywordflow">if</span> toppbc <span class="keywordflow">and</span> zi &lt; 0: zi += zmax</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;                    <span class="keywordflow">if</span> toppbc <span class="keywordflow">and</span> zi &gt; zmax: zi -= zmax</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;                    <span class="keywordflow">if</span> zi &lt; j: <span class="keywordflow">break</span></div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;                    zidx += 1</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;                gasn[(xidx,yidx,zidx)].<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a77417ff99b19f6d0b7c6f527e83fa7f1">append</a>(i)</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;            <span class="comment"># 5) Create list of 2-tuples corresponding to combinations of atomic indices.</span></div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;            <span class="comment"># This is done by looping over pairs of neighboring grid cells and getting Cartesian products of atom indices inside.</span></div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;            <span class="comment"># It may be possible to get a 2x speedup by eliminating forward-reverse pairs (e.g. (5, 4) and (4, 5) and duplicates (5,5).)</span></div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;            AtomIterator = []</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> gasn:</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;                <span class="keywordflow">for</span> j <span class="keywordflow">in</span> gngh[i]:</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;                    AtomIterator.append(<a class="code" href="namespaceforcebalance_1_1molecule.html#ae76fc5d05f43acc6006a4d1733818d71">cartesian_product2</a>([gasn[i], gasn[j]]))</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;            AtomIterator = np.ascontiguousarray(np.vstack(AtomIterator))</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;            <span class="comment"># Create a list of 2-tuples corresponding to combinations of atomic indices.</span></div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;            <span class="comment"># This is much faster than using itertools.combinations.</span></div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;            AtomIterator = np.ascontiguousarray(np.vstack((np.fromiter(itertools.chain(*[[i]*(self.na-i-1) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(self.na)]),dtype=np.int32), np.fromiter(itertools.chain(*[range(i+1,self.na) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(self.na)]),dtype=np.int32))).T)</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;        <span class="comment"># Create a list of thresholds for determining whether a certain interatomic distance is considered to be a bond.</span></div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;        BT0 = R[AtomIterator[:,0]]</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;        BT1 = R[AtomIterator[:,1]]</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;        BondThresh = (BT0+BT1) * Fac</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;        BondThresh = (BondThresh &gt; mindist) * BondThresh + (BondThresh &lt; mindist) * mindist</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;        <span class="keywordflow">if</span> <span class="stringliteral">&#39;forcebalance.contact&#39;</span> <span class="keywordflow">in</span> sys.modules:</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;            <span class="keywordflow">if</span> hasattr(self, <span class="stringliteral">&#39;boxes&#39;</span>):</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;                dxij = contact.atom_distances(np.array([self.xyzs[sn]]),AtomIterator,np.array([self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">boxes</a>[sn].a, self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">boxes</a>[sn].b, self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">boxes</a>[sn].c]))</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;                dxij = contact.atom_distances(np.array([self.xyzs[sn]]),AtomIterator)</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;            <span class="comment"># Inefficient implementation if importing contact doesn&#39;t work.</span></div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;            <span class="keywordflow">print</span> <span class="stringliteral">&quot;Warning: Using inefficient distance algorithm because &#39;contact&#39; module was not imported.&quot;</span></div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;            <span class="keywordflow">if</span> hasattr(self, <span class="stringliteral">&#39;boxes&#39;</span>):</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;                <span class="keywordflow">print</span> <span class="stringliteral">&quot;No minimum image convention available (import &#39;contact&#39; if you need it).&quot;</span></div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;            dxij = [np.array(list(itertools.chain(*[[np.linalg.norm(self.xyzs[sn][i]-self.xyzs[sn][j]) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(j+1,self.na)] <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(self.na)])))]</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;        <span class="comment"># Create a NetworkX graph object.</span></div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;        G = <a class="code" href="classforcebalance_1_1molecule_1_1MyG.html">MyG</a>()</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;        bonds = [[] <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(self.na)]</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;        <span class="keywordflow">for</span> i, a <span class="keywordflow">in</span> enumerate(self.elem):</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;            G.add_node(i)</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&#39;atomname&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;                nx.set_node_attributes(G,<span class="stringliteral">&#39;n&#39;</span>,{i:self.atomname[i]})</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;            nx.set_node_attributes(G,<span class="stringliteral">&#39;e&#39;</span>,{i:a})</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;            nx.set_node_attributes(G,<span class="stringliteral">&#39;x&#39;</span>,{i:self.xyzs[sn][i]})</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;        bond_bool = dxij[0] &lt; BondThresh</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;        <span class="keywordflow">for</span> i, a <span class="keywordflow">in</span> enumerate(bond_bool):</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> a: <span class="keywordflow">continue</span></div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;            (ii, jj) = AtomIterator[i]</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;            <span class="keywordflow">if</span> ii &gt;= jj: <span class="keywordflow">continue</span></div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;            bonds[ii].<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a77417ff99b19f6d0b7c6f527e83fa7f1">append</a>(jj)</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;            bonds[jj].<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a77417ff99b19f6d0b7c6f527e83fa7f1">append</a>(ii)</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;            G.add_edge(ii, jj)</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;        <span class="keywordflow">return</span> G</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#aa69056db05f047be1b4ae1e8f132d978">find_angles</a>(self):</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Return a list of 3-tuples corresponding to all of the</span></div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;<span class="stringliteral">        angles in the system.  Verified for lysine and tryptophan</span></div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;<span class="stringliteral">        dipeptide when comparing to TINKER&#39;s analyze program. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> hasattr(self, <span class="stringliteral">&#39;topology&#39;</span>):</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;            <span class="keywordflow">raise</span> RuntimeError(<span class="stringliteral">&quot;Need to have built a topology to find angles&quot;</span>)</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;        angidx = []</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;        <span class="comment"># Iterate over separate molecules</span></div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;        <span class="keywordflow">for</span> mol <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a2537929702245aab6ab293c145730d7c">molecules</a>:</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;            <span class="comment"># Iterate over atoms in the molecule</span></div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;            <span class="keywordflow">for</span> a2 <span class="keywordflow">in</span> mol.nodes():</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;                <span class="comment"># Find all bonded neighbors to this atom</span></div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;                friends = sorted(list(nx.all_neighbors(mol, a2)))</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;                <span class="keywordflow">if</span> len(friends) &lt; 2: <span class="keywordflow">continue</span></div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;                <span class="comment"># Double loop over bonded neighbors</span></div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;                <span class="keywordflow">for</span> i, a1 <span class="keywordflow">in</span> enumerate(friends):</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;                    <span class="keywordflow">for</span> a3 <span class="keywordflow">in</span> friends[i+1:]:</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;                        <span class="comment"># Add bonded atoms in the correct order</span></div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;                        angidx.append((a1, a2, a3))</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;        <span class="keywordflow">return</span> angidx</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a1d93b050bdb0d434b436d0c5803ccdec">find_dihedrals</a>(self):</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;        </div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Return a list of 4-tuples corresponding to all of the</span></div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;<span class="stringliteral">        dihedral angles in the system.  Verified for alanine and</span></div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;<span class="stringliteral">        tryptophan dipeptide when comparing to TINKER&#39;s analyze</span></div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;<span class="stringliteral">        program. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;        </div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> hasattr(self, <span class="stringliteral">&#39;topology&#39;</span>):</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;            <span class="keywordflow">raise</span> RuntimeError(<span class="stringliteral">&quot;Need to have built a topology to find dihedrals&quot;</span>)</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;        dihidx = []</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;        <span class="comment"># Iterate over separate molecules</span></div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;        <span class="keywordflow">for</span> mol <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a2537929702245aab6ab293c145730d7c">molecules</a>:</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;            <span class="comment"># Iterate over bonds in the molecule</span></div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;            <span class="keywordflow">for</span> edge <span class="keywordflow">in</span> mol.edges():</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;                <span class="comment"># Determine correct ordering of atoms (middle atoms are ordered by convention)</span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;                a2 = edge[0] <span class="keywordflow">if</span> edge[0] &lt; edge[1] <span class="keywordflow">else</span> edge[1]</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;                a3 = edge[1] <span class="keywordflow">if</span> edge[0] &lt; edge[1] <span class="keywordflow">else</span> edge[0]</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;                <span class="keywordflow">for</span> a1 <span class="keywordflow">in</span> sorted(list(nx.all_neighbors(mol, a2))):</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;                    <span class="keywordflow">if</span> a1 != a3:</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;                        <span class="keywordflow">for</span> a4 <span class="keywordflow">in</span> sorted(list(nx.all_neighbors(mol, a3))):</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;                            <span class="keywordflow">if</span> a4 != a2:</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;                                dihidx.append((a1, a2, a3, a4))</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;        <span class="keywordflow">return</span> dihidx</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#aa6b0a08a6579f697667c83e04927298c">measure_dihedrals</a>(self, i, j, k, l):</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Return a series of dihedral angles, given four atom indices numbered from zero. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;        phis = []</div>
<div class="line"><a name="l01458"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#aa69056db05f047be1b4ae1e8f132d978"> 1458</a></span>&#160;        <span class="keywordflow">if</span> <span class="stringliteral">&#39;bonds&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;            <span class="keywordflow">if</span> any(p <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.bonds <span class="keywordflow">for</span> p <span class="keywordflow">in</span> [(min(i,j),max(i,j)),(min(j,k),max(j,k)),(min(k,l),max(k,l))]):</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;                <span class="keywordflow">print</span> [(min(i,j),max(i,j)),(min(j,k),max(j,k)),(min(k,l),max(k,l))]</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;                warn(<span class="stringliteral">&quot;Measuring dihedral angle for four atoms that aren&#39;t bonded.  Hope you know what you&#39;re doing!&quot;</span>)</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;            warn(<span class="stringliteral">&quot;This molecule object doesn&#39;t have bonds defined, sanity-checking is off.&quot;</span>)</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;        <span class="keywordflow">for</span> s <span class="keywordflow">in</span> range(self.ns):</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;            x4 = self.xyzs[s][l]</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;            x3 = self.xyzs[s][k]</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;            x2 = self.xyzs[s][j]</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;            x1 = self.xyzs[s][i]</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;            v1 = x2-x1</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;            v2 = x3-x2</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;            v3 = x4-x3</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;            t1 = np.linalg.norm(v2)*np.dot(v1,np.cross(v2,v3))</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;            t2 = np.dot(np.cross(v1,v2),np.cross(v2,v3))</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;            phi = np.arctan2(t1,t2)</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;            phis.append(phi * 180 / np.pi)</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;            <span class="comment">#phimod = phi*180/pi % 360</span></div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;            <span class="comment">#phis.append(phimod)</span></div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;            <span class="comment">#print phimod</span></div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;        <span class="keywordflow">return</span> phis</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#af412b655371674434ec63b4bfea6d8c0">all_pairwise_rmsd</a>(self):</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Find pairwise RMSD (super slow, not like the one in MSMBuilder.) &quot;&quot;&quot;</span></div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;        N = len(self)</div>
<div class="line"><a name="l01484"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a1d93b050bdb0d434b436d0c5803ccdec"> 1484</a></span>&#160;        Mat = np.zeros((N,N),dtype=float)</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(N):</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;            xyzi = self.xyzs[i].copy()</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;            xyzi -= xyzi.mean(0)</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;            <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(i):</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;                xyzj = self.xyzs[j].copy()</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;                xyzj -= xyzj.mean(0)</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;                tr, rt = <a class="code" href="namespaceforcebalance_1_1molecule.html#a08840b73e95bf34bf9ca7ea36ad0492d">get_rotate_translate</a>(xyzj, xyzi)</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;                xyzj = np.dot(xyzj, rt) + tr</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;                rmsd = np.sqrt(3*np.mean((xyzj - xyzi) ** 2))</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;                Mat[i,j] = rmsd</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;                Mat[j,i] = rmsd</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;        <span class="keywordflow">return</span> Mat</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#ac0fd89e640485f7216183f9a7601c51f">pathwise_rmsd</a>(self):</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Find RMSD between frames along path. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;        N = len(self)</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;        Vec = np.zeros(N-1, dtype=float)</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(N-1):</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;            xyzi = self.xyzs[i].copy()</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;            xyzi -= xyzi.mean(0)</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;            j=i+1</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;            xyzj = self.xyzs[j].copy()</div>
<div class="line"><a name="l01507"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#aa6b0a08a6579f697667c83e04927298c"> 1507</a></span>&#160;            xyzj -= xyzj.mean(0)</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;            tr, rt = <a class="code" href="namespaceforcebalance_1_1molecule.html#a08840b73e95bf34bf9ca7ea36ad0492d">get_rotate_translate</a>(xyzj, xyzi)</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;            xyzj = np.dot(xyzj, rt) + tr</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;            rmsd = np.sqrt(3*np.mean((xyzj - xyzi) ** 2))</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;            Vec[i] = rmsd</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;        <span class="keywordflow">return</span> Vec</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a58191a79257fbad7f2c636239bfa7596">ref_rmsd</a>(self, i):</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Find RMSD to a reference frame. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;        N = len(self)</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;        Vec = np.zeros(N)</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;        xyzi = self.xyzs[i].copy()</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;        xyzi -= xyzi.mean(0)</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;        <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(N):</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;            xyzj = self.xyzs[j].copy()</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;            xyzj -= xyzj.mean(0)</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;            tr, rt = <a class="code" href="namespaceforcebalance_1_1molecule.html#a08840b73e95bf34bf9ca7ea36ad0492d">get_rotate_translate</a>(xyzj, xyzi)</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;            xyzj = np.dot(xyzj, rt) + tr</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;            rmsd = np.sqrt(3*np.mean((xyzj - xyzi) ** 2))</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;            Vec[j] = rmsd</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;        <span class="keywordflow">return</span> Vec</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#aff7a0e2413297088a5bc3e91e5951f3f">align_center</a>(self):</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;        self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a87e66db685214a9cdd4feff49d4ea5dc">align</a>()</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a57edc8d72f7e4c1a1452de7b438f3c55">openmm_positions</a>(self):</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Returns the Cartesian coordinates in the Molecule object in</span></div>
<div class="line"><a name="l01534"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#af412b655371674434ec63b4bfea6d8c0"> 1534</a></span>&#160;<span class="stringliteral">        a list of OpenMM-compatible positions, so it is possible to type</span></div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;<span class="stringliteral">        simulation.context.setPositions(Mol.openmm_positions()[0])</span></div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;<span class="stringliteral">        or something like that.</span></div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;        Positions = []</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;        self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a80851250d8e749bea882d5aa4bcfcdd1">require</a>(<span class="stringliteral">&#39;xyzs&#39;</span>)</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;        <span class="keywordflow">for</span> xyz <span class="keywordflow">in</span> self.xyzs:</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;            Pos = []</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;            <span class="keywordflow">for</span> xyzi <span class="keywordflow">in</span> xyz:</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;                Pos.append(Vec3(xyzi[0]/10,xyzi[1]/10,xyzi[2]/10))</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;            Positions.append(Pos*nanometer)</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;        <span class="keywordflow">return</span> Positions</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#aa20a420f4b450bfa9e632fae037ecb01">openmm_boxes</a>(self):</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Returns the periodic box vectors in the Molecule object in</span></div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;<span class="stringliteral">        a list of OpenMM-compatible boxes, so it is possible to type</span></div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;<span class="stringliteral">        simulation.context.setPeriodicBoxVectors(Mol.openmm_boxes()[0])</span></div>
<div class="line"><a name="l01552"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#ac0fd89e640485f7216183f9a7601c51f"> 1552</a></span>&#160;<span class="stringliteral">        or something like that.</span></div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;        </div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;        self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a80851250d8e749bea882d5aa4bcfcdd1">require</a>(<span class="stringliteral">&#39;boxes&#39;</span>)</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;        <span class="keywordflow">return</span> [(Vec3(box.A)/10.0, Vec3(box.B)/10.0, Vec3(box.C)/10.0) * nanometer <span class="keywordflow">for</span> box <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">boxes</a>]</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a71da1c1e530afd8b9b5f08d9bd27259f">split</a>(self, fnm=None, ftype=None, method=&quot;chunks&quot;, num=None):</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Split the molecule object into a number of separate files</span></div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;<span class="stringliteral">        (chunks), either by specifying the number of frames per chunk</span></div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;<span class="stringliteral">        or the number of chunks.  Only relevant for &quot;trajectories&quot;.</span></div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;<span class="stringliteral">        The type of file may be specified; if they aren&#39;t specified</span></div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;<span class="stringliteral">        then the original file type is used.</span></div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;<span class="stringliteral">        The output file names are [name].[numbers].[extension] where</span></div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;<span class="stringliteral">        [name] can be specified by passing &#39;fnm&#39; or taken from the</span></div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;<span class="stringliteral">        object&#39;s &#39;fnm&#39; attribute by default.  [numbers] are integers</span></div>
<div class="line"><a name="l01569"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a58191a79257fbad7f2c636239bfa7596"> 1569</a></span>&#160;<span class="stringliteral">        ranging from the lowest to the highest chunk number, prepended</span></div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;<span class="stringliteral">        by zeros.</span></div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;<span class="stringliteral">        If the number of chunks / frames is not specified, then one file</span></div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;<span class="stringliteral">        is written for each frame.</span></div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;<span class="stringliteral">        @return fnms A list of the file names that were written.</span></div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;        </div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;        </div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;    <span class="comment">#=====================================#</span></div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;    <span class="comment">#|         Reading functions         |#</span></div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;    <span class="comment">#=====================================#</span></div>
<div class="line"><a name="l01583"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#aff7a0e2413297088a5bc3e91e5951f3f"> 1583</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a15a7a0e0377e6dfd52e60c77fbc583c1">read_xyz</a>(self, fnm, **kwargs):</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; .xyz files can be TINKER formatted which is why we have the try/except here. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;        <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;            <span class="keywordflow">return</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#aff79ac248e1f0cfe92b5b9e0b559f56e">read_xyz0</a>(fnm, **kwargs)</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;        <span class="keywordflow">except</span>:</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;            <span class="keywordflow">return</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#aeb5983ae61079198f077f55e448e2c32">read_arc</a>(fnm, **kwargs)</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;            </div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#aff79ac248e1f0cfe92b5b9e0b559f56e">read_xyz0</a>(self, fnm, **kwargs):</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Parse a .xyz file which contains several xyz coordinates, and return their elements.</span></div>
<div class="line"><a name="l01592"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a57edc8d72f7e4c1a1452de7b438f3c55"> 1592</a></span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;<span class="stringliteral">        @param[in] fnm The input file name</span></div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;<span class="stringliteral">        @return elem  A list of chemical elements in the XYZ file</span></div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;<span class="stringliteral">        @return comms A list of comments.</span></div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;<span class="stringliteral">        @return xyzs  A list of XYZ coordinates (number of snapshots times number of atoms)</span></div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;        xyz   = []</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;        xyzs  = []</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;        comms = []</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;        elem  = []</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;        an    = 0</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;        na    = 0</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;        ln    = 0</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;        absln = 0</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;        <span class="keywordflow">for</span> line <span class="keywordflow">in</span> open(fnm):</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;            line = line.strip().expandtabs()</div>
<div class="line"><a name="l01609"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#aa20a420f4b450bfa9e632fae037ecb01"> 1609</a></span>&#160;            <span class="keywordflow">if</span> ln == 0:</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;                <span class="comment"># Skip blank lines.</span></div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;                <span class="keywordflow">if</span> len(line.strip()) &gt; 0:</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;                    na = int(line.strip())</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;            <span class="keywordflow">elif</span> ln == 1:</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;                comms.append(line.strip())</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;                line = re.sub(<span class="stringliteral">r&quot;([0-9])(-[0-9])&quot;</span>, <span class="stringliteral">r&quot;\1 \2&quot;</span>, line)</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;                sline = line.split()</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;                xyz.append([float(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> sline[1:]])</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;                <span class="keywordflow">if</span> len(elem) &lt; na:</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;                    elem.append(sline[0])</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;                an += 1</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;                <span class="keywordflow">if</span> an == na:</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;                    xyzs.append(np.array(xyz))</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;                    xyz = []</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;                    an  = 0</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;            <span class="keywordflow">if</span> ln == na+1:</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;                <span class="comment"># Reset the line number counter when we hit the last line in a block.</span></div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;                ln = -1</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;            ln += 1</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;            absln += 1</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;        Answer = {<span class="stringliteral">&#39;elem&#39;</span> : elem,</div>
<div class="line"><a name="l01632"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a71da1c1e530afd8b9b5f08d9bd27259f"> 1632</a></span>&#160;                  <span class="stringliteral">&#39;xyzs&#39;</span> : xyzs,</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;                  <span class="stringliteral">&#39;comms&#39;</span>: comms}</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;        <span class="keywordflow">return</span> Answer</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#ab1b56d66b7673b2631e2cee013a80b93">read_mdcrd</a>(self, fnm, **kwargs):</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Parse an AMBER .mdcrd file.  This requires at least the number of atoms.</span></div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;<span class="stringliteral">        This will FAIL for monatomic trajectories (but who the heck makes those?)</span></div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;<span class="stringliteral">        @param[in] fnm The input file name</span></div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;<span class="stringliteral">        @return xyzs  A list of XYZ coordinates (number of snapshots times number of atoms)</span></div>
<div class="line"><a name="l01642"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a15a7a0e0377e6dfd52e60c77fbc583c1"> 1642</a></span>&#160;<span class="stringliteral">        @return boxes Boxes (if present.)</span></div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;        self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a80851250d8e749bea882d5aa4bcfcdd1">require</a>(<span class="stringliteral">&#39;na&#39;</span>)</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;        xyz    = []</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;        xyzs   = []</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;        boxes  = []</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;        ln     = 0</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;        <span class="keywordflow">for</span> line <span class="keywordflow">in</span> open(fnm):</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;            sline = line.split()</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;            <span class="keywordflow">if</span> ln == 0:</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;                <span class="keywordflow">pass</span></div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;                <span class="keywordflow">if</span> xyz == [] <span class="keywordflow">and</span> len(sline) == 3:</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;                    a, b, c = (float(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> line.split())</div>
<div class="line"><a name="l01657"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#aff79ac248e1f0cfe92b5b9e0b559f56e"> 1657</a></span>&#160;                    boxes.append(<a class="code" href="namespaceforcebalance_1_1molecule.html#a0a6e3e79b04534bf2e83d09def189444">BuildLatticeFromLengthsAngles</a>(a, b, c, 90.0, 90.0, 90.0))</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;                <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;                    xyz += [float(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> line.split()]</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;                    <span class="keywordflow">if</span> len(xyz) == self.na * 3:</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;                        xyzs.append(np.array(xyz).reshape(-1,3))</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;                        xyz = []</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;            ln += 1</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;        Answer = {<span class="stringliteral">&#39;xyzs&#39;</span> : xyzs}</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;        <span class="keywordflow">if</span> len(boxes) &gt; 0:</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;            Answer[<span class="stringliteral">&#39;boxes&#39;</span>] = boxes</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;        <span class="keywordflow">return</span> Answer</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a1d34af6a7d22dd34850d58efe8595b20">read_qdata</a>(self, fnm, **kwargs):</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;        xyzs     = []</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;        energies = []</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;        forces   = []</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;        espxyzs  = []</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;        espvals  = []</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;        interaction = []</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;        <span class="keywordflow">for</span> line <span class="keywordflow">in</span> open(fnm):</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;            line = line.strip().expandtabs()</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&#39;COORDS&#39;</span> <span class="keywordflow">in</span> line:</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;                xyzs.append(np.array([float(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> line.split()[1:]]).reshape(-1,3))</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;            <span class="keywordflow">elif</span> <span class="stringliteral">&#39;FORCES&#39;</span> <span class="keywordflow">in</span> line:</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;                forces.append(np.array([float(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> line.split()[1:]]).reshape(-1,3))</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;            <span class="keywordflow">elif</span> <span class="stringliteral">&#39;ESPXYZ&#39;</span> <span class="keywordflow">in</span> line:</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;                espxyzs.append(np.array([float(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> line.split()[1:]]).reshape(-1,3))</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;            <span class="keywordflow">elif</span> <span class="stringliteral">&#39;ESPVAL&#39;</span> <span class="keywordflow">in</span> line:</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;                espvals.append(np.array([float(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> line.split()[1:]]))</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;            <span class="keywordflow">elif</span> <span class="stringliteral">&#39;ENERGY&#39;</span> <span class="keywordflow">in</span> line:</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;                energies.append(float(line.split()[1]))</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;            <span class="keywordflow">elif</span> <span class="stringliteral">&#39;INTERACTION&#39;</span> <span class="keywordflow">in</span> line:</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;                interaction.append(float(line.split()[1]))</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;        Answer = {}</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;        <span class="keywordflow">if</span> len(xyzs) &gt; 0:</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;            Answer[<span class="stringliteral">&#39;xyzs&#39;</span>] = xyzs</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;        <span class="keywordflow">if</span> len(energies) &gt; 0:</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;            Answer[<span class="stringliteral">&#39;qm_energies&#39;</span>] = energies</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;        <span class="keywordflow">if</span> len(interaction) &gt; 0:</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;            Answer[<span class="stringliteral">&#39;qm_interaction&#39;</span>] = interaction</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;        <span class="keywordflow">if</span> len(forces) &gt; 0:</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;            Answer[<span class="stringliteral">&#39;qm_forces&#39;</span>] = forces</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;        <span class="keywordflow">if</span> len(espxyzs) &gt; 0:</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;            Answer[<span class="stringliteral">&#39;qm_espxyzs&#39;</span>] = espxyzs</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;        <span class="keywordflow">if</span> len(espvals) &gt; 0:</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;            Answer[<span class="stringliteral">&#39;qm_espvals&#39;</span>] = espvals</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;        <span class="keywordflow">return</span> Answer</div>
<div class="line"><a name="l01704"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#ab1b56d66b7673b2631e2cee013a80b93"> 1704</a></span>&#160;</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a14b1fbc70a083d21fd016b5dd854fd56">read_mol2</a>(self, fnm, **kwargs):</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;        xyz      = []</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;        charge   = []</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;        atomname = []</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;        atomtype = []</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;        elem     = []</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;        data = <a class="code" href="classforcebalance_1_1Mol2_1_1mol2__set.html">Mol2.mol2_set</a>(fnm)</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;        <span class="keywordflow">if</span> len(data.compounds) &gt; 1:</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;            sys.stderr.write(<span class="stringliteral">&quot;Not sure what to do if the MOL2 file contains multiple compounds\n&quot;</span>)</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;        <span class="keywordflow">for</span> i, atom <span class="keywordflow">in</span> enumerate(data.compounds.items()[0][1].atoms):</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;            xyz.append([atom.x, atom.y, atom.z])</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;            charge.append(atom.charge)</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;            atomname.append(atom.atom_name)</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;            atomtype.append(atom.atom_type)</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;            thiselem = atom.atom_name</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;            <span class="keywordflow">if</span> len(thiselem) &gt; 1:</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;                thiselem = thiselem[0] + re.sub(<span class="stringliteral">&#39;[A-Z0-9]&#39;</span>,<span class="stringliteral">&#39;&#39;</span>,thiselem[1:])</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;            elem.append(thiselem)</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;        resname = [data.compounds.items()[0][0] <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(elem))]</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;        resid = [1 <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(elem))]</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;        </div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;        <span class="comment"># Deprecated &#39;abonds&#39; format.</span></div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;        <span class="comment"># bonds    = [[] for i in range(len(elem))]</span></div>
<div class="line"><a name="l01729"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a1d34af6a7d22dd34850d58efe8595b20"> 1729</a></span>&#160;        <span class="comment"># for bond in data.compounds.items()[0][1].bonds:</span></div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;        <span class="comment">#     a1 = bond.origin_atom_id - 1</span></div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;        <span class="comment">#     a2 = bond.target_atom_id - 1</span></div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;        <span class="comment">#     aL, aH = (a1, a2) if a1 &lt; a2 else (a2, a1)</span></div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;        <span class="comment">#     bonds[aL].append(aH)</span></div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;        bonds = []</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;        <span class="keywordflow">for</span> bond <span class="keywordflow">in</span> data.compounds.items()[0][1].bonds:</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;            a1 = bond.origin_atom_id - 1</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;            a2 = bond.target_atom_id - 1</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;            aL, aH = (a1, a2) <span class="keywordflow">if</span> a1 &lt; a2 <span class="keywordflow">else</span> (a2, a1)</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;            bonds.append((aL,aH))</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;        Answer = {<span class="stringliteral">&#39;xyzs&#39;</span> : [np.array(xyz)],</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;                  <span class="stringliteral">&#39;partial_charge&#39;</span> : charge,</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;                  <span class="stringliteral">&#39;atomname&#39;</span> : atomname,</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;                  <span class="stringliteral">&#39;atomtype&#39;</span> : atomtype,</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;                  <span class="stringliteral">&#39;elem&#39;</span>     : elem,</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;                  <span class="stringliteral">&#39;resname&#39;</span>  : resname,</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;                  <span class="stringliteral">&#39;resid&#39;</span>    : resid,</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;                  <span class="stringliteral">&#39;bonds&#39;</span>    : bonds</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;                  }</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;        <span class="keywordflow">return</span> Answer</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#ad8fa6cc7424aae00ee3f5bb87d28e037">read_dcd</a>(self, fnm, **kwargs):</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;        xyzs = []</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;        boxes = []</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;        <span class="keywordflow">if</span> _dcdlib.vmdplugin_init() != 0:</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;            <span class="keywordflow">raise</span> IOError(<span class="stringliteral">&quot;Unable to init DCD plugin&quot;</span>)</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;        natoms = c_int(-1)</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;        frame  = 0</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;        dcd       = _dcdlib.open_dcd_read(fnm, <span class="stringliteral">&quot;dcd&quot;</span>, byref(natoms))</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;        ts        = <a class="code" href="classforcebalance_1_1molecule_1_1MolfileTimestep.html">MolfileTimestep</a>()</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;        _xyz      = c_float * (natoms.value * 3)</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;        xyzvec    = _xyz()</div>
<div class="line"><a name="l01765"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a14b1fbc70a083d21fd016b5dd854fd56"> 1765</a></span>&#160;        ts.coords = xyzvec</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;        <span class="keywordflow">while</span> <span class="keyword">True</span>:</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;            result = _dcdlib.read_next_timestep(dcd, natoms, byref(ts))</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;            <span class="keywordflow">if</span> result == 0:</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;                frame += 1</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;            <span class="keywordflow">elif</span> result == -1:</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;                <span class="keywordflow">break</span></div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;            <span class="comment">#npa    = np.array(xyzvec)</span></div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;            xyz    = np.asfarray(xyzvec)</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;            xyzs.append(xyz.reshape(-1, 3))</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;            boxes.append(<a class="code" href="namespaceforcebalance_1_1molecule.html#a0a6e3e79b04534bf2e83d09def189444">BuildLatticeFromLengthsAngles</a>(ts.A, ts.B, ts.C, 90.0, 90.0, 90.0))</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;        _dcdlib.close_file_read(dcd)</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;        dcd = <span class="keywordtype">None</span></div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;        Answer = {<span class="stringliteral">&#39;xyzs&#39;</span> : xyzs,</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;                  <span class="stringliteral">&#39;boxes&#39;</span> : boxes}</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;        <span class="keywordflow">return</span> Answer</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a861feda06e1f60ab25c45eaaaf228cfc">read_com</a>(self, fnm, **kwargs):</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Parse a Gaussian .com file and return a SINGLE-ELEMENT list of xyz coordinates (no multiple file support)</span></div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;<span class="stringliteral">        @param[in] fnm The input file name</span></div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;<span class="stringliteral">        @return elem   A list of chemical elements in the XYZ file</span></div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;<span class="stringliteral">        @return comms  A single-element list for the comment.</span></div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;<span class="stringliteral">        @return xyzs   A single-element list for the  XYZ coordinates.</span></div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;<span class="stringliteral">        @return charge The total charge of the system.</span></div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;<span class="stringliteral">        @return mult   The spin multiplicity of the system.</span></div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;        elem    = []</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;        xyz     = []</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;        ln      = 0</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;        absln   = 0</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;        comfile = open(fnm).readlines()</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;        inxyz = 0</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;        <span class="keywordflow">for</span> line <span class="keywordflow">in</span> comfile:</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;            line = line.strip().expandtabs()</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;            <span class="comment"># Everything after exclamation point is a comment</span></div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;            sline = line.split(<span class="stringliteral">&#39;!&#39;</span>)[0].<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a71da1c1e530afd8b9b5f08d9bd27259f">split</a>()</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;            <span class="keywordflow">if</span> len(sline) == 2:</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;                <span class="keywordflow">if</span> <a class="code" href="namespaceforcebalance_1_1molecule.html#a0dd31eff88d2bed0884ab21a13261d42">isint</a>(sline[0]) <span class="keywordflow">and</span> <a class="code" href="namespaceforcebalance_1_1molecule.html#a0dd31eff88d2bed0884ab21a13261d42">isint</a>(sline[1]):</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;                    charge = int(sline[0])</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;                    mult = int(sline[1])</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;                    title_ln = ln - 2</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;            <span class="keywordflow">elif</span> len(sline) == 4:</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;                inxyz = 1</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;                <span class="keywordflow">if</span> sline[0].capitalize() <span class="keywordflow">in</span> PeriodicTable <span class="keywordflow">and</span> <a class="code" href="namespaceforcebalance_1_1molecule.html#afe989ffd119568047fc8265b1d329a70">isfloat</a>(sline[1]) <span class="keywordflow">and</span> <a class="code" href="namespaceforcebalance_1_1molecule.html#afe989ffd119568047fc8265b1d329a70">isfloat</a>(sline[2]) <span class="keywordflow">and</span> <a class="code" href="namespaceforcebalance_1_1molecule.html#afe989ffd119568047fc8265b1d329a70">isfloat</a>(sline[3]):</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;                    elem.append(sline[0])</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;                    xyz.append(np.array([float(sline[1]),float(sline[2]),float(sline[3])]))</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;            <span class="keywordflow">elif</span> inxyz:</div>
<div class="line"><a name="l01814"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#ad8fa6cc7424aae00ee3f5bb87d28e037"> 1814</a></span>&#160;                <span class="keywordflow">break</span></div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;            ln += 1</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;            absln += 1</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;        Answer = {<span class="stringliteral">&#39;xyzs&#39;</span>   : [np.array(xyz)],</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;                  <span class="stringliteral">&#39;elem&#39;</span>   : elem,</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;                  <span class="stringliteral">&#39;comms&#39;</span>  : [comfile[title_ln].strip()],</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;                  <span class="stringliteral">&#39;charge&#39;</span> : charge,</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;                  <span class="stringliteral">&#39;mult&#39;</span>   : mult}</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;        <span class="keywordflow">return</span> Answer</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#aeb5983ae61079198f077f55e448e2c32">read_arc</a>(self, fnm, **kwargs):</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Read a TINKER .arc file.</span></div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;<span class="stringliteral">        @param[in] fnm  The input file name</span></div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;<span class="stringliteral">        @return xyzs    A list for the  XYZ coordinates.</span></div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;<span class="stringliteral">        @return boxes   A list of periodic boxes (newer .arc files have these)</span></div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;<span class="stringliteral">        @return resid   The residue ID numbers.  These are not easy to get!</span></div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;<span class="stringliteral">        @return elem    A list of chemical elements in the XYZ file</span></div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;<span class="stringliteral">        @return comms   A single-element list for the comment.</span></div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;<span class="stringliteral">        @return tinkersuf  The suffix that comes after lines in the XYZ coordinates; this is usually topology info</span></div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;        tinkersuf   = []</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;        boxes = []</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;        xyzs  = []</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;        xyz   = []</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;        resid = []</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;        elem  = []</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;        comms = []</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;        thisres = set([])</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;        forwardres = set([])</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;        title = <span class="keyword">True</span></div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;        nframes = 0</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;        thisresid   = 1</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;        ln = 0</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;        thisatom = 0</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;        <span class="keywordflow">for</span> line <span class="keywordflow">in</span> open(fnm):</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;            line = line.strip().expandtabs()</div>
<div class="line"><a name="l01853"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a861feda06e1f60ab25c45eaaaf228cfc"> 1853</a></span>&#160;            sline = line.split()</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;            <span class="keywordflow">if</span> len(sline) == 0: <span class="keywordflow">continue</span></div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;            <span class="comment"># The first line always contains the number of atoms</span></div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;            <span class="comment"># The words after the first line are comments</span></div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;            <span class="keywordflow">if</span> title:</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;                na = int(sline[0])</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;                comms.append(<span class="stringliteral">&#39; &#39;</span>.join(sline[1:]))</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;                title = <span class="keyword">False</span></div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;            <span class="keywordflow">elif</span> len(sline) &gt;= 5:</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;                <span class="keywordflow">if</span> len(sline) == 6 <span class="keywordflow">and</span> <a class="code" href="namespaceforcebalance_1_1molecule.html#afe989ffd119568047fc8265b1d329a70">isfloat</a>(sline[1]) <span class="keywordflow">and</span> all([<a class="code" href="namespaceforcebalance_1_1molecule.html#afe989ffd119568047fc8265b1d329a70">isfloat</a>(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> sline]): <span class="comment"># Newer .arc files have a .box line.</span></div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;                    a, b, c, alpha, beta, gamma = (float(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> sline[:6])</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;                    boxes.append(<a class="code" href="namespaceforcebalance_1_1molecule.html#a0a6e3e79b04534bf2e83d09def189444">BuildLatticeFromLengthsAngles</a>(a, b, c, alpha, beta, gamma))</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;                <span class="keywordflow">elif</span> <a class="code" href="namespaceforcebalance_1_1molecule.html#a0dd31eff88d2bed0884ab21a13261d42">isint</a>(sline[0]) <span class="keywordflow">and</span> <a class="code" href="namespaceforcebalance_1_1molecule.html#afe989ffd119568047fc8265b1d329a70">isfloat</a>(sline[2]) <span class="keywordflow">and</span> <a class="code" href="namespaceforcebalance_1_1molecule.html#afe989ffd119568047fc8265b1d329a70">isfloat</a>(sline[3]) <span class="keywordflow">and</span> <a class="code" href="namespaceforcebalance_1_1molecule.html#afe989ffd119568047fc8265b1d329a70">isfloat</a>(sline[4]): <span class="comment"># A line of data better look like this</span></div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;                    <span class="keywordflow">if</span> nframes == 0:</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;                        elem.append(<a class="code" href="namespaceforcebalance_1_1molecule.html#a7429f0c377d6396711c128f6590ef810">elem_from_atomname</a>(sline[1]))</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;                        resid.append(thisresid)</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;                        whites      = re.split(<span class="stringliteral">&#39;[^ ]+&#39;</span>,line)</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;                        <span class="keywordflow">if</span> len(sline) &gt; 5:</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;                            s = sline[5:]</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;                            <span class="keywordflow">if</span> len(s) &gt; 1:</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;                                sn = [int(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> s[1:]]</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;                                s = [s[0]] + list(np.array(s[1:])[np.argsort(sn)])</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;                            tinkersuf.append(<span class="stringliteral">&#39;&#39;</span>.join([whites[j]+s[j-5] <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(5,len(sline))]))</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;                        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;                            tinkersuf.append(<span class="stringliteral">&#39;&#39;</span>)</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;                    <span class="comment"># LPW Make sure ..</span></div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;                    thisatom += 1</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;                    <span class="comment">#thisatom = int(sline[0])</span></div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;                    thisres.add(thisatom)</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;                    forwardres.add(thisatom)</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;                    <span class="keywordflow">if</span> len(sline) &gt;= 6:</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;                        forwardres.update([int(j) <span class="keywordflow">for</span> j <span class="keywordflow">in</span> sline[6:]])</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;                    <span class="keywordflow">if</span> thisres == forwardres:</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;                        thisres = set([])</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;                        forwardres = set([])</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;                        thisresid += 1</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;                    xyz.append([float(sline[2]),float(sline[3]),float(sline[4])])</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;                    <span class="keywordflow">if</span> thisatom == na:</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;                        thisatom = 0</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;                        nframes += 1</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;                        title = <span class="keyword">True</span></div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;                        xyzs.append(np.array(xyz))</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;                        xyz = []</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;            ln += 1</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;        Answer = {<span class="stringliteral">&#39;xyzs&#39;</span>   : xyzs,</div>
<div class="line"><a name="l01898"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#aeb5983ae61079198f077f55e448e2c32"> 1898</a></span>&#160;                  <span class="stringliteral">&#39;resid&#39;</span>  : resid,</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;                  <span class="stringliteral">&#39;elem&#39;</span>   : elem,</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;                  <span class="stringliteral">&#39;comms&#39;</span>  : comms,</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;                  <span class="stringliteral">&#39;tinkersuf&#39;</span> : tinkersuf}</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;        <span class="keywordflow">if</span> len(boxes) &gt; 0: Answer[<span class="stringliteral">&#39;boxes&#39;</span>] = boxes</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;        <span class="keywordflow">return</span> Answer</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a963a4382dc59ebd8dd9ee2064843e355">read_gro</a>(self, fnm, **kwargs):</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Read a GROMACS .gro file.</span></div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;        xyzs     = []</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;        elem     = [] <span class="comment"># The element, most useful for quantum chemistry calculations</span></div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;        atomname = [] <span class="comment"># The atom name, for instance &#39;HW1&#39;</span></div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;        comms    = []</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;        resid    = []</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;        resname  = []</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;        boxes    = []</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;        xyz      = []</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;        ln       = 0</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;        frame    = 0</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;        absln    = 0</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;        na       = -10</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;        <span class="keywordflow">for</span> line <span class="keywordflow">in</span> open(fnm):</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;            sline = line.split()</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;            <span class="keywordflow">if</span> ln == 0:</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;                comms.append(line.strip())</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;            <span class="keywordflow">elif</span> ln == 1:</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;                na = int(line.strip())</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;            <span class="keywordflow">elif</span> ln == na + 2:</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;                box = [float(i)*10 <span class="keywordflow">for</span> i <span class="keywordflow">in</span> sline]</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;                <span class="keywordflow">if</span> len(box) == 3:</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;                    a = box[0]</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;                    b = box[1]</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;                    c = box[2]</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;                    alpha = 90.0</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;                    beta = 90.0</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;                    gamma = 90.0</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;                    boxes.append(<a class="code" href="namespaceforcebalance_1_1molecule.html#a0a6e3e79b04534bf2e83d09def189444">BuildLatticeFromLengthsAngles</a>(a, b, c, alpha, beta, gamma))</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;                <span class="keywordflow">elif</span> len(box) == 9:</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;                    v1 = np.array([box[0], box[3], box[4]])</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;                    v2 = np.array([box[5], box[1], box[6]])</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;                    v3 = np.array([box[7], box[8], box[2]])</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;                    boxes.append(<a class="code" href="namespaceforcebalance_1_1molecule.html#a29fb1ac9324f4280f07c65baea339989">BuildLatticeFromVectors</a>(v1, v2, v3))</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;                xyzs.append(np.array(xyz)*10)</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;                xyz = []</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;                ln = -1</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;                frame += 1</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;                coord = []</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;                <span class="keywordflow">if</span> frame == 0: <span class="comment"># Create the list of residues, atom names etc. only if it&#39;s the first frame.</span></div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;                    <span class="comment"># Name of the residue, for instance &#39;153SOL1 -&gt; SOL1&#39; ; strips leading numbers</span></div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;                    thisresid = int(line[0:5].strip())</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;                    resid.append(thisresid)</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;                    thisresname = line[5:10].strip()</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;                    resname.append(thisresname)</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;                    thisatomname = line[10:15].strip()</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;                    atomname.append(thisatomname)</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;                    pdeci = [i <span class="keywordflow">for</span> i, x <span class="keywordflow">in</span> enumerate(line) <span class="keywordflow">if</span> x == <span class="stringliteral">&#39;.&#39;</span>]</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;                    ndeci = pdeci[1] - pdeci[0] - 5</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;                    thiselem = sline[1]</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;                    <span class="keywordflow">if</span> len(thiselem) &gt; 1:</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;                        thiselem = thiselem[0] + re.sub(<span class="stringliteral">&#39;[A-Z0-9]&#39;</span>,<span class="stringliteral">&#39;&#39;</span>,thiselem[1:])</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;                    elem.append(thiselem)</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;                <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1,4):</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;                    <span class="keywordflow">try</span>:</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;                        thiscoord = float(line[(pdeci[0]-4)+(5+ndeci)*(i-1):(pdeci[0]-4)+(5+ndeci)*i].strip())</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;                    <span class="keywordflow">except</span>: <span class="comment"># Attempt to read incorrectly formatted GRO files.</span></div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;                        thiscoord = float(line.split()[i+2])</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;                    coord.append(thiscoord)</div>
<div class="line"><a name="l01971"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a963a4382dc59ebd8dd9ee2064843e355"> 1971</a></span>&#160;                xyz.append(coord)</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;            ln += 1</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;            absln += 1</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;        Answer = {<span class="stringliteral">&#39;xyzs&#39;</span>     : xyzs,</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;                  <span class="stringliteral">&#39;elem&#39;</span>     : elem,</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;                  <span class="stringliteral">&#39;atomname&#39;</span> : atomname,</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;                  <span class="stringliteral">&#39;resid&#39;</span>    : resid,</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;                  <span class="stringliteral">&#39;resname&#39;</span>  : resname,</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;                  <span class="stringliteral">&#39;boxes&#39;</span>    : boxes,</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;                  <span class="stringliteral">&#39;comms&#39;</span>    : comms}</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;        <span class="keywordflow">return</span> Answer</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a8b8d3444945cab760288f28996787855">read_charmm</a>(self, fnm, **kwargs):</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Read a CHARMM .cor (or .crd) file.</span></div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;        xyzs     = []</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;        elem     = [] <span class="comment"># The element, most useful for quantum chemistry calculations</span></div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;        atomname = [] <span class="comment"># The atom name, for instance &#39;HW1&#39;</span></div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;        comms    = []</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;        resid    = []</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;        resname  = []</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;        xyz      = []</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;        thiscomm = []</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;        ln       = 0</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;        frame    = 0</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;        an       = 0</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;        <span class="keywordflow">for</span> line <span class="keywordflow">in</span> open(fnm):</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;            line = line.strip().expandtabs()</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;            sline = line.split()</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;            <span class="keywordflow">if</span> re.match(<span class="stringliteral">&#39;^\*&#39;</span>,line):</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;                <span class="keywordflow">if</span> len(sline) == 1:</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;                    comms.append(<span class="stringliteral">&#39;;&#39;</span>.join(list(thiscomm)))</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;                    thiscomm = []</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;                <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;                    thiscomm.append(<span class="stringliteral">&#39; &#39;</span>.join(sline[1:]))</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;            <span class="keywordflow">elif</span> re.match(<span class="stringliteral">&#39;^ *[0-9]+ +(EXT)?$&#39;</span>,line):</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;                na = int(sline[0])</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;            <span class="keywordflow">elif</span> <a class="code" href="namespaceforcebalance_1_1molecule.html#a838d85848bd817e801d0f5f6502217ef">is_charmm_coord</a>(line):</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;                <span class="keywordflow">if</span> frame == 0: <span class="comment"># Create the list of residues, atom names etc. only if it&#39;s the first frame.</span></div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;                    resid.append(sline[1])</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;                    resname.append(sline[2])</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;                    atomname.append(sline[3])</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;                    thiselem = sline[3]</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;                    <span class="keywordflow">if</span> len(thiselem) &gt; 1:</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;                        thiselem = thiselem[0] + re.sub(<span class="stringliteral">&#39;[A-Z0-9]&#39;</span>,<span class="stringliteral">&#39;&#39;</span>,thiselem[1:])</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;                    elem.append(thiselem)</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;                xyz.append([float(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> sline[4:7]])</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;                an += 1</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;                <span class="keywordflow">if</span> an == na:</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;                    xyzs.append(np.array(xyz))</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;                    xyz = []</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;                    an = 0</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;                    frame += 1</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;            ln += 1</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;        Answer = {<span class="stringliteral">&#39;xyzs&#39;</span>     : xyzs,</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;                  <span class="stringliteral">&#39;elem&#39;</span>     : elem,</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;                  <span class="stringliteral">&#39;atomname&#39;</span> : atomname,</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;                  <span class="stringliteral">&#39;resid&#39;</span>    : resid,</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;                  <span class="stringliteral">&#39;resname&#39;</span>  : resname,</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;                  <span class="stringliteral">&#39;comms&#39;</span>    : comms}</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;        <span class="keywordflow">return</span> Answer</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a003b182b54de4473c4691ae1474b1ada">read_qcin</a>(self, fnm, **kwargs):</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Read a Q-Chem input file.</span></div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;<span class="stringliteral">        These files can be very complicated, and I can&#39;t write a completely</span></div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;<span class="stringliteral">        general parser for them.  It is important to keep our goal in</span></div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;<span class="stringliteral">        mind:</span></div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;<span class="stringliteral">        1) The main goal is to convert a trajectory to Q-Chem input</span></div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;<span class="stringliteral">        files with identical calculation settings.</span></div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;<span class="stringliteral">        2) When we print the Q-Chem file, we should preserve the line</span></div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;<span class="stringliteral">        ordering of the &#39;rem&#39; section, but also be able to add &#39;rem&#39;</span></div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;<span class="stringliteral">        options at the end.</span></div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;<span class="stringliteral">        3) We should accommodate the use case that the Q-Chem file may have</span></div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;<span class="stringliteral">        follow-up calculations delimited by &#39;@@@@&#39;.</span></div>
<div class="line"><a name="l02051"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a8b8d3444945cab760288f28996787855"> 2051</a></span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;<span class="stringliteral">        4) We can read in all of the xyz&#39;s as a trajectory, but only the</span></div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;<span class="stringliteral">        Q-Chem settings belonging to the first xyz will be saved.</span></div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;        qcrem                = OrderedDict()</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;        qcrems               = []</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;        xyz                  = []</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;        xyzs                 = []</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;        elem                 = []</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;        section              = <span class="keywordtype">None</span></div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;        <span class="comment"># The Z-matrix printing in new versions throws me off.</span></div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;        zmatrix              = <span class="keyword">False</span></div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;        template             = []</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;        fff = <span class="keyword">False</span></div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;        inside_section       = <span class="keyword">False</span></div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;        reading_template     = <span class="keyword">True</span></div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;        charge               = 0</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;        mult                 = 0</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;        Answer               = {}</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;        SectionData          = []</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;        template_cut         = 0</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;        readsuf              = <span class="keyword">True</span></div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;        suffix               = [] <span class="comment"># The suffix, which comes after every atom line in the $molecule section, is for determining the MM atom type and topology.</span></div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;        ghost                = [] <span class="comment"># If the element in the $molecule section is preceded by an &#39;@&#39; sign, it&#39;s a ghost atom for counterpoise calculations.</span></div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;        infsm                = <span class="keyword">False</span></div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;        <span class="keywordflow">for</span> line <span class="keywordflow">in</span> open(fnm).readlines():</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;            line = line.strip().expandtabs()</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;            sline = line.split()</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;            dline = line.split(<span class="stringliteral">&#39;!&#39;</span>)[0].<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a71da1c1e530afd8b9b5f08d9bd27259f">split</a>()</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&quot;Z-matrix Print&quot;</span> <span class="keywordflow">in</span> line:</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;                zmatrix = <span class="keyword">True</span></div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;            <span class="keywordflow">if</span> re.match(<span class="stringliteral">&#39;^\$&#39;</span>,line):</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;                wrd = re.sub(<span class="stringliteral">&#39;\$&#39;</span>,<span class="stringliteral">&#39;&#39;</span>,line)</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;                <span class="keywordflow">if</span> wrd == <span class="stringliteral">&#39;end&#39;</span>:</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;                    zmatrix = <span class="keyword">False</span></div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;                    inside_section = <span class="keyword">False</span></div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;                    <span class="keywordflow">if</span> section == <span class="stringliteral">&#39;molecule&#39;</span>:</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;                        <span class="keywordflow">if</span> len(xyz) &gt; 0:</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;                            xyzs.append(np.array(xyz))</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;                        xyz = []</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;                        fff = <span class="keyword">True</span></div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;                        <span class="keywordflow">if</span> suffix != []:</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;                            readsuf = <span class="keyword">False</span></div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;                    <span class="keywordflow">elif</span> section == <span class="stringliteral">&#39;rem&#39;</span>:</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;                        <span class="keywordflow">if</span> reading_template:</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;                            qcrems.append(qcrem)</div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;                            qcrem = OrderedDict()</div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;                    <span class="keywordflow">if</span> reading_template:</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;                        <span class="keywordflow">if</span> section != <span class="stringliteral">&#39;external_charges&#39;</span>: <span class="comment"># Ignore the external charges section because it varies from frame to frame.</span></div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;                            template.append((section,SectionData))</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;                    SectionData = []</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;                <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;                    section = wrd</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;                    inside_section = <span class="keyword">True</span></div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;            <span class="keywordflow">elif</span> inside_section:</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;                <span class="keywordflow">if</span> section == <span class="stringliteral">&#39;molecule&#39;</span> <span class="keywordflow">and</span> <span class="keywordflow">not</span> zmatrix:</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;                    <span class="keywordflow">if</span> line.startswith(<span class="stringliteral">&quot;*&quot;</span>):</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;                        infsm = <span class="keyword">True</span></div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;                    <span class="keywordflow">if</span> (<span class="keywordflow">not</span> infsm) <span class="keywordflow">and</span> (len(dline) &gt;= 4 <span class="keywordflow">and</span> all([<a class="code" href="namespaceforcebalance_1_1molecule.html#afe989ffd119568047fc8265b1d329a70">isfloat</a>(dline[i]) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1,4)])):</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;                        <span class="keywordflow">if</span> fff:</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;                            reading_template = <span class="keyword">False</span></div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;                            template_cut = list(i <span class="keywordflow">for</span> i, dat <span class="keywordflow">in</span> enumerate(template) <span class="keywordflow">if</span> dat[0] == <span class="stringliteral">&#39;@@@@&#39;</span>)[-1]</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;                        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;                            <span class="keywordflow">if</span> re.match(<span class="stringliteral">&#39;^@&#39;</span>, sline[0]): <span class="comment"># This is a ghost atom</span></div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;                                ghost.append(<span class="keyword">True</span>)</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;                            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l02120"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a003b182b54de4473c4691ae1474b1ada"> 2120</a></span>&#160;                                ghost.append(<span class="keyword">False</span>)</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;                            elem.append(re.sub(<span class="stringliteral">&#39;@&#39;</span>,<span class="stringliteral">&#39;&#39;</span>,sline[0]))</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;                        xyz.append([float(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> sline[1:4]])</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;                        <span class="keywordflow">if</span> readsuf <span class="keywordflow">and</span> len(sline) &gt; 4:</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;                            whites      = re.split(<span class="stringliteral">&#39;[^ ]+&#39;</span>,line)</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;                            suffix.append(<span class="stringliteral">&#39;&#39;</span>.join([whites[j]+sline[j] <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(4,len(sline))]))</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;                    <span class="keywordflow">elif</span> re.match(<span class="stringliteral">&quot;[+-]?[0-9]+ +[0-9]+$&quot;</span>,line.split(<span class="stringliteral">&#39;!&#39;</span>)[0].strip()):</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;                        <span class="keywordflow">if</span> <span class="keywordflow">not</span> fff:</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;                            charge = int(sline[0])</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;                            mult = int(sline[1])</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;                    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;                        SectionData.append(line)</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;                <span class="keywordflow">elif</span> reading_template <span class="keywordflow">and</span> <span class="keywordflow">not</span> zmatrix:</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;                    <span class="keywordflow">if</span> section == <span class="stringliteral">&#39;basis&#39;</span>:</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;                        SectionData.append(line.split(<span class="stringliteral">&#39;!&#39;</span>)[0])</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;                    <span class="keywordflow">elif</span> section == <span class="stringliteral">&#39;rem&#39;</span>:</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;                        S = splitter.findall(line)</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;                        <span class="keywordflow">if</span> S[0] == <span class="stringliteral">&#39;!&#39;</span>:</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;                            qcrem[<span class="stringliteral">&#39;&#39;</span>.join(S[0:3]).lower()] = <span class="stringliteral">&#39;&#39;</span>.join(S[4:])</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;                        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;                            qcrem[S[0].lower()] = <span class="stringliteral">&#39;&#39;</span>.join(S[2:])</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;                    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;                        SectionData.append(line)</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;            <span class="keywordflow">elif</span> re.match(<span class="stringliteral">&#39;^@+$&#39;</span>, line) <span class="keywordflow">and</span> reading_template:</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;                template.append((<span class="stringliteral">&#39;@@@@&#39;</span>, []))</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;            <span class="keywordflow">elif</span> re.match(<span class="stringliteral">&#39;Welcome to Q-Chem&#39;</span>, line) <span class="keywordflow">and</span> reading_template <span class="keywordflow">and</span> fff:</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;                template.append((<span class="stringliteral">&#39;@@@@&#39;</span>, []))</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;        <span class="keywordflow">if</span> template_cut != 0:</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;            template = template[:template_cut]</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;        Answer = {<span class="stringliteral">&#39;qctemplate&#39;</span>  : template,</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;                  <span class="stringliteral">&#39;qcrems&#39;</span>      : qcrems,</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;                  <span class="stringliteral">&#39;charge&#39;</span>      : charge,</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;                  <span class="stringliteral">&#39;mult&#39;</span>        : mult,</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;                  }</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;        <span class="keywordflow">if</span> suffix != []:</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;            Answer[<span class="stringliteral">&#39;qcsuf&#39;</span>] = suffix</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;        <span class="keywordflow">if</span> len(xyzs) &gt; 0:</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;            Answer[<span class="stringliteral">&#39;xyzs&#39;</span>] = xyzs</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;            Answer[<span class="stringliteral">&#39;xyzs&#39;</span>] = [np.array([])]</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;        <span class="keywordflow">if</span> len(elem) &gt; 0:</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;            Answer[<span class="stringliteral">&#39;elem&#39;</span>] = elem</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;        <span class="keywordflow">if</span> len(ghost) &gt; 0:</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;            Answer[<span class="stringliteral">&#39;qm_ghost&#39;</span>] = ghost</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;        <span class="keywordflow">return</span> Answer</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#afadc87c0cc32dc73558cd901a4c64dd4">read_pdb</a>(self, fnm, **kwargs):</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Loads a PDB and returns a dictionary containing its data. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;        F1=file(fnm,<span class="stringliteral">&#39;</span><span class="stringliteral">r&#39;)</span></div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;<span class="stringliteral">        ParsedPDB=readPDB(F1)</span></div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;<span class="stringliteral">        Box = </span><span class="keywordtype">None</span></div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;        <span class="comment">#Separate into distinct lists for each model.</span></div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;        PDBLines=[[]]</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;        <span class="keywordflow">for</span> x <span class="keywordflow">in</span> ParsedPDB[0]:</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;            <span class="keywordflow">if</span> x.__class__ <span class="keywordflow">in</span> [END, ENDMDL]:</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;                PDBLines.append([])</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;            <span class="keywordflow">if</span> x.__class__ <span class="keywordflow">in</span> [ATOM, HETATM]:</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;                PDBLines[-1].<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a77417ff99b19f6d0b7c6f527e83fa7f1">append</a>(x)</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;            <span class="keywordflow">if</span> x.__class__==CRYST1:</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;                Box = <a class="code" href="namespaceforcebalance_1_1molecule.html#a0a6e3e79b04534bf2e83d09def189444">BuildLatticeFromLengthsAngles</a>(x.a, x.b, x.c, x.alpha, x.beta, x.gamma)</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;        X=PDBLines[0]</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;        XYZ=np.array([[x.x,x.y,x.z] <span class="keywordflow">for</span> x <span class="keywordflow">in</span> X])/10.0<span class="comment">#Convert to nanometers</span></div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;        AltLoc=np.array([x.altLoc <span class="keywordflow">for</span> x <span class="keywordflow">in</span> X],<span class="stringliteral">&#39;str&#39;</span>) <span class="comment"># Alternate location</span></div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;        ICode=np.array([x.iCode <span class="keywordflow">for</span> x <span class="keywordflow">in</span> X],<span class="stringliteral">&#39;str&#39;</span>) <span class="comment"># Insertion code</span></div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;        ChainID=np.array([x.chainID <span class="keywordflow">for</span> x <span class="keywordflow">in</span> X],<span class="stringliteral">&#39;str&#39;</span>)</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;        AtomNames=np.array([x.name <span class="keywordflow">for</span> x <span class="keywordflow">in</span> X],<span class="stringliteral">&#39;str&#39;</span>)</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;        ResidueNames=np.array([x.resName <span class="keywordflow">for</span> x <span class="keywordflow">in</span> X],<span class="stringliteral">&#39;str&#39;</span>)</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;        ResidueID=np.array([x.resSeq <span class="keywordflow">for</span> x <span class="keywordflow">in</span> X],<span class="stringliteral">&#39;int&#39;</span>)</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;        <span class="comment"># Try not to number Residue IDs starting from 1...</span></div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#af9d8dc89fee54b2b89558633f2c9b70a">positive_resid</a>:</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;            ResidueID=ResidueID-ResidueID[0]+1</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;        XYZList=[]</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;        <span class="keywordflow">for</span> Model <span class="keywordflow">in</span> PDBLines:</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;            <span class="comment"># Skip over subsequent models with the wrong number of atoms.</span></div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;            NewXYZ = []</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;            <span class="keywordflow">for</span> x <span class="keywordflow">in</span> Model:</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;                NewXYZ.append([x.x,x.y,x.z])</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;            <span class="keywordflow">if</span> len(XYZList) == 0:</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;                XYZList.append(NewXYZ)</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;            <span class="keywordflow">elif</span> len(XYZList) &gt;= 1 <span class="keywordflow">and</span> (np.array(NewXYZ).shape == np.array(XYZList[-1]).shape):</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;                XYZList.append(NewXYZ)</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;        <span class="keywordflow">if</span> len(XYZList[-1])==0:<span class="comment">#If PDB contains trailing END / ENDMDL, remove empty list</span></div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;            XYZList.pop()</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;        <span class="comment"># Build a list of chemical elements</span></div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;        elem = []</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> AtomNames:</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;            thiselem = i</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;            <span class="keywordflow">if</span> len(thiselem) &gt; 1:</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;                thiselem = re.sub(<span class="stringliteral">&#39;^[0-9]&#39;</span>,<span class="stringliteral">&#39;&#39;</span>,thiselem)</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;                thiselem = thiselem[0] + re.sub(<span class="stringliteral">&#39;[A-Z0-9]&#39;</span>,<span class="stringliteral">&#39;&#39;</span>,thiselem[1:])</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;            elem.append(thiselem)</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;        XYZList=list(np.array(XYZList).reshape((-1,len(ChainID),3)))</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;        bonds = []</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;        <span class="comment"># Read in CONECT records.</span></div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;        F2=open(fnm,<span class="stringliteral">&#39;</span><span class="stringliteral">r&#39;)</span></div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;<span class="stringliteral">        </span><span class="keywordflow">for</span> line <span class="keywordflow">in</span> F2:</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;            s = line.split()</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;            <span class="keywordflow">if</span> s[0].upper() == <span class="stringliteral">&quot;CONECT&quot;</span>:</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;                <span class="keywordflow">if</span> len(s) &gt; 2:</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;                    <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(2, len(s)):</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;                        bonds.append((int(s[1])-1, int(s[i])-1))</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;        Answer={<span class="stringliteral">&quot;xyzs&quot;</span>:XYZList, <span class="stringliteral">&quot;chain&quot;</span>:ChainID, <span class="stringliteral">&quot;altloc&quot;</span>:AltLoc, <span class="stringliteral">&quot;icode&quot;</span>:ICode, <span class="stringliteral">&quot;atomname&quot;</span>:AtomNames,</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;                <span class="stringliteral">&quot;resid&quot;</span>:ResidueID, <span class="stringliteral">&quot;resname&quot;</span>:ResidueNames, <span class="stringliteral">&quot;elem&quot;</span>:elem,</div>
<div class="line"><a name="l02237"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#afadc87c0cc32dc73558cd901a4c64dd4"> 2237</a></span>&#160;                <span class="stringliteral">&quot;comms&quot;</span>:[<span class="stringliteral">&#39;&#39;</span> <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(XYZList))]}</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;        <span class="keywordflow">if</span> len(bonds) &gt; 0:</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;            Answer[<span class="stringliteral">&quot;bonds&quot;</span>] = bonds</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;        <span class="keywordflow">if</span> Box != <span class="keywordtype">None</span>:</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;            Answer[<span class="stringliteral">&quot;boxes&quot;</span>] = [Box <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(XYZList))]</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;        <span class="keywordflow">return</span> Answer</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a27fb6201b435a3b205ae62f605256f3d">read_qcesp</a>(self, fnm, **kwargs):</div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;        espxyz = []</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;        espval = []</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;        <span class="keywordflow">for</span> line <span class="keywordflow">in</span> open(fnm):</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;            line = line.strip().expandtabs()</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;            sline = line.split()</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;            <span class="keywordflow">if</span> len(sline) == 4 <span class="keywordflow">and</span> all([<a class="code" href="namespaceforcebalance_1_1molecule.html#afe989ffd119568047fc8265b1d329a70">isfloat</a>(sline[i]) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(4)]):</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;                espxyz.append([float(sline[i]) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(3)])</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;                espval.append(float(sline[3]))</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;        Answer = {<span class="stringliteral">&#39;qm_espxyzs&#39;</span> : [np.array(espxyz) * bohrang],</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;                  <span class="stringliteral">&#39;qm_espvals&#39;</span>  : [np.array(espval)]</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;                  }</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;        <span class="keywordflow">return</span> Answer</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;    </div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a8c9e71843e7123c57c43c24af2d84f25">read_qcout</a>(self, fnm, errok = [], **kwargs):</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Q-Chem output file reader, adapted for our parser. </span></div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;<span class="stringliteral">        Q-Chem output files are very flexible and there&#39;s no way I can account for all of them.  Here&#39;s what</span></div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;<span class="stringliteral">        I am able to account for:</span></div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;<span class="stringliteral">        </span></div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;<span class="stringliteral">        A list of:</span></div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;<span class="stringliteral">        - Coordinates</span></div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;<span class="stringliteral">        - Energies</span></div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;<span class="stringliteral">        - Forces</span></div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;<span class="stringliteral">        Calling with errok will proceed with reading file even if the specified error messages are encountered.</span></div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;<span class="stringliteral">        Note that each step in a geometry optimization counts as a frame.</span></div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;<span class="stringliteral">        As with all Q-Chem output files, note that successive calculations can have different numbers of atoms.</span></div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;<span class="stringliteral">    </span></div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;        Answer   = {}</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;        xyzs     = []</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;        xyz      = []</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;        elem     = []</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;        elemThis = []</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;        mkchg    = []</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;        mkspn    = []</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;        mkchgThis= []</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;        mkspnThis= []</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;        XMode    = 0</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;        MMode    = 0</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;        conv     = []</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;        convThis = 0</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;        readChargeMult = 0</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;        energy_scf = []</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;        float_match  = {<span class="stringliteral">&#39;energy_scfThis&#39;</span>   : (<span class="stringliteral">&quot;^[1-9][0-9]* +[-+]?([0-9]*\.)?[0-9]+ +[-+]?([0-9]*\.)?[0-9]+([eE][-+]?[0-9]+)[A-Za-z0 ]*$&quot;</span>, 1),</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;                        <span class="stringliteral">&#39;energy_opt&#39;</span>       : (<span class="stringliteral">&quot;^Final energy is +[-+]?([0-9]*\.)?[0-9]+$&quot;</span>, -1),</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;                        <span class="stringliteral">&#39;charge&#39;</span>           : (<span class="stringliteral">&quot;Sum of atomic charges&quot;</span>, -1),</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;                        <span class="stringliteral">&#39;mult&#39;</span>             : (<span class="stringliteral">&quot;Sum of spin +charges&quot;</span>, -1),</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;                        <span class="stringliteral">&#39;energy_mp2&#39;</span>       : (<span class="stringliteral">&quot;^(ri)*(-)*mp2 +total energy += +[-+]?([0-9]*\.)?[0-9]+ +au$&quot;</span>,-2),</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;                        <span class="stringliteral">&#39;energy_ccsd&#39;</span>      : (<span class="stringliteral">&quot;^CCSD Total Energy += +[-+]?([0-9]*\.)?[0-9]+$&quot;</span>,-1),</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;                        <span class="stringliteral">&#39;energy_ccsdt&#39;</span>     : (<span class="stringliteral">&quot;^CCSD\(T\) Total Energy += +[-+]?([0-9]*\.)?[0-9]+$&quot;</span>,-1)</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;                        }</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;        matrix_match = {<span class="stringliteral">&#39;analytical_grad&#39;</span>  :<span class="stringliteral">&#39;Full Analytical Gradient&#39;</span>,</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;                        <span class="stringliteral">&#39;gradient_scf&#39;</span>     :<span class="stringliteral">&#39;Gradient of SCF Energy&#39;</span>,</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;                        <span class="stringliteral">&#39;gradient_mp2&#39;</span>     :<span class="stringliteral">&#39;Gradient of MP2 Energy&#39;</span>,</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;                        <span class="stringliteral">&#39;gradient_dualbas&#39;</span> :<span class="stringliteral">&#39;Gradient of the Dual-Basis Energy&#39;</span>,</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;                        <span class="stringliteral">&#39;hessian_scf&#39;</span>      :<span class="stringliteral">&#39;Hessian of the SCF Energy&#39;</span></div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;                        }</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;        qcrem    = OrderedDict()</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;        matblank   = {<span class="stringliteral">&#39;match&#39;</span> : <span class="stringliteral">&#39;&#39;</span>, <span class="stringliteral">&#39;All&#39;</span> : [], <span class="stringliteral">&#39;This&#39;</span> : [], <span class="stringliteral">&#39;Strip&#39;</span> : [], <span class="stringliteral">&#39;Mode&#39;</span> : 0}</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;        Mats      = {}</div>
<div class="line"><a name="l02312"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a27fb6201b435a3b205ae62f605256f3d"> 2312</a></span>&#160;        Floats    = {}</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;        <span class="keywordflow">for</span> key, val <span class="keywordflow">in</span> matrix_match.items():</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;            Mats[key] = copy.deepcopy(matblank)</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;        <span class="keywordflow">for</span> key, val <span class="keywordflow">in</span> float_match.items():</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;            Floats[key] = []</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;        <span class="comment">## Intrinsic reaction coordinate stuff</span></div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;        IRCDir = 0</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;        RPLine = <span class="keyword">False</span></div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;        <span class="comment">#---- Intrinsic reaction coordinate data.</span></div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;        <span class="comment"># stat: Status, X : Coordinates, E : Energies, Q : Charges, Sz: Spin-Z</span></div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;        <span class="comment"># Explanation of Status:</span></div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;        <span class="comment"># -1 : IRC calculation does not exist in this direction.</span></div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;        <span class="comment">#  0 : IRC calculation finished successfully.</span></div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;        <span class="comment">#  1 : IRC calculation did not finish but we can start a geometry optimization from the final point.</span></div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;        <span class="comment">#  2 : IRC calculation failed in this direction (i.e. set to 2 once we encounter first_irc_step).</span></div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;        <span class="comment"># Two dictionaries of coordinates, energies, Mulliken Charges and Spin Populations.</span></div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;        IRCData = [OrderedDict([(<span class="stringliteral">&#39;stat&#39;</span>, -1), (<span class="stringliteral">&#39;X&#39;</span>, []), (<span class="stringliteral">&#39;E&#39;</span>, []), (<span class="stringliteral">&#39;Q&#39;</span>, []), (<span class="stringliteral">&#39;Sz&#39;</span>, [])]) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(2)]</div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;    </div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;        Answer[<span class="stringliteral">&#39;qcerr&#39;</span>] = <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;        fatal = 0</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;        <span class="keywordflow">for</span> line <span class="keywordflow">in</span> open(fnm):</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;            line = line.strip().expandtabs()</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&#39;Welcome to Q-Chem&#39;</span> <span class="keywordflow">in</span> line:</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;                Answer[<span class="stringliteral">&#39;qcerr&#39;</span>] = <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&#39;total processes killed&#39;</span> <span class="keywordflow">in</span> line:</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;                Answer[<span class="stringliteral">&#39;qcerr&#39;</span>] = <span class="stringliteral">&#39;killed&#39;</span></div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;            <span class="keywordflow">if</span> fatal <span class="keywordflow">and</span> len(line.split()) &gt; 0:</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;                <span class="comment"># Print the error message that comes after the &quot;fatal error&quot; line.</span></div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;                <span class="keywordflow">if</span> line <span class="keywordflow">in</span> errok:</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;                    Answer[<span class="stringliteral">&#39;qcerr&#39;</span>] = line.strip()</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;                    fatal = 0</div>
<div class="line"><a name="l02344"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a8c9e71843e7123c57c43c24af2d84f25"> 2344</a></span>&#160;                <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;                    <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;Calculation encountered a fatal error! (%s)&#39;</span> % line)</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&#39;Q-Chem fatal error&#39;</span> <span class="keywordflow">in</span> line:</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;                fatal = 1</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;            <span class="keywordflow">if</span> XMode &gt;= 1:</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;                <span class="comment"># Perfectionist here; matches integer, element, and three floating points</span></div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;                <span class="keywordflow">if</span> re.match(<span class="stringliteral">&quot;^[0-9]+ +[A-Z][A-Za-z]?( +[-+]?([0-9]*\.)?[0-9]+){3}$&quot;</span>, line):</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;                    XMode = 2</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;                    sline = line.split()</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;                    elemThis.append(sline[1])</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;                    xyz.append([float(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> sline[2:]])</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;                <span class="keywordflow">elif</span> XMode == 2: <span class="comment"># Break out of the loop if we encounter anything other than atomic data</span></div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;                    <span class="keywordflow">if</span> elem == []:</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;                        elem = elemThis</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;                    <span class="keywordflow">elif</span> elem != elemThis:</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;                        <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;Q-Chem output parser will not work if successive calculations have different numbers of atoms!&#39;</span>)</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;                    elemThis = []</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;                    xyzs.append(np.array(xyz))</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;                    xyz  = []</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;                    XMode = 0</div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;            <span class="keywordflow">elif</span> re.match(<span class="stringliteral">&quot;Standard Nuclear Orientation&quot;</span>.lower(), line.lower()):</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;                XMode = 1</div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;            <span class="keywordflow">if</span> MMode &gt;= 1:</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;                <span class="comment"># Perfectionist here; matches integer, element, and two floating points</span></div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;                <span class="keywordflow">if</span> re.match(<span class="stringliteral">&quot;^[0-9]+ +[A-Z][a-z]?( +[-+]?([0-9]*\.)?[0-9]+){2}$&quot;</span>, line):</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;                    MMode = 2</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;                    sline = line.split()</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;                    mkchgThis.append(float(sline[2]))</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;                    mkspnThis.append(float(sline[3]))</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;                <span class="keywordflow">elif</span> MMode == 2: <span class="comment"># Break out of the loop if we encounter anything other than Mulliken charges</span></div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;                    mkchg.append(mkchgThis[:])</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;                    mkspn.append(mkspnThis[:])</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;                    mkchgThis = []</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;                    mkspnThis = []</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;                    MMode = 0</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;            <span class="keywordflow">elif</span> re.match(<span class="stringliteral">&quot;Ground-State Mulliken Net Atomic Charges&quot;</span>.lower(), line.lower()):</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;                MMode = 1</div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;            <span class="keywordflow">for</span> key, val <span class="keywordflow">in</span> float_match.items():</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;                <span class="keywordflow">if</span> re.match(val[0].lower(), line.lower()):</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;                    Floats[key].<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a77417ff99b19f6d0b7c6f527e83fa7f1">append</a>(float(line.split()[val[1]]))</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;            <span class="comment">#----- Begin Intrinsic reaction coordinate stuff</span></div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;            <span class="keywordflow">if</span> line.startswith(<span class="stringliteral">&#39;IRC&#39;</span>) <span class="keywordflow">and</span> IRCData[IRCDir][<span class="stringliteral">&#39;stat&#39;</span>] == -1:</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;                IRCData[IRCDir][<span class="stringliteral">&#39;stat&#39;</span>] = 2</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&quot;Reaction path following.&quot;</span> <span class="keywordflow">in</span> line:</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;                RPLine = <span class="keyword">True</span></div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;                IRCData[IRCDir][<span class="stringliteral">&#39;X&#39;</span>].<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a77417ff99b19f6d0b7c6f527e83fa7f1">append</a>(xyzs[-1])</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;            <span class="comment">## Assumes the IRC energy comes right after the coordinates.</span></div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;            <span class="keywordflow">elif</span> RPLine:</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;                RPLine = <span class="keyword">False</span></div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;                IRCData[IRCDir][<span class="stringliteral">&#39;E&#39;</span>].<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a77417ff99b19f6d0b7c6f527e83fa7f1">append</a>(float(line.split()[3]))</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;                IRCData[IRCDir][<span class="stringliteral">&#39;Q&#39;</span>].<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a77417ff99b19f6d0b7c6f527e83fa7f1">append</a>(mkchg[-1])</div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;                IRCData[IRCDir][<span class="stringliteral">&#39;Sz&#39;</span>].<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a77417ff99b19f6d0b7c6f527e83fa7f1">append</a>(mkspn[-1])</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;            <span class="comment">## Geometry optimization info can also get appended to IRC data.</span></div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;            <span class="comment">## This is because my qchem.py script recovers IRC jobs</span></div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;            <span class="comment">## that have failed from SCF convergence failures with geometry optimizations.</span></div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&quot;GEOMETRY OPTIMIZATION&quot;</span> <span class="keywordflow">in</span> line:</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;                IRCData[IRCDir][<span class="stringliteral">&#39;X&#39;</span>].<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a77417ff99b19f6d0b7c6f527e83fa7f1">append</a>(xyzs[-1])</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;                IRCData[IRCDir][<span class="stringliteral">&#39;E&#39;</span>].<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a77417ff99b19f6d0b7c6f527e83fa7f1">append</a>(energy_scf[-1])</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;                IRCData[IRCDir][<span class="stringliteral">&#39;Q&#39;</span>].<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a77417ff99b19f6d0b7c6f527e83fa7f1">append</a>(mkchg[-1])</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;                IRCData[IRCDir][<span class="stringliteral">&#39;Sz&#39;</span>].<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a77417ff99b19f6d0b7c6f527e83fa7f1">append</a>(mkspn[-1])</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;            <span class="comment"># Determine whether we are in the forward or the backward part of the IRC.</span></div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&quot;IRC -- convergence criterion reached.&quot;</span> <span class="keywordflow">in</span> line <span class="keywordflow">or</span> <span class="stringliteral">&quot;OPTIMIZATION CONVERGED&quot;</span> <span class="keywordflow">in</span> line:</div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;                IRCData[IRCDir][<span class="stringliteral">&#39;stat&#39;</span>] = 0</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;                IRCDir = 1</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&quot;MAXIMUM OPTIMIZATION CYCLES REACHED&quot;</span> <span class="keywordflow">in</span> line:</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;                IRCData[IRCDir][<span class="stringliteral">&#39;stat&#39;</span>] = 1</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;            <span class="comment"># Output file indicates whether we can start a geometry optimization from this point.</span></div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&quot;geom opt from&quot;</span> <span class="keywordflow">in</span> line:</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;                IRCData[IRCDir][<span class="stringliteral">&#39;stat&#39;</span>] = 1</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;                IRCDir = 1</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;            <span class="comment">#----- End IRC stuff</span></div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;            <span class="keywordflow">if</span> re.match(<span class="stringliteral">&quot;.*Convergence criterion met$&quot;</span>.lower(), line.lower()):</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;                conv.append(1)</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;                energy_scf.append(Floats[<span class="stringliteral">&#39;energy_scfThis&#39;</span>][-1])</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;                Floats[<span class="stringliteral">&#39;energy_scfThis&#39;</span>] = []</div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;            <span class="keywordflow">elif</span> re.match(<span class="stringliteral">&quot;.*Including correction$&quot;</span>.lower(), line.lower()):</div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;                energy_scf[-1] = Floats[<span class="stringliteral">&#39;energy_scfThis&#39;</span>][-1]</div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;                Floats[<span class="stringliteral">&#39;energy_scfThis&#39;</span>] = []</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;            <span class="keywordflow">elif</span> re.match(<span class="stringliteral">&quot;.*Convergence failure$&quot;</span>.lower(), line.lower()):</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;                conv.append(0)</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;                Floats[<span class="stringliteral">&#39;energy_scfThis&#39;</span>] = []</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;                energy_scf.append(0.0)</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;            <span class="keywordflow">for</span> key, val <span class="keywordflow">in</span> matrix_match.items():</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;                <span class="keywordflow">if</span> Mats[key][<span class="stringliteral">&quot;Mode&quot;</span>] &gt;= 1:</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;                    <span class="keywordflow">if</span> re.match(<span class="stringliteral">&quot;^[0-9]+( +[0-9]+)+$&quot;</span>,line):</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;                        Mats[key][<span class="stringliteral">&quot;This&quot;</span>] = <a class="code" href="namespaceforcebalance_1_1molecule.html#a4cdb2086978b281ed84cd66179c3f5b2">add_strip_to_mat</a>(Mats[key][<span class="stringliteral">&quot;This&quot;</span>],Mats[key][<span class="stringliteral">&quot;Strip&quot;</span>])</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;                        Mats[key][<span class="stringliteral">&quot;Strip&quot;</span>] = []</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;                    <span class="keywordflow">elif</span> re.match(<span class="stringliteral">&quot;^[0-9]+( +[-+]?([0-9]*\.)?[0-9]+)+$&quot;</span>,line):</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;                        Mats[key][<span class="stringliteral">&quot;Strip&quot;</span>].<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a77417ff99b19f6d0b7c6f527e83fa7f1">append</a>([float(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> line.split()[1:]])</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;                    <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;                        Mats[key][<span class="stringliteral">&quot;This&quot;</span>] = <a class="code" href="namespaceforcebalance_1_1molecule.html#a4cdb2086978b281ed84cd66179c3f5b2">add_strip_to_mat</a>(Mats[key][<span class="stringliteral">&quot;This&quot;</span>],Mats[key][<span class="stringliteral">&quot;Strip&quot;</span>])</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;                        Mats[key][<span class="stringliteral">&quot;Strip&quot;</span>] = []</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;                        Mats[key][<span class="stringliteral">&quot;All&quot;</span>].<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a77417ff99b19f6d0b7c6f527e83fa7f1">append</a>(np.array(Mats[key][<span class="stringliteral">&quot;This&quot;</span>]))</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;                        Mats[key][<span class="stringliteral">&quot;This&quot;</span>] = []</div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;                        Mats[key][<span class="stringliteral">&quot;Mode&quot;</span>] = 0</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;                <span class="keywordflow">elif</span> re.match(val.lower(), line.lower()):</div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;                    Mats[key][<span class="stringliteral">&quot;Mode&quot;</span>] = 1</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;        <span class="keywordflow">if</span> len(Floats[<span class="stringliteral">&#39;mult&#39;</span>]) == 0:</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;            Floats[<span class="stringliteral">&#39;mult&#39;</span>] = [0]</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;        <span class="comment"># Copy out the coordinate lists; Q-Chem output cannot be trusted to get the chemical elements</span></div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;        Answer[<span class="stringliteral">&#39;xyzs&#39;</span>] = xyzs</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;        Answer[<span class="stringliteral">&#39;elem&#39;</span>] = elem</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;        <span class="comment"># Read the output file as an input file to get a Q-Chem template.</span></div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;        Aux = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a003b182b54de4473c4691ae1474b1ada">read_qcin</a>(fnm)</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> [<span class="stringliteral">&#39;qctemplate&#39;</span>, <span class="stringliteral">&#39;qcrems&#39;</span>, <span class="stringliteral">&#39;elem&#39;</span>, <span class="stringliteral">&#39;qm_ghost&#39;</span>, <span class="stringliteral">&#39;charge&#39;</span>, <span class="stringliteral">&#39;mult&#39;</span>]:</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;            <span class="keywordflow">if</span> i <span class="keywordflow">in</span> Aux: Answer[i] = Aux[i]</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;        <span class="comment"># Copy out the charge and multiplicity</span></div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;        <span class="keywordflow">if</span> len(Floats[<span class="stringliteral">&#39;charge&#39;</span>]) &gt; 0:</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;            Answer[<span class="stringliteral">&#39;charge&#39;</span>] = int(Floats[<span class="stringliteral">&#39;charge&#39;</span>][0])</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;        <span class="keywordflow">if</span> len(Floats[<span class="stringliteral">&#39;mult&#39;</span>]) &gt; 0:</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;            Answer[<span class="stringliteral">&#39;mult&#39;</span>]   = int(Floats[<span class="stringliteral">&#39;mult&#39;</span>][0]) + 1</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;        <span class="comment"># Copy out the energies and forces</span></div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;        <span class="comment"># Q-Chem can print out gradients with several different headings.</span></div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;        <span class="comment"># We start with the most reliable heading and work our way down.</span></div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;        <span class="keywordflow">if</span> len(Mats[<span class="stringliteral">&#39;analytical_grad&#39;</span>][<span class="stringliteral">&#39;All&#39;</span>]) &gt; 0:</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;            Answer[<span class="stringliteral">&#39;qm_forces&#39;</span>] = Mats[<span class="stringliteral">&#39;analytical_grad&#39;</span>][<span class="stringliteral">&#39;All&#39;</span>]</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;        <span class="keywordflow">elif</span> len(Mats[<span class="stringliteral">&#39;gradient_mp2&#39;</span>][<span class="stringliteral">&#39;All&#39;</span>]) &gt; 0:</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;            Answer[<span class="stringliteral">&#39;qm_forces&#39;</span>] = Mats[<span class="stringliteral">&#39;gradient_mp2&#39;</span>][<span class="stringliteral">&#39;All&#39;</span>]</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;        <span class="keywordflow">elif</span> len(Mats[<span class="stringliteral">&#39;gradient_dualbas&#39;</span>][<span class="stringliteral">&#39;All&#39;</span>]) &gt; 0:</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;            Answer[<span class="stringliteral">&#39;qm_forces&#39;</span>] = Mats[<span class="stringliteral">&#39;gradient_dualbas&#39;</span>][<span class="stringliteral">&#39;All&#39;</span>]</div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;        <span class="keywordflow">elif</span> len(Mats[<span class="stringliteral">&#39;gradient_scf&#39;</span>][<span class="stringliteral">&#39;All&#39;</span>]) &gt; 0:</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;            Answer[<span class="stringliteral">&#39;qm_forces&#39;</span>] = Mats[<span class="stringliteral">&#39;gradient_scf&#39;</span>][<span class="stringliteral">&#39;All&#39;</span>]</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;        <span class="keywordflow">if</span> len(Mats[<span class="stringliteral">&#39;hessian_scf&#39;</span>][<span class="stringliteral">&#39;All&#39;</span>]) &gt; 0:</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;            Answer[<span class="stringliteral">&#39;qm_hessians&#39;</span>] = Mats[<span class="stringliteral">&#39;hessian_scf&#39;</span>][<span class="stringliteral">&#39;All&#39;</span>]</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;        <span class="comment">#else:</span></div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;        <span class="comment">#    raise Exception(&#39;There are no forces in %s&#39; % fnm)</span></div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;        <span class="comment"># Also work our way down with the energies.</span></div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;        <span class="keywordflow">if</span> len(Floats[<span class="stringliteral">&#39;energy_ccsdt&#39;</span>]) &gt; 0:</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;            Answer[<span class="stringliteral">&#39;qm_energies&#39;</span>] = Floats[<span class="stringliteral">&#39;energy_ccsdt&#39;</span>]</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;        <span class="keywordflow">elif</span> len(Floats[<span class="stringliteral">&#39;energy_ccsd&#39;</span>]) &gt; 0:</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;            Answer[<span class="stringliteral">&#39;qm_energies&#39;</span>] = Floats[<span class="stringliteral">&#39;energy_ccsd&#39;</span>]</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;        <span class="keywordflow">elif</span> len(Floats[<span class="stringliteral">&#39;energy_mp2&#39;</span>]) &gt; 0:</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;            Answer[<span class="stringliteral">&#39;qm_energies&#39;</span>] = Floats[<span class="stringliteral">&#39;energy_mp2&#39;</span>]</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;        <span class="keywordflow">elif</span> len(energy_scf) &gt; 0:</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&#39;correlation&#39;</span> <span class="keywordflow">in</span> Answer[<span class="stringliteral">&#39;qcrems&#39;</span>][0] <span class="keywordflow">and</span> Answer[<span class="stringliteral">&#39;qcrems&#39;</span>][0][<span class="stringliteral">&#39;correlation&#39;</span>].lower() <span class="keywordflow">in</span> [<span class="stringliteral">&#39;mp2&#39;</span>, <span class="stringliteral">&#39;rimp2&#39;</span>, <span class="stringliteral">&#39;ccsd&#39;</span>, <span class="stringliteral">&#39;ccsd(t)&#39;</span>]:</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;                <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&quot;Q-Chem was called with a post-HF theory but we only got the SCF energy&quot;</span>)</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;            Answer[<span class="stringliteral">&#39;qm_energies&#39;</span>] = energy_scf</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;        <span class="keywordflow">elif</span> <span class="stringliteral">&#39;SCF failed to converge&#39;</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> errok:</div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;            <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;There are no energies in %s&#39;</span> % fnm)</div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;    </div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;        <span class="comment">#### Sanity checks</span></div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;        <span class="comment"># We currently don&#39;t have a graceful way of dealing with SCF convergence failures in the output file.</span></div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;        <span class="comment"># For instance, a failed calculation will have elem / xyz but no forces. :/</span></div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;        <span class="keywordflow">if</span> 0 <span class="keywordflow">in</span> conv <span class="keywordflow">and</span> <span class="stringliteral">&#39;SCF failed to converge&#39;</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> errok:</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;            <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;SCF convergence failure encountered in parsing %s&#39;</span> % fnm)</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;        <span class="keywordflow">elif</span> (0 <span class="keywordflow">not</span> <span class="keywordflow">in</span> conv):</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;            <span class="comment"># The molecule should have only one charge and one multiplicity</span></div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;            <span class="keywordflow">if</span> len(set(Floats[<span class="stringliteral">&#39;charge&#39;</span>])) != 1 <span class="keywordflow">or</span> len(set(Floats[<span class="stringliteral">&#39;mult&#39;</span>])) != 1:</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;                <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;Unexpected number of charges or multiplicities in parsing %s&#39;</span> % fnm)</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;        <span class="comment"># If we have any QM energies (not the case if SCF convergence failure)</span></div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;        <span class="keywordflow">if</span> <span class="stringliteral">&#39;qm_energies&#39;</span> <span class="keywordflow">in</span> Answer:</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;            <span class="comment"># Catch the case of failed geometry optimizations.</span></div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;            <span class="keywordflow">if</span> len(Answer[<span class="stringliteral">&#39;xyzs&#39;</span>]) == len(Answer[<span class="stringliteral">&#39;qm_energies&#39;</span>]) + 1:</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;                Answer[<span class="stringliteral">&#39;xyzs&#39;</span>] = Answer[<span class="stringliteral">&#39;xyzs&#39;</span>][:-1]</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;            <span class="comment"># Catch the case of freezing string method, it prints out two extra coordinates.</span></div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;            <span class="keywordflow">if</span> len(Answer[<span class="stringliteral">&#39;xyzs&#39;</span>]) == len(Answer[<span class="stringliteral">&#39;qm_energies&#39;</span>]) + 2:</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;                <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(2):</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;                    Answer[<span class="stringliteral">&#39;qm_energies&#39;</span>].<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a77417ff99b19f6d0b7c6f527e83fa7f1">append</a>(0.0)</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;                    mkchg.append([0.0 <span class="keywordflow">for</span> j <span class="keywordflow">in</span> mkchg[-1]])</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;                    mkspn.append([0.0 <span class="keywordflow">for</span> j <span class="keywordflow">in</span> mkchg[-1]])</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;            lens = [len(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> Answer[<span class="stringliteral">&#39;qm_energies&#39;</span>], Answer[<span class="stringliteral">&#39;xyzs&#39;</span>]]</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;            <span class="keywordflow">if</span> len(set(lens)) != 1:</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;                <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;The number of energies and coordinates in %s are not the same : %s&#39;</span> % (fnm, str(lens)))</div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;        <span class="comment"># The number of atoms should all be the same</span></div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;        <span class="keywordflow">if</span> len(set([len(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> Answer[<span class="stringliteral">&#39;xyzs&#39;</span>]])) &gt; 1:</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;            <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;The numbers of atoms across frames in %s are not all the same&#39;</span> % (fnm))</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;        <span class="keywordflow">if</span> <span class="stringliteral">&#39;qm_forces&#39;</span> <span class="keywordflow">in</span> Answer:</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;            <span class="keywordflow">for</span> i, frc <span class="keywordflow">in</span> enumerate(Answer[<span class="stringliteral">&#39;qm_forces&#39;</span>]):</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;                Answer[<span class="stringliteral">&#39;qm_forces&#39;</span>][i] = frc.T</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> np.where(np.array(conv) == 0)[0]:</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;                Answer[<span class="stringliteral">&#39;qm_forces&#39;</span>].insert(i, Answer[<span class="stringliteral">&#39;qm_forces&#39;</span>][0]*0.0)</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;            <span class="keywordflow">if</span> len(Answer[<span class="stringliteral">&#39;qm_forces&#39;</span>]) != len(Answer[<span class="stringliteral">&#39;qm_energies&#39;</span>]):</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;                warn(<span class="stringliteral">&quot;Number of energies and gradients is inconsistent (composite jobs?)  Deleting gradients.&quot;</span>)</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;                del Answer[<span class="stringliteral">&#39;qm_forces&#39;</span>]</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;        <span class="comment"># A strange peculiarity; Q-Chem sometimes prints out the final Mulliken charges a second time, after the geometry optimization.</span></div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;        <span class="keywordflow">if</span> mkchg != []:</div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;            Answer[<span class="stringliteral">&#39;qm_mulliken_charges&#39;</span>] = list(np.array(mkchg))</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> np.where(np.array(conv) == 0)[0]:</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;                Answer[<span class="stringliteral">&#39;qm_mulliken_charges&#39;</span>].insert(i, np.array([0.0 <span class="keywordflow">for</span> i <span class="keywordflow">in</span> mkchg[-1]]))</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;            Answer[<span class="stringliteral">&#39;qm_mulliken_charges&#39;</span>] = Answer[<span class="stringliteral">&#39;qm_mulliken_charges&#39;</span>][:len(Answer[<span class="stringliteral">&#39;qm_energies&#39;</span>])]</div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;        <span class="keywordflow">if</span> mkspn != []:</div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;            Answer[<span class="stringliteral">&#39;qm_mulliken_spins&#39;</span>] = list(np.array(mkspn))</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> np.where(np.array(conv) == 0)[0]:</div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;                Answer[<span class="stringliteral">&#39;qm_mulliken_spins&#39;</span>].insert(i, np.array([0.0 <span class="keywordflow">for</span> i <span class="keywordflow">in</span> mkspn[-1]]))</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;            Answer[<span class="stringliteral">&#39;qm_mulliken_spins&#39;</span>] = Answer[<span class="stringliteral">&#39;qm_mulliken_spins&#39;</span>][:len(Answer[<span class="stringliteral">&#39;qm_energies&#39;</span>])]</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;        </div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;        Answer[<span class="stringliteral">&#39;Irc&#39;</span>] = IRCData</div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;        <span class="keywordflow">return</span> Answer</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;    </div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;    <span class="comment">#=====================================#</span></div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;    <span class="comment">#|         Writing functions         |#</span></div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;    <span class="comment">#=====================================#</span></div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#af46b2ba6ef777cf8301bc16e157c724d">write_qcin</a>(self, select, **kwargs):</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;        self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a80851250d8e749bea882d5aa4bcfcdd1">require</a>(<span class="stringliteral">&#39;qctemplate&#39;</span>,<span class="stringliteral">&#39;qcrems&#39;</span>,<span class="stringliteral">&#39;charge&#39;</span>,<span class="stringliteral">&#39;mult&#39;</span>)</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;        out = []</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;        <span class="keywordflow">if</span> <span class="stringliteral">&#39;read&#39;</span> <span class="keywordflow">in</span> kwargs:</div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;            read = kwargs[<span class="stringliteral">&#39;read&#39;</span>]</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;            read = <span class="keyword">False</span></div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;        <span class="keywordflow">for</span> SI, I <span class="keywordflow">in</span> enumerate(select):</div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;            fsm = <span class="keyword">False</span></div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;            remidx = 0</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;            molecule_printed = <span class="keyword">False</span></div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;            <span class="comment"># Each &#39;extchg&#39; has number_of_atoms * 4 elements corresponding to x, y, z, q.</span></div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&#39;qm_extchgs&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;                extchg = self.qm_extchgs[I]</div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;                out.append(<span class="stringliteral">&#39;$external_charges&#39;</span>)</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;                <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(extchg)):</div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;                    out.append(<span class="stringliteral">&quot;% 15.10f % 15.10f % 15.10f %15.10f&quot;</span> % (extchg[i,0],extchg[i,1],extchg[i,2],extchg[i,3]))</div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;                out.append(<span class="stringliteral">&#39;$end&#39;</span>)</div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;            <span class="keywordflow">for</span> SectName, SectData <span class="keywordflow">in</span> self.qctemplate:</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;                <span class="keywordflow">if</span> <span class="stringliteral">&#39;jobtype&#39;</span> <span class="keywordflow">in</span> self.qcrems[remidx] <span class="keywordflow">and</span> self.qcrems[remidx][<span class="stringliteral">&#39;jobtype&#39;</span>].lower() == <span class="stringliteral">&#39;fsm&#39;</span>:</div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;                    fsm = <span class="keyword">True</span></div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;                    <span class="keywordflow">if</span> len(select) != 2:</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;                        <span class="keywordflow">raise</span> RuntimeError(<span class="stringliteral">&#39;For freezing string method, please provide two structures only.&#39;</span>)</div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;                <span class="keywordflow">if</span> SectName != <span class="stringliteral">&#39;@@@@&#39;</span>:</div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;                    out.append(<span class="stringliteral">&#39;$%s&#39;</span> % SectName)</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;                    <span class="keywordflow">for</span> line <span class="keywordflow">in</span> SectData:</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;                        out.append(line)</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;                    <span class="keywordflow">if</span> SectName == <span class="stringliteral">&#39;molecule&#39;</span>:</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;                        <span class="keywordflow">if</span> molecule_printed == <span class="keyword">False</span>:</div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;                            molecule_printed = <span class="keyword">True</span></div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;                            <span class="keywordflow">if</span> read:</div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;                                out.append(<span class="stringliteral">&quot;read&quot;</span>)</div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;                            <span class="keywordflow">elif</span> self.na &gt; 0:</div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;                                out.append(<span class="stringliteral">&quot;%i %i&quot;</span> % (self.charge, self.mult))</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;                                an = 0</div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;                                <span class="keywordflow">for</span> e, x <span class="keywordflow">in</span> zip(self.elem, self.xyzs[I]):</div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;                                    pre = <span class="stringliteral">&#39;@&#39;</span> <span class="keywordflow">if</span> (<span class="stringliteral">&#39;qm_ghost&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a> <span class="keywordflow">and</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[<span class="stringliteral">&#39;qm_ghost&#39;</span>][an]) <span class="keywordflow">else</span> <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;                                    suf =  self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[<span class="stringliteral">&#39;qcsuf&#39;</span>][an] <span class="keywordflow">if</span> <span class="stringliteral">&#39;qcsuf&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a> <span class="keywordflow">else</span> <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;                                    out.append(pre + <a class="code" href="namespaceforcebalance_1_1molecule.html#a2eba3cad44138b3b10ea883240888412">format_xyz_coord</a>(e, x) + suf)</div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;                                    an += 1</div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;                                <span class="keywordflow">if</span> fsm:</div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;                                    out.append(<span class="stringliteral">&quot;****&quot;</span>)</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;                                    an = 0</div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;                                    <span class="keywordflow">for</span> e, x <span class="keywordflow">in</span> zip(self.elem, self.xyzs[select[SI+1]]):</div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;                                        pre = <span class="stringliteral">&#39;@&#39;</span> <span class="keywordflow">if</span> (<span class="stringliteral">&#39;qm_ghost&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a> <span class="keywordflow">and</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[<span class="stringliteral">&#39;qm_ghost&#39;</span>][an]) <span class="keywordflow">else</span> <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;                                        suf =  self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>[<span class="stringliteral">&#39;qcsuf&#39;</span>][an] <span class="keywordflow">if</span> <span class="stringliteral">&#39;qcsuf&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a> <span class="keywordflow">else</span> <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;                                        out.append(pre + <a class="code" href="namespaceforcebalance_1_1molecule.html#a2eba3cad44138b3b10ea883240888412">format_xyz_coord</a>(e, x) + suf)</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;                                        an += 1</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;                    <span class="keywordflow">if</span> SectName == <span class="stringliteral">&#39;rem&#39;</span>:</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;                        <span class="keywordflow">for</span> key, val <span class="keywordflow">in</span> self.qcrems[remidx].items():</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;                            out.append(<span class="stringliteral">&quot;%-21s %-s&quot;</span> % (key, str(val)))</div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;                        remidx += 1</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;                    <span class="keywordflow">if</span> SectName == <span class="stringliteral">&#39;comments&#39;</span> <span class="keywordflow">and</span> <span class="stringliteral">&#39;comms&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;                        out.append(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#adf9f25ebcf955be562ef186b822e237a">comms</a>[I])</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;                    out.append(<span class="stringliteral">&#39;$end&#39;</span>)</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;                <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;                    out.append(<span class="stringliteral">&#39;@@@@&#39;</span>)</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;                out.append(<span class="stringliteral">&#39;&#39;</span>)</div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;            <span class="comment">#if I &lt; (len(self) - 1):</span></div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;            <span class="keywordflow">if</span> fsm: <span class="keywordflow">break</span></div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;            <span class="keywordflow">if</span> I != select[-1]:</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;                out.append(<span class="stringliteral">&#39;@@@@&#39;</span>)</div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;                out.append(<span class="stringliteral">&#39;&#39;</span>)</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;        <span class="keywordflow">return</span> out</div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;</div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#adc6620e8287edabe161442de12295f75">write_xyz</a>(self, select, **kwargs):</div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;        self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a80851250d8e749bea882d5aa4bcfcdd1">require</a>(<span class="stringliteral">&#39;elem&#39;</span>,<span class="stringliteral">&#39;xyzs&#39;</span>)</div>
<div class="line"><a name="l02611"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#af46b2ba6ef777cf8301bc16e157c724d"> 2611</a></span>&#160;        out = []</div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;        <span class="keywordflow">for</span> I <span class="keywordflow">in</span> select:</div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;            xyz = self.xyzs[I]</div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;            out.append(<span class="stringliteral">&quot;%-5i&quot;</span> % self.na)</div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;            out.append(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#adf9f25ebcf955be562ef186b822e237a">comms</a>[I])</div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(self.na):</div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;                out.append(<a class="code" href="namespaceforcebalance_1_1molecule.html#a2eba3cad44138b3b10ea883240888412">format_xyz_coord</a>(self.elem[i],xyz[i]))</div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;        <span class="keywordflow">return</span> out</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#aba14226f272f91c91ecf7060ff136a2b">write_molproq</a>(self, select, **kwargs):</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;        self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a80851250d8e749bea882d5aa4bcfcdd1">require</a>(<span class="stringliteral">&#39;xyzs&#39;</span>,<span class="stringliteral">&#39;partial_charge&#39;</span>)</div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;        out = []</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;        <span class="keywordflow">for</span> I <span class="keywordflow">in</span> select:</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;            xyz = self.xyzs[I]</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;            <span class="comment"># Comment comes first, then number of atoms.</span></div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;            out.append(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#adf9f25ebcf955be562ef186b822e237a">comms</a>[I])</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;            out.append(<span class="stringliteral">&quot;%-5i&quot;</span> % self.na)</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(self.na):</div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;                out.append(<span class="stringliteral">&quot;% 15.10f % 15.10f % 15.10f % 15.10f   0&quot;</span> % (xyz[i,0],xyz[i,1],xyz[i,2],self.partial_charge[i]))</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;        <span class="keywordflow">return</span> out</div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;</div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#aab5ea35ab9d68559fd6ea7b747c2bddb">write_mdcrd</a>(self, select, **kwargs):</div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;        self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a80851250d8e749bea882d5aa4bcfcdd1">require</a>(<span class="stringliteral">&#39;xyzs&#39;</span>)</div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;        <span class="comment"># In mdcrd files, there is only one comment line</span></div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;        out = [<span class="stringliteral">&#39;mdcrd file generated using ForceBalance&#39;</span>] </div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;        <span class="keywordflow">for</span> I <span class="keywordflow">in</span> select:</div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;            xyz = self.xyzs[I]</div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;            out += [<span class="stringliteral">&#39;&#39;</span>.join([<span class="stringliteral">&quot;%8.3f&quot;</span> % i <span class="keywordflow">for</span> i <span class="keywordflow">in</span> g]) <span class="keywordflow">for</span> g <span class="keywordflow">in</span> <a class="code" href="namespaceforcebalance_1_1molecule.html#a7fe52c2928c7b0329882541bef2e34cd">grouper</a>(10, list(xyz.flatten()))]</div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&#39;boxes&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;                out.append(<span class="stringliteral">&#39;&#39;</span>.join([<span class="stringliteral">&quot;%8.3f&quot;</span> % i <span class="keywordflow">for</span> i <span class="keywordflow">in</span> [self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">boxes</a>[I].a, self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">boxes</a>[I].b, self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">boxes</a>[I].c]]))</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;        <span class="keywordflow">return</span> out</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;</div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a95782abfb36e7080a1b98bfad2ced4f3">write_arc</a>(self, select, **kwargs):</div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;        self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a80851250d8e749bea882d5aa4bcfcdd1">require</a>(<span class="stringliteral">&#39;elem&#39;</span>,<span class="stringliteral">&#39;xyzs&#39;</span>)</div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;        out = []</div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;        <span class="keywordflow">if</span> <span class="stringliteral">&#39;tinkersuf&#39;</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;            sys.stderr.write(<span class="stringliteral">&quot;Beware, this .arc file contains no atom type or topology info\n&quot;</span>)</div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;        <span class="keywordflow">for</span> I <span class="keywordflow">in</span> select:</div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;            xyz = self.xyzs[I]</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;            out.append(<span class="stringliteral">&quot;%6i  %s&quot;</span> % (self.na, self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#adf9f25ebcf955be562ef186b822e237a">comms</a>[I]))</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&#39;boxes&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;                b = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">boxes</a>[I]</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;                out.append(<span class="stringliteral">&quot; %11.6f %11.6f %11.6f %11.6f %11.6f %11.6f&quot;</span> % (b.a, b.b, b.c, b.alpha, b.beta, b.gamma))</div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(self.na):</div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;                out.append(<span class="stringliteral">&quot;%6i  %s%s&quot;</span> % (i+1,<a class="code" href="namespaceforcebalance_1_1molecule.html#a2eba3cad44138b3b10ea883240888412">format_xyz_coord</a>(self.elem[i],xyz[i],tinker=<span class="keyword">True</span>),self.tinkersuf[i] <span class="keywordflow">if</span> <span class="stringliteral">&#39;tinkersuf&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a> <span class="keywordflow">else</span> <span class="stringliteral">&#39;&#39;</span>))</div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;        <span class="keywordflow">return</span> out</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a503eae2cee228e4cc5fc736504714925">write_gro</a>(self, select, **kwargs):</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;        out = []</div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;        <span class="keywordflow">if</span> sys.stdin.isatty():</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;            self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a80851250d8e749bea882d5aa4bcfcdd1">require</a>(<span class="stringliteral">&#39;elem&#39;</span>,<span class="stringliteral">&#39;xyzs&#39;</span>)</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;            self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#ad47d05a3ea76e013a628bd7b25ae3050">require_resname</a>()</div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;            self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a90fe456919fda305703e36af389e60e1">require_resid</a>()</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;            self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a03af3cfb99ea8f1c8c7e93d04bdcf967">require_boxes</a>()</div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;            self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a80851250d8e749bea882d5aa4bcfcdd1">require</a>(<span class="stringliteral">&#39;elem&#39;</span>,<span class="stringliteral">&#39;xyzs&#39;</span>,<span class="stringliteral">&#39;resname&#39;</span>,<span class="stringliteral">&#39;resid&#39;</span>,<span class="stringliteral">&#39;boxes&#39;</span>)</div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;</div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;        <span class="keywordflow">if</span> <span class="stringliteral">&#39;atomname&#39;</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;            count = 0</div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;            resid = -1</div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;            atomname = []</div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(self.na):</div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;                <span class="keywordflow">if</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a7ce0cbbc2f774aaffe3b6ca78b658736">resid</a>[i] != resid:</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;                    count = 0</div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;                count += 1</div>
<div class="line"><a name="l02676"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#adc6620e8287edabe161442de12295f75"> 2676</a></span>&#160;                resid = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a7ce0cbbc2f774aaffe3b6ca78b658736">resid</a>[i]</div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;                atomname.append(<span class="stringliteral">&quot;%s%i&quot;</span> % (self.elem[i], count))</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;            atomname = self.atomname</div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;</div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;        <span class="keywordflow">for</span> I <span class="keywordflow">in</span> select:</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;            xyz = self.xyzs[I]</div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;            xyzwrite = xyz.copy()</div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;            xyzwrite /= 10.0 <span class="comment"># GROMACS uses nanometers</span></div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;            out.append(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#adf9f25ebcf955be562ef186b822e237a">comms</a>[I])</div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;            <span class="comment">#out.append(&quot;Generated by ForceBalance from %s&quot; % self.fnm)</span></div>
<div class="line"><a name="l02687"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#aba14226f272f91c91ecf7060ff136a2b"> 2687</a></span>&#160;            out.append(<span class="stringliteral">&quot;%5i&quot;</span> % self.na)</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;            <span class="keywordflow">for</span> an, line <span class="keywordflow">in</span> enumerate(xyzwrite):</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;                out.append(<a class="code" href="namespaceforcebalance_1_1molecule.html#a41c13064e4285973aa6c49369d3d3390">format_gro_coord</a>(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a7ce0cbbc2f774aaffe3b6ca78b658736">resid</a>[an],self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#ac1def400d819601483ddf475f1389a8d">resname</a>[an],atomname[an],an+1,xyzwrite[an]))</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;            out.append(<a class="code" href="namespaceforcebalance_1_1molecule.html#ae25aa5331b3a2dd0e9d1e184380357db">format_gro_box</a>(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">boxes</a>[I]))</div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;        <span class="keywordflow">return</span> out</div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;</div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a0dee435704418bf51199d6bab6d92249">write_dcd</a>(self, select, **kwargs):</div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;        <span class="keywordflow">if</span> _dcdlib.vmdplugin_init() != 0:</div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;            <span class="keywordflow">raise</span> IOError(<span class="stringliteral">&quot;Unable to init DCD plugin&quot;</span>)</div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;        natoms    = c_int(self.na)</div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;        dcd       = _dcdlib.open_dcd_write(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a2124792d405b58526af41475e4af3c80">fout</a>, <span class="stringliteral">&quot;dcd&quot;</span>, natoms)</div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;        ts        = <a class="code" href="classforcebalance_1_1molecule_1_1MolfileTimestep.html">MolfileTimestep</a>()</div>
<div class="line"><a name="l02699"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#aab5ea35ab9d68559fd6ea7b747c2bddb"> 2699</a></span>&#160;        _xyz      = c_float * (natoms.value * 3)</div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;        <span class="keywordflow">for</span> I <span class="keywordflow">in</span> select:</div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;            xyz = self.xyzs[I]</div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;            ts.coords = _xyz(*list(xyz.flatten()))</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;            ts.A      = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">boxes</a>[I].a <span class="keywordflow">if</span> <span class="stringliteral">&#39;boxes&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a> <span class="keywordflow">else</span> 1.0</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;            ts.B      = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">boxes</a>[I].b <span class="keywordflow">if</span> <span class="stringliteral">&#39;boxes&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a> <span class="keywordflow">else</span> 1.0</div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;            ts.C      = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">boxes</a>[I].c <span class="keywordflow">if</span> <span class="stringliteral">&#39;boxes&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a> <span class="keywordflow">else</span> 1.0</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;            result    = _dcdlib.write_timestep(dcd, byref(ts))</div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;            <span class="keywordflow">if</span> result != 0:</div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;                <span class="keywordflow">raise</span> IOError(<span class="stringliteral">&quot;Error encountered when writing DCD&quot;</span>)</div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;        <span class="comment">## Close the DCD file</span></div>
<div class="line"><a name="l02710"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a95782abfb36e7080a1b98bfad2ced4f3"> 2710</a></span>&#160;        _dcdlib.close_file_write(dcd)</div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;        dcd = <span class="keywordtype">None</span></div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a47082443566cd50add3f2ec20af9cc10">write_pdb</a>(self, select, **kwargs):</div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Save to a PDB. Copied wholesale from MSMBuilder.</span></div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;<span class="stringliteral">        COLUMNS  TYPE   FIELD  DEFINITION</span></div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;<span class="stringliteral">        ---------------------------------------------</span></div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;<span class="stringliteral">        7-11      int   serial        Atom serial number.</span></div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;<span class="stringliteral">        13-16     string name          Atom name.</span></div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;<span class="stringliteral">        17        string altLoc        Alternate location indicator.</span></div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;<span class="stringliteral">        18-20 (17-21 KAB)    string resName       Residue name.</span></div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;<span class="stringliteral">        22        string chainID       Chain identifier.</span></div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;<span class="stringliteral">        23-26     int    resSeq        Residue sequence number.</span></div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;<span class="stringliteral">        27        string iCode         Code for insertion of residues.</span></div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;<span class="stringliteral">        31-38     float  x             Orthogonal coordinates for X in</span></div>
<div class="line"><a name="l02725"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a503eae2cee228e4cc5fc736504714925"> 2725</a></span>&#160;<span class="stringliteral">        Angstroms.</span></div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;<span class="stringliteral">        39-46     float  y             Orthogonal coordinates for Y in</span></div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;<span class="stringliteral">        Angstroms.</span></div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;<span class="stringliteral">        47-54     float  z             Orthogonal coordinates for Z in</span></div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;<span class="stringliteral">        Angstroms.</span></div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;<span class="stringliteral">        55-60     float  occupancy     Occupancy.</span></div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;<span class="stringliteral">        61-66     float  tempFactor    Temperature factor.</span></div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;<span class="stringliteral">        73-76     string segID         Segment identifier, left-justified.</span></div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;<span class="stringliteral">        77-78     string element       Element symbol, right-justified.</span></div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;<span class="stringliteral">        79-80     string charge        Charge on the atom.</span></div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;<span class="stringliteral">        CRYST1 line, added by Lee-Ping</span></div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;<span class="stringliteral">        COLUMNS  TYPE   FIELD  DEFINITION</span></div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;<span class="stringliteral">        ---------------------------------------</span></div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;<span class="stringliteral">         7-15    float  a      a (Angstroms).</span></div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;<span class="stringliteral">        16-24    float  b      b (Angstroms).</span></div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;<span class="stringliteral">        25-33    float  c      c (Angstroms).</span></div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;<span class="stringliteral">        34-40    float  alpha  alpha (degrees).</span></div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;<span class="stringliteral">        41-47    float  beta   beta (degrees).</span></div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;<span class="stringliteral">        48-54    float  gamma  gamma (degrees).</span></div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;<span class="stringliteral">        56-66    string sGroup Space group.</span></div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;<span class="stringliteral">        67-70    int    z      Z value.</span></div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;        <span class="keywordflow">if</span> sys.stdin.isatty():</div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;            self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a80851250d8e749bea882d5aa4bcfcdd1">require</a>(<span class="stringliteral">&#39;xyzs&#39;</span>)</div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;            self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#ad47d05a3ea76e013a628bd7b25ae3050">require_resname</a>()</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;            self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a90fe456919fda305703e36af389e60e1">require_resid</a>()</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;            self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a80851250d8e749bea882d5aa4bcfcdd1">require</a>(<span class="stringliteral">&#39;xyzs&#39;</span>,<span class="stringliteral">&#39;resname&#39;</span>,<span class="stringliteral">&#39;resid&#39;</span>)</div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;</div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;        <span class="keywordflow">if</span> <span class="stringliteral">&#39;atomname&#39;</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;            count = 0</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;            resid = -1</div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;            ATOMS = []</div>
<div class="line"><a name="l02760"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a0dee435704418bf51199d6bab6d92249"> 2760</a></span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(self.na):</div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;                <span class="keywordflow">if</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a7ce0cbbc2f774aaffe3b6ca78b658736">resid</a>[i] != resid:</div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;                    count = 0</div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;                count += 1</div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;                resid = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a7ce0cbbc2f774aaffe3b6ca78b658736">resid</a>[i]</div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;                ATOMS.append(<span class="stringliteral">&quot;%s%i&quot;</span> % (self.elem[i], count))</div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;        <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;            ATOMS = self.atomname</div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;        </div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;        CHAIN = self.chain <span class="keywordflow">if</span> <span class="stringliteral">&#39;chain&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a> <span class="keywordflow">else</span> [1 <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(self.na)]</div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;        RESNAMES = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#ac1def400d819601483ddf475f1389a8d">resname</a></div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;        RESNUMS = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a7ce0cbbc2f774aaffe3b6ca78b658736">resid</a></div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;        out = []</div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;        <span class="keywordflow">if</span> min(RESNUMS) == 0:</div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;            RESNUMS = [i+1 <span class="keywordflow">for</span> i <span class="keywordflow">in</span> RESNUMS]</div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;</div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;        <span class="keywordflow">if</span> <span class="stringliteral">&#39;boxes&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;            a = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">boxes</a>[0].a</div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;            b = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">boxes</a>[0].b</div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;            c = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">boxes</a>[0].c</div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;            alpha = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">boxes</a>[0].alpha</div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;            beta = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">boxes</a>[0].beta</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;            gamma = self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">boxes</a>[0].gamma</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;            line=np.chararray(80)</div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;            line[:] = <span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;            line[0:6]=np.array(list(<span class="stringliteral">&quot;CRYST1&quot;</span>))</div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;            line=np.array(line,<span class="stringliteral">&#39;str&#39;</span>)</div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;            line[6:15] =np.array(list((<span class="stringliteral">&quot;%9.3f&quot;</span>%(a))))</div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;            line[15:24]=np.array(list((<span class="stringliteral">&quot;%9.3f&quot;</span>%(b))))</div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;            line[24:33]=np.array(list((<span class="stringliteral">&quot;%9.3f&quot;</span>%(c))))</div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;            line[33:40]=np.array(list((<span class="stringliteral">&quot;%7.2f&quot;</span>%(alpha))))</div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;            line[40:47]=np.array(list((<span class="stringliteral">&quot;%7.2f&quot;</span>%(beta))))</div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;            line[47:54]=np.array(list((<span class="stringliteral">&quot;%7.2f&quot;</span>%(gamma))))</div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;            <span class="comment"># LPW: Put in a dummy space group, we never use it.</span></div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;            line[55:66]=np.array(list(str(<span class="stringliteral">&quot;P 21 21 21&quot;</span>).rjust(11)))</div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;            line[66:70]=np.array(list(str(4).rjust(4)))</div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;            out.append(line.tostring())</div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;            </div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;        <span class="keywordflow">for</span> I <span class="keywordflow">in</span> select:</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;            XYZ = self.xyzs[I]</div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(self.na):</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;                ATOMNUM = i + 1</div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;                line=np.chararray(80)</div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;                line[:]=<span class="stringliteral">&#39; &#39;</span></div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;                line[0:4]=np.array(list(<span class="stringliteral">&quot;ATOM&quot;</span>))</div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;                line=np.array(line,<span class="stringliteral">&#39;str&#39;</span>)</div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;                line[6:11]=np.array(list(str(ATOMNUM%100000).rjust(5)))</div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;                <span class="comment"># if ATOMNUM &lt; 100000:</span></div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;                <span class="comment">#     line[6:11]=np.array(list(str(ATOMNUM%100000).rjust(5)))</span></div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;                <span class="comment"># else:</span></div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;                <span class="comment">#     line[6:11]=np.array(list(hex(ATOMNUM)[2:].rjust(5)))</span></div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;                <span class="comment">#Molprobity is picky about atom name centering</span></div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;                <span class="keywordflow">if</span> len(str(ATOMS[i]))==3:</div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;                    line[12:16]=np.array(list(str(ATOMS[i]).rjust(4)))</div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;                <span class="keywordflow">elif</span> len(str(ATOMS[i]))==2:</div>
<div class="line"><a name="l02816"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a47082443566cd50add3f2ec20af9cc10"> 2816</a></span>&#160;                    line[12:16]=np.array(list(<span class="stringliteral">&quot; &quot;</span>+str(ATOMS[i])+<span class="stringliteral">&quot; &quot;</span>))</div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;                <span class="keywordflow">elif</span> len(str(ATOMS[i]))==1:</div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;                    line[12:16]=np.array(list(<span class="stringliteral">&quot; &quot;</span>+str(ATOMS[i])+<span class="stringliteral">&quot;  &quot;</span>))</div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;                <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;                    line[12:16]=np.array(list(str(ATOMS[i]).center(4)))</div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;                <span class="keywordflow">if</span> len(str(RESNAMES[i]))==3:</div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;                    line[17:20]=np.array(list(str(RESNAMES[i])))</div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;                <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;                    line[17:21]=np.array(list(str(RESNAMES[i]).ljust(4)))</div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;</div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;                line[21]=str(CHAIN[i]).rjust(1)</div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;                line[22:26]=np.array(list(str(RESNUMS[i]%10000).rjust(4)))</div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;                <span class="comment"># if RESNUMS[i] &lt; 100000:</span></div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;                <span class="comment">#     line[22:26]=np.array(list(str(RESNUMS[i]).rjust(4)))</span></div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;                <span class="comment"># else:</span></div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;                <span class="comment">#     line[22:26]=np.array(list(hex(RESNUMS[i])[2:].rjust(4)))</span></div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;</div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;                x=XYZ[i][0]</div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;                y=XYZ[i][1]</div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;                z=XYZ[i][2]</div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;                sx=np.sign(x)</div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;                sy=np.sign(y)</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;                sz=np.sign(z)</div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;</div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;                line[30:38]=np.array(list((<span class="stringliteral">&quot;%8.3f&quot;</span>%(x))))</div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;                line[38:46]=np.array(list((<span class="stringliteral">&quot;%8.3f&quot;</span>%(y))))</div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;                line[46:54]=np.array(list((<span class="stringliteral">&quot;%8.3f&quot;</span>%(z))))</div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;</div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;                <span class="keywordflow">if</span> ATOMNUM!=-1:</div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;                    out.append(line.tostring())</div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;            out.append(<span class="stringliteral">&#39;ENDMDL&#39;</span>)</div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;        <span class="keywordflow">if</span> <span class="stringliteral">&#39;bonds&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;            connects = [<span class="stringliteral">&quot;CONECT%5i&quot;</span> % (b0+1) + <span class="stringliteral">&quot;&quot;</span>.join([<span class="stringliteral">&quot;%5i&quot;</span> % (b[1]+1) <span class="keywordflow">for</span> b <span class="keywordflow">in</span> self.bonds <span class="keywordflow">if</span> b[0] == b0]) <span class="keywordflow">for</span> b0 <span class="keywordflow">in</span> sorted(list(set(b[0] <span class="keywordflow">for</span> b <span class="keywordflow">in</span> self.bonds)))]</div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;            out += connects</div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;        <span class="keywordflow">return</span> out</div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;        </div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a1ef6aefd3218f8ab3f9dc2b37e602fbf">write_qdata</a>(self, select, **kwargs):</div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; Text quantum data format. &quot;&quot;&quot;</span></div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;        <span class="comment">#self.require(&#39;xyzs&#39;,&#39;qm_energies&#39;,&#39;qm_forces&#39;)</span></div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;        out = []</div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;        <span class="keywordflow">for</span> I <span class="keywordflow">in</span> select:</div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;            xyz = self.xyzs[I]</div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;            out.append(<span class="stringliteral">&quot;JOB %i&quot;</span> % I)</div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;            out.append(<span class="stringliteral">&quot;COORDS&quot;</span>+<a class="code" href="namespaceforcebalance_1_1molecule.html#a58c3f09152db4d1c6e1db9df29c60c43">pvec</a>(xyz))</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&#39;qm_energies&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;                out.append(<span class="stringliteral">&quot;ENERGY % .12e&quot;</span> % self.qm_energies[I])</div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&#39;mm_energies&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;                out.append(<span class="stringliteral">&quot;EMD0   % .12e&quot;</span> % self.mm_energies[I])</div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&#39;qm_forces&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;                out.append(<span class="stringliteral">&quot;FORCES&quot;</span>+<a class="code" href="namespaceforcebalance_1_1molecule.html#a58c3f09152db4d1c6e1db9df29c60c43">pvec</a>(self.qm_forces[I]))</div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&#39;qm_espxyzs&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a> <span class="keywordflow">and</span> <span class="stringliteral">&#39;qm_espvals&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;                out.append(<span class="stringliteral">&quot;ESPXYZ&quot;</span>+<a class="code" href="namespaceforcebalance_1_1molecule.html#a58c3f09152db4d1c6e1db9df29c60c43">pvec</a>(self.qm_espxyzs[I]))</div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;                out.append(<span class="stringliteral">&quot;ESPVAL&quot;</span>+<a class="code" href="namespaceforcebalance_1_1molecule.html#a58c3f09152db4d1c6e1db9df29c60c43">pvec</a>(self.qm_espvals[I]))</div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&#39;qm_interaction&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>: </div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;                out.append(<span class="stringliteral">&quot;INTERACTION % .12e&quot;</span> % self.qm_interaction[I])</div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;            out.append(<span class="stringliteral">&#39;&#39;</span>)</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;        <span class="keywordflow">return</span> out</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;</div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a90fe456919fda305703e36af389e60e1">require_resid</a>(self):</div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;        <span class="keywordflow">if</span> <span class="stringliteral">&#39;resid&#39;</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;            na_res = int(raw_input(<span class="stringliteral">&quot;Enter how many atoms are in a residue, or zero as a single residue -&gt; &quot;</span>))</div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;            <span class="keywordflow">if</span> na_res == 0:</div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;                self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a7ce0cbbc2f774aaffe3b6ca78b658736">resid</a> = [1 <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(self.na)]</div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;                self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a7ce0cbbc2f774aaffe3b6ca78b658736">resid</a> = [1 + i/na_res <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(self.na)]</div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;            </div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#ad47d05a3ea76e013a628bd7b25ae3050">require_resname</a>(self):</div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;        <span class="keywordflow">if</span> <span class="stringliteral">&#39;resname&#39;</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a>:</div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;            resname = raw_input(<span class="stringliteral">&quot;Enter a residue name (3-letter like &#39;SOL&#39;) -&gt; &quot;</span>)</div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;            self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#ac1def400d819601483ddf475f1389a8d">resname</a> = [resname <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(self.na)]</div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;            </div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;    <span class="keyword">def </span><a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a03af3cfb99ea8f1c8c7e93d04bdcf967">require_boxes</a>(self):</div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;        <span class="keyword">def </span>buildbox(line):</div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;            s = [float(i) <span class="keywordflow">for</span> i <span class="keywordflow">in</span> line.split()]</div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;            <span class="keywordflow">if</span> len(s) == 1:</div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;                a = s[0]</div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;                b = s[0]</div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;                c = s[0]</div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;                alpha = 90.0</div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;                beta = 90.0</div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;                gamma = 90.0</div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="namespaceforcebalance_1_1molecule.html#a0a6e3e79b04534bf2e83d09def189444">BuildLatticeFromLengthsAngles</a>(a, b, c, alpha, beta, gamma)</div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;            <span class="keywordflow">elif</span> len(s) == 3:</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;                a = s[0]</div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;                b = s[1]</div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;                c = s[2]</div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;                alpha = 90.0</div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;                beta = 90.0</div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;                gamma = 90.0</div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="namespaceforcebalance_1_1molecule.html#a0a6e3e79b04534bf2e83d09def189444">BuildLatticeFromLengthsAngles</a>(a, b, c, alpha, beta, gamma)</div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;            <span class="keywordflow">elif</span> len(s) == 6:</div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;                a = s[0]</div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;                b = s[1]</div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;                c = s[2]</div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;                alpha = s[3]</div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;                beta = s[4]</div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;                gamma = s[5]</div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="namespaceforcebalance_1_1molecule.html#a0a6e3e79b04534bf2e83d09def189444">BuildLatticeFromLengthsAngles</a>(a, b, c, alpha, beta, gamma)</div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;            <span class="keywordflow">elif</span> len(s) == 9:</div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;                v1 = np.array([s[0], s[3], s[4]])</div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;                v2 = np.array([s[5], s[1], s[6]])</div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;                v3 = np.array([s[7], s[8], s[2]])</div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="namespaceforcebalance_1_1molecule.html#a29fb1ac9324f4280f07c65baea339989">BuildLatticeFromVectors</a>(v1, v2, v3)</div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;                <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&quot;Not sure what to do since you gave me %i numbers&quot;</span> % len(s))</div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;            </div>
<div class="line"><a name="l02922"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a1ef6aefd3218f8ab3f9dc2b37e602fbf"> 2922</a></span>&#160;        <span class="keywordflow">if</span> <span class="stringliteral">&#39;boxes&#39;</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">Data</a> <span class="keywordflow">or</span> len(self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">boxes</a>) != self.ns:</div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;            sys.stderr.write(<span class="stringliteral">&quot;Please specify the periodic box using:\n&quot;</span>)</div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;            sys.stderr.write(<span class="stringliteral">&quot;1 float (cubic lattice length in Angstrom)\n&quot;</span>)</div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;            sys.stderr.write(<span class="stringliteral">&quot;3 floats (orthogonal lattice lengths in Angstrom)\n&quot;</span>)</div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;            sys.stderr.write(<span class="stringliteral">&quot;6 floats (triclinic lattice lengths and angles in degrees)\n&quot;</span>)</div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;            sys.stderr.write(<span class="stringliteral">&quot;9 floats (triclinic lattice vectors v1(x) v2(y) v3(z) v1(y) v1(z) v2(x) v2(z) v3(x) v3(y) in Angstrom)\n&quot;</span>)</div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;            sys.stderr.write(<span class="stringliteral">&quot;Or: Name of a file containing one of these lines for each frame in the trajectory\n&quot;</span>)</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;            boxstr = raw_input(<span class="stringliteral">&quot;Box Vector Input: -&gt; &quot;</span>)</div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;            <span class="keywordflow">if</span> os.path.exists(boxstr):</div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;                boxfile = open(boxstr).readlines()</div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;                <span class="keywordflow">if</span> len(boxfile) != len(self):</div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;                    <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&#39;Tried to read in the box file, but it has a different length from the number of frames.&#39;</span>)</div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;                <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;                    self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">boxes</a> = [buildbox(line) <span class="keywordflow">for</span> line <span class="keywordflow">in</span> boxfile]</div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;            <span class="keywordflow">else</span>:</div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;                mybox = buildbox(boxstr)</div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;                self.<a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">boxes</a> = [mybox <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(self.ns)]</div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;</div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceforcebalance_1_1molecule.html#ab9cb167fbbd809aedcf8c7434d405547">main</a>():</div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;    <span class="keywordflow">print</span> <span class="stringliteral">&quot;Basic usage as an executable: molecule.py input.format1 output.format2&quot;</span></div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;    <span class="keywordflow">print</span> <span class="stringliteral">&quot;where format stands for xyz, pdb, gro, etc.&quot;</span></div>
<div class="line"><a name="l02943"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a90fe456919fda305703e36af389e60e1"> 2943</a></span>&#160;    Mao = <a class="code" href="classforcebalance_1_1molecule_1_1Molecule.html">Molecule</a>(sys.argv[1])</div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;    Mao.write(sys.argv[2])</div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;</div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;<span class="keywordflow">if</span> __name__ == <span class="stringliteral">&quot;__main__&quot;</span>:</div>
<div class="line"><a name="l02947"></a><span class="lineno"><a class="line" href="classforcebalance_1_1molecule_1_1Molecule.html#a7ce0cbbc2f774aaffe3b6ca78b658736"> 2947</a></span>&#160;    <a class="code" href="namespaceforcebalance_1_1molecule.html#ab9cb167fbbd809aedcf8c7434d405547">main</a>()</div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a3e82ae8215555b543f1e5800b718c409"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a3e82ae8215555b543f1e5800b718c409">forcebalance.molecule.Molecule.__add__</a></div><div class="ttdeci">def __add__</div><div class="ttdoc">Add method for Molecule objects. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00800">molecule.py:800</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_a41c13064e4285973aa6c49369d3d3390"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#a41c13064e4285973aa6c49369d3d3390">forcebalance.molecule.format_gro_coord</a></div><div class="ttdeci">def format_gro_coord</div><div class="ttdoc">Print a line in accordance with .gro file format, with six decimal points of precision. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00396">molecule.py:396</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html">forcebalance.molecule.Molecule</a></div><div class="ttdoc">Lee-Ping&#39;s general file format conversion class. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00691">molecule.py:691</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_aa6b0a08a6579f697667c83e04927298c"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#aa6b0a08a6579f697667c83e04927298c">forcebalance.molecule.Molecule.measure_dihedrals</a></div><div class="ttdeci">def measure_dihedrals</div><div class="ttdoc">Return a series of dihedral angles, given four atom indices numbered from zero. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01507">molecule.py:1507</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_a838d85848bd817e801d0f5f6502217ef"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#a838d85848bd817e801d0f5f6502217ef">forcebalance.molecule.is_charmm_coord</a></div><div class="ttdeci">def is_charmm_coord</div><div class="ttdoc">Determines whether a line contains CHARMM data or not. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00444">molecule.py:444</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a432affdec68562b5b19fd249124480c3"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a432affdec68562b5b19fd249124480c3">forcebalance.molecule.Molecule.atom_select</a></div><div class="ttdeci">def atom_select</div><div class="ttdoc">Return a copy of the object with certain atoms selected. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01175">molecule.py:1175</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_aafc8c924eed4480fed8ddc9c474d3bc1"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#aafc8c924eed4480fed8ddc9c474d3bc1">forcebalance.molecule.is_gro_box</a></div><div class="ttdeci">def is_gro_box</div><div class="ttdoc">Determines whether a line contains a GROMACS box vector or not. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00457">molecule.py:457</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_a6f7c6217b1c64da309a8abd21dfdcf08"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#a6f7c6217b1c64da309a8abd21dfdcf08">forcebalance.molecule.diff</a></div><div class="ttdeci">def diff</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00507">molecule.py:507</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_aa2020b34bd18c73558cf39334b204981"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#aa2020b34bd18c73558cf39334b204981">forcebalance.molecule.CubicLattice</a></div><div class="ttdeci">def CubicLattice</div><div class="ttdoc">This function takes in three lattice lengths and three lattice angles, and tries to return a complete...</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00262">molecule.py:262</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a7ce0cbbc2f774aaffe3b6ca78b658736"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a7ce0cbbc2f774aaffe3b6ca78b658736">forcebalance.molecule.Molecule.resid</a></div><div class="ttdeci">resid</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l02947">molecule.py:2947</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_aff79ac248e1f0cfe92b5b9e0b559f56e"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#aff79ac248e1f0cfe92b5b9e0b559f56e">forcebalance.molecule.Molecule.read_xyz0</a></div><div class="ttdeci">def read_xyz0</div><div class="ttdoc">Parse a .xyz file which contains several xyz coordinates, and return their elements. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01657">molecule.py:1657</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_ac1def400d819601483ddf475f1389a8d"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#ac1def400d819601483ddf475f1389a8d">forcebalance.molecule.Molecule.resname</a></div><div class="ttdeci">resname</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l02954">molecule.py:2954</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_a2eba3cad44138b3b10ea883240888412"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#a2eba3cad44138b3b10ea883240888412">forcebalance.molecule.format_xyz_coord</a></div><div class="ttdeci">def format_xyz_coord</div><div class="ttdoc">Print a line consisting of (element, x, y, z) in accordance with .xyz file format. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00378">molecule.py:378</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a68e276a95910d534fa2e937abbc60e1c"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a68e276a95910d534fa2e937abbc60e1c">forcebalance.molecule.Molecule.load_frames</a></div><div class="ttdeci">def load_frames</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01101">molecule.py:1101</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_a08840b73e95bf34bf9ca7ea36ad0492d"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#a08840b73e95bf34bf9ca7ea36ad0492d">forcebalance.molecule.get_rotate_translate</a></div><div class="ttdeci">def get_rotate_translate</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00607">molecule.py:607</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_ab8464fea13fad2a506792c2f1d7c93f3"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#ab8464fea13fad2a506792c2f1d7c93f3">forcebalance.molecule.nodematch</a></div><div class="ttdeci">def nodematch</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00240">molecule.py:240</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a1d93b050bdb0d434b436d0c5803ccdec"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a1d93b050bdb0d434b436d0c5803ccdec">forcebalance.molecule.Molecule.find_dihedrals</a></div><div class="ttdeci">def find_dihedrals</div><div class="ttdoc">Return a list of 4-tuples corresponding to all of the dihedral angles in the system. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01484">molecule.py:1484</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a8c9e71843e7123c57c43c24af2d84f25"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a8c9e71843e7123c57c43c24af2d84f25">forcebalance.molecule.Molecule.read_qcout</a></div><div class="ttdeci">def read_qcout</div><div class="ttdoc">Q-Chem output file reader, adapted for our parser. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l02344">molecule.py:2344</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a40360a68b3f2f14406d3524e62f0c0a1"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a40360a68b3f2f14406d3524e62f0c0a1">forcebalance.molecule.Molecule.__iter__</a></div><div class="ttdeci">def __iter__</div><div class="ttdoc">List-like behavior for looping over trajectories. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00789">molecule.py:789</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a71da1c1e530afd8b9b5f08d9bd27259f"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a71da1c1e530afd8b9b5f08d9bd27259f">forcebalance.molecule.Molecule.split</a></div><div class="ttdeci">def split</div><div class="ttdoc">Split the molecule object into a number of separate files (chunks), either by specifying the number o...</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01632">molecule.py:1632</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_af46b2ba6ef777cf8301bc16e157c724d"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#af46b2ba6ef777cf8301bc16e157c724d">forcebalance.molecule.Molecule.write_qcin</a></div><div class="ttdeci">def write_qcin</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l02611">molecule.py:2611</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_af9d8dc89fee54b2b89558633f2c9b70a"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#af9d8dc89fee54b2b89558633f2c9b70a">forcebalance.molecule.Molecule.positive_resid</a></div><div class="ttdeci">positive_resid</div><div class="ttdoc">Creates entries like &#39;gromacs&#39; : &#39;gromacs&#39; and &#39;xyz&#39; : &#39;xyz&#39; in the Funnel. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00943">molecule.py:943</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a9b3fb36e61a914b9f0e2c1613357736a"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a9b3fb36e61a914b9f0e2c1613357736a">forcebalance.molecule.Molecule.boxes</a></div><div class="ttdeci">boxes</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l03004">molecule.py:3004</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a685c8092020a46cd7cf5b52ab45ca6e4"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a685c8092020a46cd7cf5b52ab45ca6e4">forcebalance.molecule.Molecule.align_by_moments</a></div><div class="ttdeci">def align_by_moments</div><div class="ttdoc">Align molecules using the moment of inertia. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01258">molecule.py:1258</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_ad47d05a3ea76e013a628bd7b25ae3050"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#ad47d05a3ea76e013a628bd7b25ae3050">forcebalance.molecule.Molecule.require_resname</a></div><div class="ttdeci">def require_resname</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l02951">molecule.py:2951</a></div></div>
<div class="ttc" id="classforcebalance_1_1Mol2_1_1mol2__set_html"><div class="ttname"><a href="classforcebalance_1_1Mol2_1_1mol2__set.html">forcebalance.Mol2.mol2_set</a></div><div class="ttdef"><b>Definition:</b> <a href="Mol2_8py_source.html#l00568">Mol2.py:568</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a80851250d8e749bea882d5aa4bcfcdd1"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a80851250d8e749bea882d5aa4bcfcdd1">forcebalance.molecule.Molecule.require</a></div><div class="ttdeci">def require</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00987">molecule.py:987</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1MyG_html_a2a5ae00cf603aa8d887d4dcca8412834"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1MyG.html#a2a5ae00cf603aa8d887d4dcca8412834">forcebalance.molecule.MyG.L</a></div><div class="ttdeci">def L</div><div class="ttdoc">Return a list of the sorted atom numbers in this graph. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00341">molecule.py:341</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a071f18dacd881f761462f772bb0cf632"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a071f18dacd881f761462f772bb0cf632">forcebalance.molecule.Molecule.build_topology</a></div><div class="ttdeci">def build_topology</div><div class="ttdoc">A bare-bones implementation of the bond graph capability in the nanoreactor code. ...</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01310">molecule.py:1310</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_a7429f0c377d6396711c128f6590ef810"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#a7429f0c377d6396711c128f6590ef810">forcebalance.molecule.elem_from_atomname</a></div><div class="ttdeci">def elem_from_atomname</div><div class="ttdoc">Given an atom name, attempt to get the element in most cases. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00194">molecule.py:194</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a77417ff99b19f6d0b7c6f527e83fa7f1"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a77417ff99b19f6d0b7c6f527e83fa7f1">forcebalance.molecule.Molecule.append</a></div><div class="ttdeci">def append</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00889">molecule.py:889</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_aa9ad9b92efa7bd3c1d589d62bbb8108e"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#aa9ad9b92efa7bd3c1d589d62bbb8108e">forcebalance.molecule.AlignToMoments</a></div><div class="ttdeci">def AlignToMoments</div><div class="ttdoc">Pre-aligns molecules to &#39;moment of inertia&#39;. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00584">molecule.py:584</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a02ff6f6642ed47c3b1fa3bb00191c32a"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a02ff6f6642ed47c3b1fa3bb00191c32a">forcebalance.molecule.Molecule.radius_of_gyration</a></div><div class="ttdeci">def radius_of_gyration</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01046">molecule.py:1046</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_af28de4693e5b8e82df900d0ac3c6c370"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#af28de4693e5b8e82df900d0ac3c6c370">forcebalance.molecule.getElement</a></div><div class="ttdeci">def getElement</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00189">molecule.py:189</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a8b8d3444945cab760288f28996787855"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a8b8d3444945cab760288f28996787855">forcebalance.molecule.Molecule.read_charmm</a></div><div class="ttdeci">def read_charmm</div><div class="ttdoc">Read a CHARMM .cor (or .crd) file. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l02051">molecule.py:2051</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_a4cdb2086978b281ed84cd66179c3f5b2"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#a4cdb2086978b281ed84cd66179c3f5b2">forcebalance.molecule.add_strip_to_mat</a></div><div class="ttdeci">def add_strip_to_mat</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00466">molecule.py:466</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_ab1b56d66b7673b2631e2cee013a80b93"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#ab1b56d66b7673b2631e2cee013a80b93">forcebalance.molecule.Molecule.read_mdcrd</a></div><div class="ttdeci">def read_mdcrd</div><div class="ttdoc">Parse an AMBER .mdcrd file. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01704">molecule.py:1704</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a3e716bb5d0b0450d5774cfc42a44c789"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a3e716bb5d0b0450d5774cfc42a44c789">forcebalance.molecule.Molecule.__setattr__</a></div><div class="ttdeci">def __setattr__</div><div class="ttdoc">Whenever we try to get a class attribute, it first tries to get the attribute from the Data dictionar...</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00747">molecule.py:747</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_ae565eb57c2ee21f2be19b9761754aba5"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#ae565eb57c2ee21f2be19b9761754aba5">forcebalance.molecule.Molecule.replace_peratom_conditional</a></div><div class="ttdeci">def replace_peratom_conditional</div><div class="ttdoc">Replace all of the data for a attribute key2 from orig to want, contingent on key1 being equal to con...</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01165">molecule.py:1165</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a441d8367806c9a802bd0693fea16c62a"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a441d8367806c9a802bd0693fea16c62a">forcebalance.molecule.Molecule.edit_qcrems</a></div><div class="ttdeci">def edit_qcrems</div><div class="ttdoc">Edit Q-Chem rem variables with a dictionary. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01110">molecule.py:1110</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_a8fcbb4a2b3470a85d25699b6f28a54fc"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#a8fcbb4a2b3470a85d25699b6f28a54fc">forcebalance.molecule.ComputeOverlap</a></div><div class="ttdeci">def ComputeOverlap</div><div class="ttdoc">Computes an &#39;overlap&#39; between two molecules based on some fictitious density. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00555">molecule.py:555</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a1d34af6a7d22dd34850d58efe8595b20"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a1d34af6a7d22dd34850d58efe8595b20">forcebalance.molecule.Molecule.read_qdata</a></div><div class="ttdeci">def read_qdata</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01729">molecule.py:1729</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_aeb5135f20e02b98900b6fa3fbab9822d"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#aeb5135f20e02b98900b6fa3fbab9822d">forcebalance.molecule.Molecule.built_bonds</a></div><div class="ttdeci">built_bonds</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00944">molecule.py:944</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_af12c7d375efeffb8a35b8406afc209dc"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#af12c7d375efeffb8a35b8406afc209dc">forcebalance.molecule.Molecule.rigid_water</a></div><div class="ttdeci">def rigid_water</div><div class="ttdoc">If one atom is oxygen and the next two are hydrogen, make the water molecule rigid. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01058">molecule.py:1058</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a2124792d405b58526af41475e4af3c80"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a2124792d405b58526af41475e4af3c80">forcebalance.molecule.Molecule.fout</a></div><div class="ttdeci">fout</div><div class="ttdoc">Fill in comments. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01013">molecule.py:1013</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_aab5ea35ab9d68559fd6ea7b747c2bddb"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#aab5ea35ab9d68559fd6ea7b747c2bddb">forcebalance.molecule.Molecule.write_mdcrd</a></div><div class="ttdeci">def write_mdcrd</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l02699">molecule.py:2699</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a90fe456919fda305703e36af389e60e1"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a90fe456919fda305703e36af389e60e1">forcebalance.molecule.Molecule.require_resid</a></div><div class="ttdeci">def require_resid</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l02943">molecule.py:2943</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a0da69575f235955e5562e46d311a5536"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a0da69575f235955e5562e46d311a5536">forcebalance.molecule.Molecule.__getitem__</a></div><div class="ttdeci">def __getitem__</div><div class="ttdoc">The Molecule class has list-like behavior, so we can get slices of it. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00759">molecule.py:759</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1MyG_html"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1MyG.html">forcebalance.molecule.MyG</a></div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00324">molecule.py:324</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_aa69056db05f047be1b4ae1e8f132d978"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#aa69056db05f047be1b4ae1e8f132d978">forcebalance.molecule.Molecule.find_angles</a></div><div class="ttdeci">def find_angles</div><div class="ttdoc">Return a list of 3-tuples corresponding to all of the angles in the system. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01458">molecule.py:1458</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a3f8233f4e9911d7af0f17ca66c16ff92"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a3f8233f4e9911d7af0f17ca66c16ff92">forcebalance.molecule.Molecule.__init__</a></div><div class="ttdeci">def __init__</div><div class="ttdoc">To create the Molecule object, we simply define the table of file reading/writing functions and read ...</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00896">molecule.py:896</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a0dee435704418bf51199d6bab6d92249"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a0dee435704418bf51199d6bab6d92249">forcebalance.molecule.Molecule.write_dcd</a></div><div class="ttdeci">def write_dcd</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l02760">molecule.py:2760</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_a5f529179461765fadbd0a742cdc2c677"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#a5f529179461765fadbd0a742cdc2c677">forcebalance.molecule.even_list</a></div><div class="ttdeci">def even_list</div><div class="ttdoc">Creates a list of number sequences divided as evenly as possible. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00486">molecule.py:486</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a14b1fbc70a083d21fd016b5dd854fd56"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a14b1fbc70a083d21fd016b5dd854fd56">forcebalance.molecule.Molecule.read_mol2</a></div><div class="ttdeci">def read_mol2</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01765">molecule.py:1765</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_a9a58eb1746e51420f50da3f3a6d51485"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#a9a58eb1746e51420f50da3f3a6d51485">forcebalance.molecule.AlignToDensity</a></div><div class="ttdeci">def AlignToDensity</div><div class="ttdoc">Computes a &quot;overlap density&quot; from two frames. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00572">molecule.py:572</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_ab4a7a79d738889528f3823b46244ea7d"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#ab4a7a79d738889528f3823b46244ea7d">forcebalance.molecule.Molecule.__delitem__</a></div><div class="ttdeci">def __delitem__</div><div class="ttdoc">Similarly, in order to delete a frame, we simply perform item deletion on framewise variables...</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00780">molecule.py:780</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_aff7a0e2413297088a5bc3e91e5951f3f"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#aff7a0e2413297088a5bc3e91e5951f3f">forcebalance.molecule.Molecule.align_center</a></div><div class="ttdeci">def align_center</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01583">molecule.py:1583</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a35600d98f150597c9d9ac5129e01bd8d"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a35600d98f150597c9d9ac5129e01bd8d">forcebalance.molecule.Molecule.Read_Tab</a></div><div class="ttdeci">Read_Tab</div><div class="ttdoc">The table of file readers. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00903">molecule.py:903</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_ae76fc5d05f43acc6006a4d1733818d71"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#ae76fc5d05f43acc6006a4d1733818d71">forcebalance.molecule.cartesian_product2</a></div><div class="ttdeci">def cartesian_product2</div><div class="ttdoc">Form a Cartesian product of two NumPy arrays. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00645">molecule.py:645</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a003b182b54de4473c4691ae1474b1ada"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a003b182b54de4473c4691ae1474b1ada">forcebalance.molecule.Molecule.read_qcin</a></div><div class="ttdeci">def read_qcin</div><div class="ttdoc">Read a Q-Chem input file. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l02120">molecule.py:2120</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_afadc87c0cc32dc73558cd901a4c64dd4"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#afadc87c0cc32dc73558cd901a4c64dd4">forcebalance.molecule.Molecule.read_pdb</a></div><div class="ttdeci">def read_pdb</div><div class="ttdoc">Loads a PDB and returns a dictionary containing its data. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l02237">molecule.py:2237</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_a29fb1ac9324f4280f07c65baea339989"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#a29fb1ac9324f4280f07c65baea339989">forcebalance.molecule.BuildLatticeFromVectors</a></div><div class="ttdeci">def BuildLatticeFromVectors</div><div class="ttdoc">This function takes in three lattice vectors and tries to return a complete box specification. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00297">molecule.py:297</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_ad825186bec1659fdad2521a1b377323b"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#ad825186bec1659fdad2521a1b377323b">forcebalance.molecule.Molecule.replace_peratom</a></div><div class="ttdeci">def replace_peratom</div><div class="ttdoc">Replace all of the data for a certain attribute in the system from orig to want. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01154">molecule.py:1154</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a57edc8d72f7e4c1a1452de7b438f3c55"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a57edc8d72f7e4c1a1452de7b438f3c55">forcebalance.molecule.Molecule.openmm_positions</a></div><div class="ttdeci">def openmm_positions</div><div class="ttdoc">Returns the Cartesian coordinates in the Molecule object in a list of OpenMM-compatible positions...</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01592">molecule.py:1592</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1MyG_html_ad6a5334dbe95ecab760c2d76ec8610ea"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1MyG.html#ad6a5334dbe95ecab760c2d76ec8610ea">forcebalance.molecule.MyG.Alive</a></div><div class="ttdeci">Alive</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00327">molecule.py:327</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a963a4382dc59ebd8dd9ee2064843e355"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a963a4382dc59ebd8dd9ee2064843e355">forcebalance.molecule.Molecule.read_gro</a></div><div class="ttdeci">def read_gro</div><div class="ttdoc">Read a GROMACS .gro file. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01971">molecule.py:1971</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_a75775be6563ad7f10695a9a45ff49ba9"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#a75775be6563ad7f10695a9a45ff49ba9">forcebalance.molecule.either</a></div><div class="ttdeci">def either</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00518">molecule.py:518</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a2537929702245aab6ab293c145730d7c"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a2537929702245aab6ab293c145730d7c">forcebalance.molecule.Molecule.molecules</a></div><div class="ttdeci">molecules</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00976">molecule.py:976</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1MyG_html_a2913983e3a4725dff2df4a39f30bfaad"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1MyG.html#a2913983e3a4725dff2df4a39f30bfaad">forcebalance.molecule.MyG.e</a></div><div class="ttdeci">def e</div><div class="ttdoc">Return an array of the elements. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00349">molecule.py:349</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_ab9cb167fbbd809aedcf8c7434d405547"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#ab9cb167fbbd809aedcf8c7434d405547">forcebalance.molecule.main</a></div><div class="ttdeci">def main</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l03009">molecule.py:3009</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a491b10f21e93f841a770088402a13924"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a491b10f21e93f841a770088402a13924">forcebalance.molecule.Molecule.Funnel</a></div><div class="ttdeci">Funnel</div><div class="ttdoc">A funnel dictionary that takes redundant file types and maps them down to a few. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00928">molecule.py:928</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1MyG_html_a56413ce7a4c8db075299f724bd9ad71f"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1MyG.html#a56413ce7a4c8db075299f724bd9ad71f">forcebalance.molecule.MyG.AStr</a></div><div class="ttdeci">def AStr</div><div class="ttdoc">Return a string of atoms, which serves as a rudimentary &#39;fingerprint&#39; : &#39;99,100,103,151&#39; . </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00345">molecule.py:345</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_aa20a420f4b450bfa9e632fae037ecb01"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#aa20a420f4b450bfa9e632fae037ecb01">forcebalance.molecule.Molecule.openmm_boxes</a></div><div class="ttdeci">def openmm_boxes</div><div class="ttdoc">Returns the periodic box vectors in the Molecule object in a list of OpenMM-compatible boxes...</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01609">molecule.py:1609</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_ac0fd89e640485f7216183f9a7601c51f"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#ac0fd89e640485f7216183f9a7601c51f">forcebalance.molecule.Molecule.pathwise_rmsd</a></div><div class="ttdeci">def pathwise_rmsd</div><div class="ttdoc">Find RMSD between frames along path. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01552">molecule.py:1552</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a6aa22586a5590f63ea20e269e3f195a5"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a6aa22586a5590f63ea20e269e3f195a5">forcebalance.molecule.Molecule.center_of_mass</a></div><div class="ttdeci">def center_of_mass</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01042">molecule.py:1042</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a85310a28c678cb386f9d2b584b24320d"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a85310a28c678cb386f9d2b584b24320d">forcebalance.molecule.Molecule.Write_Tab</a></div><div class="ttdeci">Write_Tab</div><div class="ttdoc">The table of file writers. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00917">molecule.py:917</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_a5b50df23cc4d0e617fdc56538f0bea63"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#a5b50df23cc4d0e617fdc56538f0bea63">forcebalance.molecule.both</a></div><div class="ttdeci">def both</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00504">molecule.py:504</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_adc6620e8287edabe161442de12295f75"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#adc6620e8287edabe161442de12295f75">forcebalance.molecule.Molecule.write_xyz</a></div><div class="ttdeci">def write_xyz</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l02676">molecule.py:2676</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_a0a6e3e79b04534bf2e83d09def189444"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#a0a6e3e79b04534bf2e83d09def189444">forcebalance.molecule.BuildLatticeFromLengthsAngles</a></div><div class="ttdeci">def BuildLatticeFromLengthsAngles</div><div class="ttdoc">This function takes in three lattice lengths and three lattice angles, and tries to return a complete...</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00282">molecule.py:282</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_ae25aa5331b3a2dd0e9d1e184380357db"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#ae25aa5331b3a2dd0e9d1e184380357db">forcebalance.molecule.format_gro_box</a></div><div class="ttdeci">def format_gro_box</div><div class="ttdoc">Print a line corresponding to the box vector in accordance with .gro file format. ...</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00417">molecule.py:417</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_aa761cf1cf260e15d0b03a6f61569c840"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#aa761cf1cf260e15d0b03a6f61569c840">forcebalance.molecule.Box</a></div><div class="ttdeci">tuple Box</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00258">molecule.py:258</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_af412b655371674434ec63b4bfea6d8c0"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#af412b655371674434ec63b4bfea6d8c0">forcebalance.molecule.Molecule.all_pairwise_rmsd</a></div><div class="ttdeci">def all_pairwise_rmsd</div><div class="ttdoc">Find pairwise RMSD (super slow, not like the one in MSMBuilder.) </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01534">molecule.py:1534</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a95782abfb36e7080a1b98bfad2ced4f3"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a95782abfb36e7080a1b98bfad2ced4f3">forcebalance.molecule.Molecule.write_arc</a></div><div class="ttdeci">def write_arc</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l02710">molecule.py:2710</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_a0dd31eff88d2bed0884ab21a13261d42"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#a0dd31eff88d2bed0884ab21a13261d42">forcebalance.molecule.isint</a></div><div class="ttdeci">def isint</div><div class="ttdoc">ONLY matches integers! If you have a decimal point? None shall pass! </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00246">molecule.py:246</a></div></div>
<div class="ttc" id="namespacesimtk_1_1unit_html"><div class="ttname"><a href="namespacesimtk_1_1unit.html">unit</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a4ecfdf28aacff9c081dd50cd4ac84f89"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a4ecfdf28aacff9c081dd50cd4ac84f89">forcebalance.molecule.Molecule.write</a></div><div class="ttdeci">def write</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01002">molecule.py:1002</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a47082443566cd50add3f2ec20af9cc10"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a47082443566cd50add3f2ec20af9cc10">forcebalance.molecule.Molecule.write_pdb</a></div><div class="ttdeci">def write_pdb</div><div class="ttdoc">Save to a PDB. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l02816">molecule.py:2816</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1MyG_html_ab6c0598bb829c52b68aaa9c189211419"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1MyG.html#ab6c0598bb829c52b68aaa9c189211419">forcebalance.molecule.MyG.ef</a></div><div class="ttdeci">def ef</div><div class="ttdoc">Create an Empirical Formula. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00354">molecule.py:354</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a503eae2cee228e4cc5fc736504714925"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a503eae2cee228e4cc5fc736504714925">forcebalance.molecule.Molecule.write_gro</a></div><div class="ttdeci">def write_gro</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l02725">molecule.py:2725</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a861feda06e1f60ab25c45eaaaf228cfc"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a861feda06e1f60ab25c45eaaaf228cfc">forcebalance.molecule.Molecule.read_com</a></div><div class="ttdeci">def read_com</div><div class="ttdoc">Parse a Gaussian .com file and return a SINGLE-ELEMENT list of xyz coordinates (no multiple file supp...</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01853">molecule.py:1853</a></div></div>
<div class="ttc" id="namespacesimtk_1_1openmm_html"><div class="ttname"><a href="namespacesimtk_1_1openmm.html">openmm</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a57facdb1b7e71fabfad0df72a7ff94f5"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a57facdb1b7e71fabfad0df72a7ff94f5">forcebalance.molecule.Molecule.topology</a></div><div class="ttdeci">topology</div><div class="ttdoc">Make sure the comment line isn&#39;t too long for i in range(len(self.comms)): self.comms[i] = self...</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00975">molecule.py:975</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1MyG_html_a5ae5e64f229f7833216a82969fa39b15"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1MyG.html#a5ae5e64f229f7833216a82969fa39b15">forcebalance.molecule.MyG.__hash__</a></div><div class="ttdeci">def __hash__</div><div class="ttdoc">The hash function is something we can use to discard two things that are obviously not equal...</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00337">molecule.py:337</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a87e66db685214a9cdd4feff49d4ea5dc"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a87e66db685214a9cdd4feff49d4ea5dc">forcebalance.molecule.Molecule.align</a></div><div class="ttdeci">def align</div><div class="ttdoc">Align molecules. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01280">molecule.py:1280</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_a12b7bb398c2fa49a223f258ec7737483"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#a12b7bb398c2fa49a223f258ec7737483">forcebalance.molecule.is_gro_coord</a></div><div class="ttdeci">def is_gro_coord</div><div class="ttdoc">Determines whether a line contains GROMACS data or not. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00429">molecule.py:429</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1MyG_html_a2fff1521f1d651835fe56f64340a7ddf"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1MyG.html#a2fff1521f1d651835fe56f64340a7ddf">forcebalance.molecule.MyG.x</a></div><div class="ttdeci">def x</div><div class="ttdoc">Get a list of the coordinates. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00359">molecule.py:359</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_af02bf73765f34bbef81c4a5b000b86ce"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#af02bf73765f34bbef81c4a5b000b86ce">forcebalance.molecule.EulerMatrix</a></div><div class="ttdeci">def EulerMatrix</div><div class="ttdoc">Constructs an Euler matrix from three Euler angles. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00527">molecule.py:527</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_a58c3f09152db4d1c6e1db9df29c60c43"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#a58c3f09152db4d1c6e1db9df29c60c43">forcebalance.molecule.pvec</a></div><div class="ttdeci">def pvec</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00475">molecule.py:475</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_ad8fa6cc7424aae00ee3f5bb87d28e037"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#ad8fa6cc7424aae00ee3f5bb87d28e037">forcebalance.molecule.Molecule.read_dcd</a></div><div class="ttdeci">def read_dcd</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01814">molecule.py:1814</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a27fb6201b435a3b205ae62f605256f3d"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a27fb6201b435a3b205ae62f605256f3d">forcebalance.molecule.Molecule.read_qcesp</a></div><div class="ttdeci">def read_qcesp</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l02312">molecule.py:2312</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_ae1bcdf1cc78a6cc165de80bacc7b69c5"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#ae1bcdf1cc78a6cc165de80bacc7b69c5">forcebalance.molecule.Molecule.__iadd__</a></div><div class="ttdeci">def __iadd__</div><div class="ttdoc">Add method for Molecule objects. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00839">molecule.py:839</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a63dd7bc0347cc3dec5e8fa0ebfd567ec"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a63dd7bc0347cc3dec5e8fa0ebfd567ec">forcebalance.molecule.Molecule.atom_stack</a></div><div class="ttdeci">def atom_stack</div><div class="ttdoc">Return a copy of the object with another molecule object appended. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01214">molecule.py:1214</a></div></div>
<div class="ttc" id="namespacesimtk_1_1openmm_1_1app_html"><div class="ttname"><a href="namespacesimtk_1_1openmm_1_1app.html">app</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a13d86eb62139bdc2a835756cacb3be66"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a13d86eb62139bdc2a835756cacb3be66">forcebalance.molecule.Molecule.add_virtual_site</a></div><div class="ttdeci">def add_virtual_site</div><div class="ttdoc">Add a virtual site to the system. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01137">molecule.py:1137</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_adf9f25ebcf955be562ef186b822e237a"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#adf9f25ebcf955be562ef186b822e237a">forcebalance.molecule.Molecule.comms</a></div><div class="ttdeci">comms</div><div class="ttdoc">Read in stuff if we passed in a file name, otherwise return an empty instance. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00965">molecule.py:965</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a1ef6aefd3218f8ab3f9dc2b37e602fbf"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a1ef6aefd3218f8ab3f9dc2b37e602fbf">forcebalance.molecule.Molecule.write_qdata</a></div><div class="ttdeci">def write_qdata</div><div class="ttdoc">Text quantum data format. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l02922">molecule.py:2922</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a33020ff5e5cec23a3d9d1fe7adfa8583"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a33020ff5e5cec23a3d9d1fe7adfa8583">forcebalance.molecule.Molecule.add_quantum</a></div><div class="ttdeci">def add_quantum</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01125">molecule.py:1125</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_aba14226f272f91c91ecf7060ff136a2b"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#aba14226f272f91c91ecf7060ff136a2b">forcebalance.molecule.Molecule.write_molproq</a></div><div class="ttdeci">def write_molproq</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l02687">molecule.py:2687</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1MolfileTimestep_html"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1MolfileTimestep.html">forcebalance.molecule.MolfileTimestep</a></div><div class="ttdoc">Wrapper for the timestep C structure used in molfile plugins. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00499">molecule.py:499</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a58191a79257fbad7f2c636239bfa7596"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a58191a79257fbad7f2c636239bfa7596">forcebalance.molecule.Molecule.ref_rmsd</a></div><div class="ttdeci">def ref_rmsd</div><div class="ttdoc">Find RMSD to a reference frame. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01569">molecule.py:1569</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_a7fe52c2928c7b0329882541bef2e34cd"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#a7fe52c2928c7b0329882541bef2e34cd">forcebalance.molecule.grouper</a></div><div class="ttdeci">def grouper</div><div class="ttdoc">Groups a big long iterable into groups of ten or what have you. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00480">molecule.py:480</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a15a7a0e0377e6dfd52e60c77fbc583c1"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a15a7a0e0377e6dfd52e60c77fbc583c1">forcebalance.molecule.Molecule.read_xyz</a></div><div class="ttdeci">def read_xyz</div><div class="ttdoc">.xyz files can be TINKER formatted which is why we have the try/except here. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01642">molecule.py:1642</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_ac1cdd5bcc81b6a9f56d89fd8a4225211"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#ac1cdd5bcc81b6a9f56d89fd8a4225211">forcebalance.molecule.Molecule.repair</a></div><div class="ttdeci">def repair</div><div class="ttdoc">Attempt to repair trivial issues that would otherwise break the object. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00874">molecule.py:874</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_a4948e4662b8d2c8d515427d1bbb3d01e"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#a4948e4662b8d2c8d515427d1bbb3d01e">forcebalance.molecule.format_xyzgen_coord</a></div><div class="ttdeci">def format_xyzgen_coord</div><div class="ttdoc">Print a line consisting of (element, p, q, r, s, t, ...) where (p, q, r) are arbitrary atom-wise data...</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00408">molecule.py:408</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a69c18c3fad45cd38102d9582445f5c6d"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a69c18c3fad45cd38102d9582445f5c6d">forcebalance.molecule.Molecule.Data</a></div><div class="ttdeci">Data</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00948">molecule.py:948</a></div></div>
<div class="ttc" id="namespaceforcebalance_1_1molecule_html_afe989ffd119568047fc8265b1d329a70"><div class="ttname"><a href="namespaceforcebalance_1_1molecule.html#afe989ffd119568047fc8265b1d329a70">forcebalance.molecule.isfloat</a></div><div class="ttdeci">def isfloat</div><div class="ttdoc">Matches ANY number; it can be a decimal, scientific notation, integer, or what have you...</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l00251">molecule.py:251</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_a03af3cfb99ea8f1c8c7e93d04bdcf967"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#a03af3cfb99ea8f1c8c7e93d04bdcf967">forcebalance.molecule.Molecule.require_boxes</a></div><div class="ttdeci">def require_boxes</div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l02956">molecule.py:2956</a></div></div>
<div class="ttc" id="classforcebalance_1_1molecule_1_1Molecule_html_aeb5983ae61079198f077f55e448e2c32"><div class="ttname"><a href="classforcebalance_1_1molecule_1_1Molecule.html#aeb5983ae61079198f077f55e448e2c32">forcebalance.molecule.Molecule.read_arc</a></div><div class="ttdeci">def read_arc</div><div class="ttdoc">Read a TINKER .arc file. </div><div class="ttdef"><b>Definition:</b> <a href="molecule_8py_source.html#l01898">molecule.py:1898</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Mar 30 2014 19:14:48 for ForceBalance API by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
